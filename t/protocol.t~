#!perl

use strict;
use warnings;
use Test::More;
use Test::Differences;
use lib 't';
use Test_Netspoc;

my ($title, $in, $out, $topo);

############################################################
$topo = <<END;
network:n1 = { ip = 10.1.1.0/24; }
network:n2 = { ip = 10.1.2.0/24; }
network:n3 = { ip = 10.1.3.0/24; }

router:asa1 = {
 managed;
 model = IOS;
 interface:n1 = { ip = 10.1.1.1; hardware = vlan1; disabled; }
 interface:n2 = { ip = 10.1.2.1; hardware = vlan2; }
}

router:asa2 = {
 managed;
 model = ASA;
 interface:n2 = { ip = 10.1.2.2; hardware = vlan2; }
 interface:n3 = { ip = 10.1.3.2; hardware = vlan3; }
}
END

############################################################
$title = 'Bad contained-in relation with src range';
############################################################

$in = $topo . <<'END';
protocol:ike1 = udp 500:500;
protocol:ike2 = udp 1-65535:500;
protocol:ike3 = udp 500:1-65535;
service:t1 = {
  user = network:n1;
  permit src = user; dst = network:n2; prt = protocol:p1, protocol:p2;
}

END

$out = <<END;
--asa1
access-list vlan2_in extended deny ip any any
access-group vlan2_in in interface vlan2
END

test_err($title, $in, $out);

############################################################
done_testing;
