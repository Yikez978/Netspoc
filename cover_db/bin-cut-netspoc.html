<!DOCTYPE html
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<!--
This file was generated by Devel::Cover Version 1.17
Devel::Cover is copyright 2001-2012, Paul Johnson (paul@pjcj.net)
Devel::Cover is free. It is licensed under the same terms as Perl itself.
The latest version of Devel::Cover should be available from my homepage:
http://www.pjcj.net
-->
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
    <meta http-equiv="Content-Language" content="en-us"></meta>
    <link rel="stylesheet" type="text/css" href="cover.css"></link>
    <link rel="stylesheet" type="text/css" href="cover.css"></link>
    <title>File Coverage: bin/cut-netspoc</title>
</head>
<body>
<h1>File Coverage</h1>
<table>
<tr><td class="h" align="right">File:</td><td align="left">bin/cut-netspoc</td></tr>
<tr><td class="h" align="right">Coverage:</td><td align="left" class="c1">77.3%</td></tr>
</table>
<div><br/></div>
<table>
<tr><th>line</th><th>stmt</th><th>bran</th><th>cond</th><th>sub</th><th>pod</th><th>time</th><th>code</th></tr>
<tr><td class="h">1</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#!/usr/bin/perl</td></tr>
<tr><td class="h">2</td><td colspan="7"></td></tr><tr><td class="h">3 - 55</td><td colspan="6"></td><td class="s"><pre>=head1 NAME

cut-netspoc - Print parts of a netspoc configuration to stdout

=head1 SYNOPSIS

cut-netspoc [options] FILE|DIR [service:name] ...

=head1 DESCRIPTION

Reads a Netspoc configuration and prints parts of this configuration
to STDOUT. If one or more services are given as argument, only those
parts are printed, that are referenced by given serices. If no service
is given, it acts as if all services are specified. This is useful to
eliminate all disabled parts of the topology.

=head1 OPTIONS

=item B&lt;-q&gt;

Quiet, don&#39;t print status messages.

=item B&lt;-help&gt;

Prints a brief help message and exits.

=item B&lt;-man&gt;

Prints the manual page and exits.

=back

=head1 COPYRIGHT AND DISCLAIMER

(c) 2015 by Heinz Knutzen &lt;heinz.knutzen@googlemail.com&gt;

http://hknutzen.github.com/Netspoc

This program is free software; you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation; either version 2 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.&nbsp;&nbsp;See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License along
with this program; if not, write to the Free Software Foundation, Inc.,
51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.

=cut</pre></td></tr>
<tr><td class="h">56</td><td colspan="7"></td></tr><tr><td class="h">57</td><td><div class="c3">13</div><div class="c3">13</div><div class="c3">13</div></td><td></td><td></td><td><div class="c3"><a href="bin-cut-netspoc--subroutine.html#L57">13</a></div></td><td></td><td><div>53</div><div>13</div><div>322</div></td><td class="s">use strict;</td></tr>
<tr><td class="h">58</td><td><div class="c3">13</div><div class="c3">13</div><div class="c3">13</div></td><td></td><td></td><td><div class="c3"><a href="bin-cut-netspoc--subroutine.html#L58">13</a></div></td><td></td><td><div>43</div><div>14</div><div>232</div></td><td class="s">use warnings;</td></tr>
<tr><td class="h">59</td><td><div class="c3">13</div><div class="c3">13</div><div class="c3">13</div></td><td></td><td></td><td><div class="c3"><a href="bin-cut-netspoc--subroutine.html#L59">13</a></div></td><td></td><td><div>5287</div><div>31</div><div>57</div></td><td class="s">use Getopt::Long;</td></tr>
<tr><td class="h">60</td><td><div class="c3">13</div><div class="c3">13</div><div class="c3">13</div></td><td></td><td></td><td><div class="c3"><a href="bin-cut-netspoc--subroutine.html#L60">13</a></div></td><td></td><td><div>3098</div><div>26</div><div>1037</div></td><td class="s">use Pod::Usage;</td></tr>
<tr><td class="h">61</td><td><div class="c3">13</div><div class="c3">13</div><div class="c3">13</div></td><td></td><td></td><td><div class="c3"><a href="bin-cut-netspoc--subroutine.html#L61">13</a></div></td><td></td><td><div>27820</div><div>31</div><div>4273</div></td><td class="s">use Netspoc;</td></tr>
<tr><td class="h">62</td><td><div class="c3">13</div><div class="c3">13</div><div class="c3">13</div></td><td></td><td></td><td><div class="c3"><a href="bin-cut-netspoc--subroutine.html#L62">13</a></div></td><td></td><td><div>2949</div><div>25</div><div>39</div></td><td class="s">use locale;</td></tr>
<tr><td class="h">63</td><td colspan="7"></td></tr><tr><td class="h">64</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># VERSION: inserted by DZP::OurPkgVersion</td></tr>
<tr><td class="h">65</td><td colspan="7"></td></tr><tr><td class="h">66</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">####################################################################</td></tr>
<tr><td class="h">67</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># Argument processing</td></tr>
<tr><td class="h">68</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">####################################################################</td></tr>
<tr><td class="h">69</td><td><div class="c3">13</div></td><td></td><td></td><td></td><td></td><td><div>26</div></td><td class="s">my $quiet;</td></tr>
<tr><td class="h">70</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">my $help;</td></tr>
<tr><td class="h">71</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">my $man;</td></tr>
<tr><td class="h">72</td><td><div class="c3">13</div></td><td><div class="c0" title="-/F"><a href="bin-cut-netspoc--branch.html#L72">50</a></div></td><td></td><td></td><td></td><td><div>47</div></td><td class="s">GetOptions ( &#39;quiet!&#39; =&gt; \$quiet,</td></tr>
<tr><td class="h">73</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;help|?&#39; =&gt; \$help,</td></tr>
<tr><td class="h">74</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;man =&gt; \$man,</td></tr>
<tr><td class="h">75</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) or pod2usage(2);</td></tr>
<tr><td class="h">76</td><td><div class="c3">13</div></td><td><div class="c0" title="-/F"><a href="bin-cut-netspoc--branch.html#L76">50</a></div></td><td></td><td></td><td></td><td><div>29</div></td><td class="s">pod2usage(1) if $help;</td></tr>
<tr><td class="h">77</td><td><div class="c3">13</div></td><td><div class="c0" title="-/F"><a href="bin-cut-netspoc--branch.html#L77">50</a></div></td><td></td><td></td><td></td><td><div>27</div></td><td class="s">pod2usage(-exitstatus =&gt; 0, -verbose =&gt; 2) if $man;</td></tr>
<tr><td class="h">78</td><td colspan="7"></td></tr><tr><td class="h">79</td><td><div class="c3">13</div></td><td></td><td></td><td></td><td></td><td><div>17</div></td><td class="s">my $path = shift @ARGV;</td></tr>
<tr><td class="h">80</td><td colspan="7"></td></tr><tr><td class="h">81</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># Give each source part an index to preserve original order.</td></tr>
<tr><td class="h">82</td><td><div class="c3">13</div></td><td></td><td></td><td></td><td></td><td><div>17</div></td><td class="s">my $src_index = 1;</td></tr>
<tr><td class="h">83</td><td colspan="7"></td></tr><tr><td class="h">84</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># Enhanced version of read_netspoc, which stores source code of each</td></tr>
<tr><td class="h">85</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># global definition.</td></tr>
<tr><td class="h">86</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub read_netspoc_with_src {</td></tr>
<tr><td class="h">87</td><td><div class="c3">102</div></td><td></td><td></td><td><div class="c3"><a href="bin-cut-netspoc--subroutine.html#L87">102</a></div></td><td></td><td><div>101</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $pre&nbsp;&nbsp;&nbsp;&nbsp;= pos $Netspoc::input;</td></tr>
<tr><td class="h">88</td><td><div class="c3">102</div></td><td></td><td></td><td></td><td></td><td><div>142</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $object = &amp;read_netspoc();</td></tr>
<tr><td class="h">89</td><td><div class="c3">102</div></td><td></td><td></td><td></td><td></td><td><div>158</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $post&nbsp;&nbsp;&nbsp;= pos $Netspoc::input;</td></tr>
<tr><td class="h">90</td><td><div class="c3">102</div></td><td></td><td></td><td></td><td></td><td><div>234</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$object-&gt;{src_code} = substr $Netspoc::input, $pre, $post - $pre;</td></tr>
<tr><td class="h">91</td><td><div class="c3">102</div></td><td></td><td></td><td></td><td></td><td><div>128</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$object-&gt;{src_index} = $src_index++;</td></tr>
<tr><td class="h">92</td><td colspan="7"></td></tr><tr><td class="h">93</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#&nbsp;&nbsp;&nbsp;&nbsp;print STDERR &quot;$object-&gt;{name} $pre-$post\n&quot;;</td></tr>
<tr><td class="h">94</td><td><div class="c3">102</div></td><td></td><td></td><td></td><td></td><td><div>181</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $object;</td></tr>
<tr><td class="h">95</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">96</td><td colspan="7"></td></tr><tr><td class="h">97</td><td colspan="7"></td></tr><tr><td class="h">98</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># Not only networks on path, but all connected networks need to be marked</td></tr>
<tr><td class="h">99</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># to get a valid topology.</td></tr>
<tr><td class="h">100</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub mark_adjacent_networks {</td></tr>
<tr><td class="h">101</td><td><div class="c3">33</div></td><td></td><td></td><td><div class="c3"><a href="bin-cut-netspoc--subroutine.html#L101">33</a></div></td><td></td><td><div>32</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ($router) = @_;</td></tr>
<tr><td class="h">102</td><td><div class="c3">33</div><div class="c3">33</div></td><td></td><td></td><td></td><td></td><td><div>24</div><div>55</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;for my $interface (@{ $router-&gt;{interfaces} }) {</td></tr>
<tr><td class="h">103</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Netspoc::debug &quot;adj. $interface-&gt;{network}-&gt;{name}&quot;;</td></tr>
<tr><td class="h">104</td><td><div class="c3">64</div></td><td></td><td></td><td></td><td></td><td><div>51</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $network = $interface-&gt;{network};</td></tr>
<tr><td class="h">105</td><td><div class="c3">64</div></td><td></td><td></td><td></td><td></td><td><div>61</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$network-&gt;{is_used} = 1;</td></tr>
<tr><td class="h">106</td><td colspan="7"></td></tr><tr><td class="h">107</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Mark bridge and bridged networks.</td></tr>
<tr><td class="h">108</td><td><div class="c3">64</div></td><td><div class="c0" title="-/F"><a href="bin-cut-netspoc--branch.html#L108">50</a></div></td><td></td><td></td><td></td><td><div>127</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($network-&gt;{bridged}) {</td></tr>
<tr><td class="h">109</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for my $bridge_in (@{ $network-&gt;{interfaces} }) {</td></tr>
<tr><td class="h">110</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="bin-cut-netspoc--branch.html#L110">0</a></div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$bridge_in-&gt;{ip} eq &#39;bridged&#39; or next;</td></tr>
<tr><td class="h">111</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $bridge = $bridge_in-&gt;{router};</td></tr>
<tr><td class="h">112</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$bridge-&gt;{is_used} = 1;</td></tr>
<tr><td class="h">113</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for my $bridge_out (@{ $bridge-&gt;{interfaces} }) {</td></tr>
<tr><td class="h">114</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="bin-cut-netspoc--branch.html#L114">0</a></div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$bridge_out-&gt;{ip} eq &#39;bridged&#39; or next;</td></tr>
<tr><td class="h">115</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$bridge_out-&gt;{network}-&gt;{is_used} = 1;</td></tr>
<tr><td class="h">116</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>
<tr><td class="h">117</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">118</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">119</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">120</td><td><div class="c3">33</div></td><td></td><td></td><td></td><td></td><td><div>41</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return;</td></tr>
<tr><td class="h">121</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">122</td><td colspan="7"></td></tr><tr><td class="h">123</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># This function is called by path_walk to mark all managed routers and</td></tr>
<tr><td class="h">124</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># adjacent networks on path from src to dst of $rule with attribute {is_used}.</td></tr>
<tr><td class="h">125</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub mark_topology {</td></tr>
<tr><td class="h">126</td><td><div class="c3">24</div></td><td></td><td></td><td><div class="c3"><a href="bin-cut-netspoc--subroutine.html#L126">24</a></div></td><td></td><td><div>25</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ($rule, $in_intf, $out_intf) = @_;</td></tr>
<tr><td class="h">127</td><td><div class="c3">24</div></td><td></td><td><div class="c0"><a href="bin-cut-netspoc--condition.html#L127">67</a></div></td><td></td><td></td><td><div>54</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $router = ($in_intf || $out_intf)-&gt;{router};</td></tr>
<tr><td class="h">128</td><td><div class="c3">24</div></td><td></td><td></td><td></td><td></td><td><div>27</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$router-&gt;{is_used} = 1;</td></tr>
<tr><td class="h">129</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#&nbsp;&nbsp;&nbsp;&nbsp;Netspoc::debug &quot;Used $router-&gt;{name}&quot;;</td></tr>
<tr><td class="h">130</td><td><div class="c3">24</div></td><td></td><td></td><td></td><td></td><td><div>35</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;mark_adjacent_networks($router);</td></tr>
<tr><td class="h">131</td><td><div class="c3">24</div></td><td></td><td></td><td></td><td></td><td><div>38</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return;</td></tr>
<tr><td class="h">132</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">133</td><td colspan="7"></td></tr><tr><td class="h">134</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># Mark unmanaged routers and adjacent networks </td></tr>
<tr><td class="h">135</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># between marked and managed parts of topology.</td></tr>
<tr><td class="h">136</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub path_unmanaged {</td></tr>
<tr><td class="h">137</td><td><div class="c3">128</div></td><td></td><td></td><td><div class="c3"><a href="bin-cut-netspoc--subroutine.html#L137">128</a></div></td><td></td><td><div>107</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ($obj, $in_interface) = @_;</td></tr>
<tr><td class="h">138</td><td><div class="c3">128</div></td><td><div class="c3" title="T/F"><a href="bin-cut-netspoc--branch.html#L138">100</a></div></td><td></td><td></td><td></td><td><div>263</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return 1 if $obj-&gt;{is_used};</td></tr>
<tr><td class="h">139</td><td><div class="c3">41</div></td><td><div class="c0" title="-/F"><a href="bin-cut-netspoc--branch.html#L139">50</a></div></td><td></td><td></td><td></td><td><div>65</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return 0 if $obj-&gt;{managed};</td></tr>
<tr><td class="h">140</td><td><div class="c3">41</div></td><td><div class="c0" title="-/F"><a href="bin-cut-netspoc--branch.html#L140">50</a></div></td><td></td><td></td><td></td><td><div>69</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return if $obj-&gt;{active_path};</td></tr>
<tr><td class="h">141</td><td colspan="7"></td></tr><tr><td class="h">142</td><td><div class="c3">41</div></td><td></td><td></td><td></td><td></td><td><div>52</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;local $obj-&gt;{active_path} = 1;</td></tr>
<tr><td class="h">143</td><td><div class="c3">41</div></td><td></td><td></td><td></td><td></td><td><div>37</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $result = 0;</td></tr>
<tr><td class="h">144</td><td><div class="c3">41</div><div class="c3">41</div></td><td></td><td></td><td></td><td></td><td><div>29</div><div>58</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;for my $interface (@{ $obj-&gt;{interfaces} }) {</td></tr>
<tr><td class="h">145</td><td><div class="c3">68</div></td><td><div class="c3" title="T/F"><a href="bin-cut-netspoc--branch.html#L145">100</a></div></td><td></td><td></td><td></td><td><div>149</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;next if $interface eq $in_interface;</td></tr>
<tr><td class="h">146</td><td><div class="c3">27</div></td><td><div class="c3" title="T/F"><a href="bin-cut-netspoc--branch.html#L146">100</a></div></td><td></td><td></td><td></td><td><div>49</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $next = $interface-&gt;{is_network($obj) ? &#39;router&#39; : &#39;network&#39;};</td></tr>
<tr><td class="h">147</td><td><div class="c3">27</div></td><td><div class="c3" title="T/F"><a href="bin-cut-netspoc--branch.html#L147">100</a></div></td><td></td><td></td><td></td><td><div>55</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (path_unmanaged($next, $interface)) {</td></tr>
<tr><td class="h">148</td><td><div class="c3">12</div></td><td></td><td></td><td></td><td></td><td><div>14</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$obj-&gt;{is_used} = 1;</td></tr>
<tr><td class="h">149</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Netspoc::debug &quot;Marked $obj-&gt;{name}&quot;;</td></tr>
<tr><td class="h">150</td><td><div class="c3">12</div></td><td><div class="c3" title="T/F"><a href="bin-cut-netspoc--branch.html#L150">100</a></div></td><td></td><td></td><td></td><td><div>22</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (is_router($obj)) {</td></tr>
<tr><td class="h">151</td><td><div class="c3">9</div></td><td></td><td></td><td></td><td></td><td><div>13</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mark_adjacent_networks($obj);</td></tr>
<tr><td class="h">152</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">153</td><td><div class="c3">12</div></td><td></td><td></td><td></td><td></td><td><div>18</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result = 1;</td></tr>
<tr><td class="h">154</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">155</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">156</td><td><div class="c3">41</div></td><td></td><td></td><td></td><td></td><td><div>99</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $result;</td></tr>
<tr><td class="h">157</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">158</td><td colspan="7"></td></tr><tr><td class="h">159</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub mark_unmanaged {</td></tr>
<tr><td class="h">160</td><td><div class="c3">26</div></td><td></td><td></td><td><div class="c3"><a href="bin-cut-netspoc--subroutine.html#L160">26</a></div></td><td></td><td><div>47</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;for my $network (values %networks) {</td></tr>
<tr><td class="h">161</td><td><div class="c3">90</div></td><td><div class="c3" title="T/F"><a href="bin-cut-netspoc--branch.html#L161">100</a></div></td><td></td><td></td><td></td><td><div>150</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;next if not $network-&gt;{is_used};</td></tr>
<tr><td class="h">162</td><td><div class="c3">71</div><div class="c3">71</div></td><td></td><td></td><td></td><td></td><td><div>56</div><div>86</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for my $interface (@{ $network-&gt;{interfaces} }) {</td></tr>
<tr><td class="h">163</td><td><div class="c3">101</div></td><td></td><td></td><td></td><td></td><td><div>89</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $router = $interface-&gt;{router};</td></tr>
<tr><td class="h">164</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Netspoc::debug &quot;Path unmanaged $router-&gt;{name} $interface-&gt;{name}&quot;;</td></tr>
<tr><td class="h">165</td><td><div class="c3">101</div></td><td></td><td></td><td></td><td></td><td><div>115</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;path_unmanaged($router, $interface);</td></tr>
<tr><td class="h">166</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">167</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">168</td><td><div class="c3">26</div></td><td></td><td></td><td></td><td></td><td><div>27</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return;</td></tr>
<tr><td class="h">169</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>
<tr><td class="h">170</td><td colspan="7"></td></tr><tr><td class="h">171</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub mark_path {</td></tr>
<tr><td class="h">172</td><td><div class="c3">7</div></td><td></td><td></td><td><div class="c3"><a href="bin-cut-netspoc--subroutine.html#L172">7</a></div></td><td></td><td><div>8</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ($src, $dst) = @_;</td></tr>
<tr><td class="h">173</td><td><div class="c3">7</div></td><td></td><td></td><td></td><td></td><td><div>13</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $rule = {src =&gt; $src, dst =&gt; $dst, prt =&gt; {}};</td></tr>
<tr><td class="h">174</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#&nbsp;&nbsp;&nbsp;&nbsp;Netspoc::debug &quot;Path $src-&gt;{name} $dst-&gt;{name}&quot;;</td></tr>
<tr><td class="h">175</td><td><div class="c3">7</div></td><td></td><td></td><td></td><td></td><td><div>13</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&amp;path_walk($rule, \&amp;mark_topology);</td></tr>
<tr><td class="h">176</td><td><div class="c3">7</div></td><td></td><td></td><td></td><td></td><td><div>28</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return;</td></tr>
<tr><td class="h">177</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">178</td><td colspan="7"></td></tr><tr><td class="h">179</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># We can&#39;t use %aggregates from Netspoc.pm because it only holds named</td></tr>
<tr><td class="h">180</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># aggregates. But we need unnamed aggregates like any:[network:XX]</td></tr>
<tr><td class="h">181</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># as well.</td></tr>
<tr><td class="h">182</td><td><div class="c3">13</div></td><td></td><td></td><td></td><td></td><td><div>14</div></td><td class="s">my @all_zones;</td></tr>
<tr><td class="h">183</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub get_zones {</td></tr>
<tr><td class="h">184</td><td><div class="c3">13</div></td><td></td><td></td><td><div class="c3"><a href="bin-cut-netspoc--subroutine.html#L184">13</a></div></td><td></td><td><div>13</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my %all_zones;</td></tr>
<tr><td class="h">185</td><td><div class="c3">13</div></td><td></td><td></td><td></td><td></td><td><div>30</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;for my $network (values %Netspoc::networks) {</td></tr>
<tr><td class="h">186</td><td><div class="c3">45</div></td><td><div class="c0" title="-/F"><a href="bin-cut-netspoc--branch.html#L186">50</a></div></td><td></td><td></td><td></td><td><div>73</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;next if $network-&gt;{disabled};</td></tr>
<tr><td class="h">187</td><td><div class="c3">45</div></td><td></td><td></td><td></td><td></td><td><div>37</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $zone = $network-&gt;{zone};</td></tr>
<tr><td class="h">188</td><td><div class="c3">45</div></td><td></td><td></td><td></td><td></td><td><div>72</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$all_zones{$zone} = $zone;</td></tr>
<tr><td class="h">189</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">190</td><td><div class="c3">13</div></td><td></td><td></td><td></td><td></td><td><div>33</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;@all_zones = values %all_zones;</td></tr>
<tr><td class="h">191</td><td><div class="c3">13</div></td><td></td><td></td><td></td><td></td><td><div>23</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return;</td></tr>
<tr><td class="h">192</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">193</td><td colspan="7"></td></tr><tr><td class="h">194</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">####################################################################</td></tr>
<tr><td class="h">195</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># Main program</td></tr>
<tr><td class="h">196</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">####################################################################</td></tr>
<tr><td class="h">197</td><td colspan="7"></td></tr><tr><td class="h">198</td><td><div class="c3">13</div></td><td></td><td></td><td></td><td></td><td><div>31</div></td><td class="s">my $file_config = &amp;read_config($path);</td></tr>
<tr><td class="h">199</td><td><div class="c3">13</div></td><td></td><td></td><td></td><td></td><td><div>64</div></td><td class="s">Netspoc::set_config($file_config, </td></tr>
<tr><td class="h">200</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{time_stamps =&gt; 1, max_errors =&gt; 9999, verbose =&gt; !$quiet});</td></tr>
<tr><td class="h">201</td><td><div class="c3">13</div></td><td></td><td></td><td></td><td></td><td><div>46</div></td><td class="s">&amp;show_version();</td></tr>
<tr><td class="h">202</td><td colspan="7"></td></tr><tr><td class="h">203</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># Read and process netspoc configuration data.</td></tr>
<tr><td class="h">204</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># Remember source code of each global definition.</td></tr>
<tr><td class="h">205</td><td><div class="c3">13</div></td><td></td><td></td><td></td><td></td><td><div>34</div></td><td class="s">&amp;read_file_or_dir($path, \&amp;read_netspoc_with_src);</td></tr>
<tr><td class="h">206</td><td colspan="7"></td></tr><tr><td class="h">207</td><td><div class="c3">13</div></td><td></td><td></td><td></td><td></td><td><div>35</div></td><td class="s">my %name2var = ( service =&gt; \%services);</td></tr>
<tr><td class="h">208</td><td colspan="7"></td></tr><tr><td class="h">209</td><td><div class="c3">13</div></td><td><div class="c0" title="-/F"><a href="bin-cut-netspoc--branch.html#L209">50</a></div></td><td></td><td></td><td></td><td><div>35</div></td><td class="s">if (@ARGV) {</td></tr>
<tr><td class="h">210</td><td colspan="7"></td></tr><tr><td class="h">211</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Read names of services from command line.</td></tr>
<tr><td class="h">212</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;for my $arg (@ARGV) {</td></tr>
<tr><td class="h">213</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my ($type, $name) = split_typed_name $arg;</td></tr>
<tr><td class="h">214</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="bin-cut-netspoc--branch.html#L214">0</a></div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $ref = $name2var{$type} or pod2usage(2);</td></tr>
<tr><td class="h">215</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="bin-cut-netspoc--branch.html#L215">0</a></div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $thing = $ref-&gt;{$name} or fatal_err &quot;Unknown $arg&quot;;</td></tr>
<tr><td class="h">216</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$thing-&gt;{is_used} = 1;</td></tr>
<tr><td class="h">217</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">218</td><td colspan="7"></td></tr><tr><td class="h">219</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Delete unwanted global definitions.</td></tr>
<tr><td class="h">220</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;for my $ref (values %name2var) {</td></tr>
<tr><td class="h">221</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for my $name (keys %$ref) {</td></tr>
<tr><td class="h">222</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="bin-cut-netspoc--branch.html#L222">0</a></div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unless ($ref-&gt;{$name}-&gt;{is_used}) {</td></tr>
<tr><td class="h">223</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;delete $ref-&gt;{$name};</td></tr>
<tr><td class="h">224</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">225</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">226</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">227</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">228</td><td colspan="7"></td></tr><tr><td class="h">229</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># Retain all services, if no argument is given.</td></tr>
<tr><td class="h">230</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># Only remove disabled parts.</td></tr>
<tr><td class="h">231</td><td colspan="7"></td></tr><tr><td class="h">232</td><td><div class="c3">13</div></td><td></td><td></td><td></td><td></td><td><div>26</div></td><td class="s">&amp;order_protocols();</td></tr>
<tr><td class="h">233</td><td><div class="c3">13</div></td><td></td><td></td><td></td><td></td><td><div>25</div></td><td class="s">&amp;link_topology();</td></tr>
<tr><td class="h">234</td><td><div class="c3">13</div></td><td></td><td></td><td></td><td></td><td><div>27</div></td><td class="s">&amp;mark_disabled();</td></tr>
<tr><td class="h">235</td><td><div class="c3">13</div></td><td></td><td></td><td></td><td></td><td><div>25</div></td><td class="s">&amp;set_zone();</td></tr>
<tr><td class="h">236</td><td><div class="c3">13</div></td><td></td><td></td><td></td><td></td><td><div>32</div></td><td class="s">&amp;distribute_nat_info();</td></tr>
<tr><td class="h">237</td><td><div class="c3">13</div></td><td></td><td></td><td></td><td></td><td><div>32</div></td><td class="s">&amp;setpath();</td></tr>
<tr><td class="h">238</td><td><div class="c3">13</div></td><td></td><td></td><td></td><td></td><td><div>29</div></td><td class="s">Netspoc::find_subnets_in_zone();</td></tr>
<tr><td class="h">239</td><td><div class="c3">13</div></td><td></td><td></td><td></td><td></td><td><div>28</div></td><td class="s">&amp;expand_services(1);</td></tr>
<tr><td class="h">240</td><td colspan="7"></td></tr><tr><td class="h">241</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># Process rules of services.</td></tr>
<tr><td class="h">242</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub process_rules {</td></tr>
<tr><td class="h">243</td><td><div class="c3">13</div></td><td></td><td></td><td><div class="c3"><a href="bin-cut-netspoc--subroutine.html#L243">13</a></div></td><td></td><td><div>19</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ($expanded_rules) = @_;</td></tr>
<tr><td class="h">244</td><td><div class="c3">13</div></td><td></td><td></td><td></td><td></td><td><div>17</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;for my $type (&#39;deny&#39;, &#39;supernet&#39;, &#39;permit&#39;) {</td></tr>
<tr><td class="h">245</td><td><div class="c3">39</div><div class="c3">39</div></td><td></td><td></td><td></td><td></td><td><div>36</div><div>63</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for my $rule (@{ $expanded_rules-&gt;{$type} }) {</td></tr>
<tr><td class="h">246</td><td><div class="c3">16</div></td><td></td><td></td><td></td><td></td><td><div>22</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for my $where (&#39;src&#39;, &#39;dst&#39;) {</td></tr>
<tr><td class="h">247</td><td colspan="7"></td></tr><tr><td class="h">248</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# path_walk only handles managed routers and adjacent networks.</td></tr>
<tr><td class="h">249</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Mark all objects additionally here.</td></tr>
<tr><td class="h">250</td><td><div class="c3">32</div></td><td></td><td></td><td></td><td></td><td><div>34</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $obj = $rule-&gt;{$where};</td></tr>
<tr><td class="h">251</td><td><div class="c3">32</div></td><td></td><td></td><td></td><td></td><td><div>34</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $type = ref $obj;</td></tr>
<tr><td class="h">252</td><td><div class="c3">32</div></td><td><div class="c3" title="T/F"><a href="bin-cut-netspoc--branch.html#L252">100</a></div><div class="c0" title="T/-"><a href="bin-cut-netspoc--branch.html#L252">50</a></div><div class="c0" title="-/-"><a href="bin-cut-netspoc--branch.html#L252">0</a></div></td><td></td><td></td><td></td><td><div>51</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($type eq &#39;Network&#39;) {</td></tr>
<tr><td class="h">253</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Netspoc::debug &quot;Used $obj-&gt;{name}&quot;;</td></tr>
<tr><td class="h">254</td><td><div class="c3">27</div></td><td></td><td></td><td></td><td></td><td><div>56</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$obj-&gt;{is_used} = 1;</td></tr>
<tr><td class="h">255</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">256</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;elsif ($type eq &#39;Subnet&#39;) {</td></tr>
<tr><td class="h">257</td><td><div class="c3">5</div></td><td></td><td></td><td></td><td></td><td><div>7</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$obj-&gt;{network}-&gt;{is_used} = 1;</td></tr>
<tr><td class="h">258</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Netspoc::debug &quot;Used $obj-&gt;{network}-&gt;{name}&quot;;</td></tr>
<tr><td class="h">259</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">260</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;elsif ($type eq &#39;Interface&#39;) {</td></tr>
<tr><td class="h">261</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $router = $obj-&gt;{router};</td></tr>
<tr><td class="h">262</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Netspoc::debug &quot;Used $router-&gt;{name}&quot;;</td></tr>
<tr><td class="h">263</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$router-&gt;{is_used} = 1;</td></tr>
<tr><td class="h">264</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mark_adjacent_networks($router);</td></tr>
<tr><td class="h">265</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">266</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else {</td></tr>
<tr><td class="h">267</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fatal_err &quot;Unexpected type $type&quot;;</td></tr>
<tr><td class="h">268</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>
<tr><td class="h">269</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">270</td><td><div class="c3">16</div></td><td></td><td></td><td></td><td></td><td><div>44</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;path_walk($rule, \&amp;mark_topology);</td></tr>
<tr><td class="h">271</td><td><div class="c3">16</div></td><td><div class="c3" title="T/F"><a href="bin-cut-netspoc--branch.html#L271">100</a></div></td><td></td><td></td><td></td><td><div>35</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if($rule-&gt;{orig_prt}){</td></tr>
<tr><td class="h">272</td><td><div class="c3">11</div></td><td></td><td></td><td></td><td></td><td><div>28</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$rule-&gt;{orig_prt}-&gt;{is_used} = 1;</td></tr>
<tr><td class="h">273</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">274</td><td><div class="c3">5</div></td><td></td><td></td><td></td><td></td><td><div>10</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$rule-&gt;{prt}-&gt;{is_used} = 1;</td></tr>
<tr><td class="h">275</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">276</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">277</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">278</td><td><div class="c3">13</div></td><td></td><td></td><td></td><td></td><td><div>16</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return;</td></tr>
<tr><td class="h">279</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">280</td><td colspan="7"></td></tr><tr><td class="h">281</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># Mark parts of topology which are referenced by rules of services.</td></tr>
<tr><td class="h">282</td><td><div class="c3">13</div></td><td></td><td></td><td></td><td></td><td><div>25</div></td><td class="s">process_rules(\%expanded_rules);</td></tr>
<tr><td class="h">283</td><td colspan="7"></td></tr><tr><td class="h">284</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># Mark networks inside marked aggregates.</td></tr>
<tr><td class="h">285</td><td><div class="c3">13</div></td><td></td><td></td><td></td><td></td><td><div>21</div></td><td class="s">get_zones();</td></tr>
<tr><td class="h">286</td><td><div class="c3">13</div></td><td></td><td></td><td></td><td></td><td><div>19</div></td><td class="s">for my $zone (@all_zones) {</td></tr>
<tr><td class="h">287</td><td><div class="c3">30</div><div class="c3">30</div></td><td></td><td></td><td></td><td></td><td><div>31</div><div>68</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;for my $aggregate (values %{ $zone-&gt;{ipmask2aggregate} }) {</td></tr>
<tr><td class="h">288</td><td><div class="c3">5</div></td><td><div class="c3" title="T/F"><a href="bin-cut-netspoc--branch.html#L288">100</a></div></td><td></td><td></td><td></td><td><div>13</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if($aggregate-&gt;{is_used}) {</td></tr>
<tr><td class="h">289</td><td><div class="c3">3</div><div class="c3">3</div></td><td></td><td></td><td></td><td></td><td><div>2</div><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for my $network (@{ $aggregate-&gt;{networks} }) {</td></tr>
<tr><td class="h">290</td><td><div class="c3">5</div></td><td></td><td></td><td></td><td></td><td><div>10</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$network-&gt;{is_used} = 1;</td></tr>
<tr><td class="h">291</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">292</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">293</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">294</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">295</td><td colspan="7"></td></tr><tr><td class="h">296</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># Mark zones having attributes that influence their networks.</td></tr>
<tr><td class="h">297</td><td><div class="c3">13</div></td><td></td><td></td><td></td><td></td><td><div>23</div></td><td class="s">for my $network (values %networks) {</td></tr>
<tr><td class="h">298</td><td><div class="c3">45</div></td><td><div class="c3" title="T/F"><a href="bin-cut-netspoc--branch.html#L298">100</a></div></td><td></td><td></td><td></td><td><div>81</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$network-&gt;{is_used} or next;</td></tr>
<tr><td class="h">299</td><td><div class="c3">33</div></td><td></td><td></td><td></td><td></td><td><div>32</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $zone = $network-&gt;{zone};</td></tr>
<tr><td class="h">300</td><td><div class="c3">33</div></td><td></td><td></td><td></td><td></td><td><div>35</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $aggregate0 = $zone-&gt;{ipmask2aggregate}-&gt;{&#39;0/0&#39;};</td></tr>
<tr><td class="h">301</td><td colspan="7"></td></tr><tr><td class="h">302</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Simplifies test below.</td></tr>
<tr><td class="h">303</td><td><div class="c3">33</div></td><td></td><td></td><td></td><td></td><td><div>42</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$aggregate0-&gt;{owner} = $zone-&gt;{owner};</td></tr>
<tr><td class="h">304</td><td colspan="7"></td></tr><tr><td class="h">305</td><td><div class="c3">33</div><div class="c3">99</div></td><td><div class="c3" title="T/F"><a href="bin-cut-netspoc--branch.html#L305">100</a></div></td><td></td><td></td><td></td><td><div>35</div><div>155</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;grep { $zone-&gt;{$_} } qw(has_unenforceable nat no_in_acl) or next;</td></tr>
<tr><td class="h">306</td><td><div class="c3">2</div></td><td></td><td></td><td></td><td></td><td><div>3</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$aggregate0-&gt;{is_used} = 1;</td></tr>
<tr><td class="h">307</td><td><div class="c3">2</div></td><td></td><td></td><td></td><td></td><td><div>3</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$zone-&gt;{is_used} = 1;</td></tr>
<tr><td class="h">308</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">309</td><td colspan="7"></td></tr><tr><td class="h">310</td><td><div class="c3">13</div></td><td></td><td></td><td></td><td></td><td><div>22</div></td><td class="s">for my $zone (@all_zones) {</td></tr>
<tr><td class="h">311</td><td><div class="c3">30</div></td><td><div class="c3" title="T/F"><a href="bin-cut-netspoc--branch.html#L311">100</a></div></td><td></td><td></td><td></td><td><div>60</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$zone-&gt;{is_used} or next;</td></tr>
<tr><td class="h">312</td><td><div class="c3">2</div></td><td><div class="c3" title="T/F"><a href="bin-cut-netspoc--branch.html#L312">100</a></div></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if (my $link = $zone-&gt;{link}) {</td></tr>
<tr><td class="h">313</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td></td><td><div>2</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$link-&gt;{is_used} = 1;</td></tr>
<tr><td class="h">314</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">315</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">316</td><td colspan="7"></td></tr><tr><td class="h">317</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># Mark areas having attributes that influence their networks.</td></tr>
<tr><td class="h">318</td><td><div class="c3">13</div></td><td></td><td></td><td></td><td></td><td><div>22</div></td><td class="s">for my $zone (@all_zones) {</td></tr>
<tr><td class="h">319</td><td><div class="c3">30</div></td><td><div class="c3" title="T/F"><a href="bin-cut-netspoc--branch.html#L319">100</a></div></td><td></td><td></td><td></td><td><div>56</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$zone-&gt;{is_used} or next;</td></tr>
<tr><td class="h">320</td><td><div class="c3">2</div><div class="c3">2</div></td><td></td><td></td><td></td><td></td><td><div>2</div><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;for my $area (values %{ $zone-&gt;{areas} }) {</td></tr>
<tr><td class="h">321</td><td><div class="c3">1</div></td><td><div class="c0" title="-/F"><a href="bin-cut-netspoc--branch.html#L321">50</a></div></td><td></td><td></td><td></td><td><div>2</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$area-&gt;{nat} or next;</td></tr>
<tr><td class="h">322</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td></td><td><div>2</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$area-&gt;{is_used} = 1;</td></tr>
<tr><td class="h">323</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">324</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">325</td><td colspan="7"></td></tr><tr><td class="h">326</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># Mark interfaces which are referenced by areas.</td></tr>
<tr><td class="h">327</td><td><div class="c3">13</div></td><td></td><td></td><td></td><td></td><td><div>28</div></td><td class="s">for my $area (values %areas) {</td></tr>
<tr><td class="h">328</td><td><div class="c3">2</div></td><td><div class="c3" title="T/F"><a href="bin-cut-netspoc--branch.html#L328">100</a></div></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ($area-&gt;{is_used}) {</td></tr>
<tr><td class="h">329</td><td><div class="c3">1</div></td><td><div class="c0" title="-/F"><a href="bin-cut-netspoc--branch.html#L329">50</a></div></td><td></td><td></td><td></td><td><div>11</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (my $anchor = $area-&gt;{anchor}) {</td></tr>
<tr><td class="h">330</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$anchor-&gt;{is_used} = 1;</td></tr>
<tr><td class="h">331</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">332</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else {</td></tr>
<tr><td class="h">333</td><td><div class="c3">1</div><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td></td><td></td><td><div>1</div><div>1</div><div>3</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for my $interface (@{ $area-&gt;{border} }, </td></tr>
<tr><td class="h">334</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@{ $area-&gt;{inclusive_border} }) </td></tr>
<tr><td class="h">335</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td></tr>
<tr><td class="h">336</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td></td><td><div>1</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mark_topology(undef, $interface, undef);</td></tr>
<tr><td class="h">337</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">338</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">339</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">340</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">341</td><td colspan="7"></td></tr><tr><td class="h">342</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># Call this after topology has been marked.</td></tr>
<tr><td class="h">343</td><td><div class="c3">13</div></td><td></td><td></td><td></td><td></td><td><div>27</div></td><td class="s">&amp;expand_crypto();</td></tr>
<tr><td class="h">344</td><td colspan="7"></td></tr><tr><td class="h">345</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># 1. Call: Mark unmanaged parts of topology.</td></tr>
<tr><td class="h">346</td><td><div class="c3">13</div></td><td></td><td></td><td></td><td></td><td><div>24</div></td><td class="s">mark_unmanaged();</td></tr>
<tr><td class="h">347</td><td colspan="7"></td></tr><tr><td class="h">348</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># Mark fragments of marked crypto routers.</td></tr>
<tr><td class="h">349</td><td><div class="c3">13</div></td><td></td><td></td><td></td><td></td><td><div>25</div></td><td class="s">for my $router (values %routers) {</td></tr>
<tr><td class="h">350</td><td><div class="c3">28</div></td><td><div class="c3" title="T/F"><a href="bin-cut-netspoc--branch.html#L350">100</a></div></td><td></td><td></td><td></td><td><div>53</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$router-&gt;{is_used} or next;</td></tr>
<tr><td class="h">351</td><td><div class="c3">18</div></td><td></td><td></td><td></td><td></td><td><div>39</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;for my $interface (Netspoc::get_intf($router)) {</td></tr>
<tr><td class="h">352</td><td><div class="c3">43</div></td><td></td><td></td><td></td><td></td><td><div>42</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $fragment = $interface-&gt;{router};</td></tr>
<tr><td class="h">353</td><td><div class="c3">43</div></td><td><div class="c3" title="T/F"><a href="bin-cut-netspoc--branch.html#L353">100</a></div></td><td></td><td></td><td></td><td><div>114</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;next if $fragment eq $router;</td></tr>
<tr><td class="h">354</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Netspoc::debug &quot;Fragment: $fragment-&gt;{name}&quot;;</td></tr>
<tr><td class="h">355</td><td><div class="c3">5</div></td><td></td><td></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$fragment-&gt;{is_used} = 1;</td></tr>
<tr><td class="h">356</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">357</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">358</td><td colspan="7"></td></tr><tr><td class="h">359</td><td><div class="c3">13</div></td><td></td><td></td><td></td><td></td><td><div>24</div></td><td class="s">for my $router (values %routers) {</td></tr>
<tr><td class="h">360</td><td><div class="c3">28</div></td><td><div class="c3" title="T/F"><a href="bin-cut-netspoc--branch.html#L360">100</a></div></td><td></td><td></td><td></td><td><div>53</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;next unless $router-&gt;{is_used};</td></tr>
<tr><td class="h">361</td><td><div class="c3">18</div></td><td></td><td></td><td></td><td></td><td><div>32</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;for my $interface (Netspoc::get_intf($router)) {</td></tr>
<tr><td class="h">362</td><td colspan="7"></td></tr><tr><td class="h">363</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Mark networks referenced in attribute reroute_permit.</td></tr>
<tr><td class="h">364</td><td><div class="c3">43</div></td><td><div class="c3" title="T/F"><a href="bin-cut-netspoc--branch.html#L364">100</a></div></td><td></td><td></td><td></td><td><div>77</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($interface-&gt;{reroute_permit}) {</td></tr>
<tr><td class="h">365</td><td><div class="c3">2</div><div class="c3">2</div></td><td></td><td></td><td></td><td></td><td><div>2</div><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for my $net (@{ $interface-&gt;{reroute_permit} }) {</td></tr>
<tr><td class="h">366</td><td><div class="c3">2</div></td><td></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$net-&gt;{is_used} = 1;</td></tr>
<tr><td class="h">367</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">368</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">369</td><td colspan="7"></td></tr><tr><td class="h">370</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Mark crypto definitions which are referenced by</td></tr>
<tr><td class="h">371</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# already marked interfaces.&nbsp;&nbsp;</td></tr>
<tr><td class="h">372</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $mark_crypto = sub {</td></tr>
<tr><td class="h">373</td><td><div class="c3">7</div></td><td></td><td></td><td><div class="c3"><a href="bin-cut-netspoc--subroutine.html#L373">7</a></div></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my ($crypto) = @_;</td></tr>
<tr><td class="h">374</td><td><div class="c3">7</div></td><td></td><td></td><td></td><td></td><td><div>8</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$crypto-&gt;{is_used} = 1;</td></tr>
<tr><td class="h">375</td><td><div class="c3">7</div></td><td></td><td></td><td></td><td></td><td><div>7</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $type = $crypto-&gt;{type};</td></tr>
<tr><td class="h">376</td><td><div class="c3">7</div></td><td></td><td></td><td></td><td></td><td><div>7</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$type-&gt;{is_used} = 1;</td></tr>
<tr><td class="h">377</td><td><div class="c3">7</div></td><td></td><td></td><td></td><td></td><td><div>8</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$type-&gt;{key_exchange}-&gt;{is_used} = 1;</td></tr>
<tr><td class="h">378</td><td><div class="c3">43</div></td><td></td><td></td><td></td><td></td><td><div>95</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};</td></tr>
<tr><td class="h">379</td><td colspan="7"></td></tr><tr><td class="h">380</td><td><div class="c3">43</div></td><td><div class="c3" title="T/F"><a href="bin-cut-netspoc--branch.html#L380">100</a></div></td><td></td><td></td><td></td><td><div>147</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($interface-&gt;{ip} eq &#39;tunnel&#39;) {</td></tr>
<tr><td class="h">381</td><td><div class="c3">7</div></td><td></td><td></td><td></td><td></td><td><div>12</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$mark_crypto-&gt;($interface-&gt;{crypto});</td></tr>
<tr><td class="h">382</td><td><div class="c3">7</div></td><td></td><td></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $peers = $interface-&gt;{peers};</td></tr>
<tr><td class="h">383</td><td><div class="c3">7</div></td><td></td><td></td><td></td><td></td><td><div>8</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for my $peer (@$peers) {</td></tr>
<tr><td class="h">384</td><td><div class="c3">7</div></td><td></td><td></td><td></td><td></td><td><div>10</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mark_path($interface-&gt;{real_interface}, </td></tr>
<tr><td class="h">385</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$peer-&gt;{real_interface}); </td></tr>
<tr><td class="h">386</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">387</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">388</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">389</td><td colspan="7"></td></tr><tr><td class="h">390</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Mark radius servers referenced in attribute radius_servers.</td></tr>
<tr><td class="h">391</td><td><div class="c3">18</div></td><td><div class="c0" title="-/F"><a href="bin-cut-netspoc--branch.html#L391">50</a></div></td><td></td><td></td><td></td><td><div>47</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ($router-&gt;{radius_servers}) {</td></tr>
<tr><td class="h">392</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for my $host (@{$router-&gt;{radius_servers}}) {</td></tr>
<tr><td class="h">393</td><td colspan="7"></td></tr><tr><td class="h">394</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Take an arbitrary interface and get the interface </td></tr>
<tr><td class="h">395</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# in direction to $host.</td></tr>
<tr><td class="h">396</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my ($src) = </td></tr>
<tr><td class="h">397</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Netspoc::path_auto_interfaces($router-&gt;{interfaces}-&gt;[0], </td></tr>
<tr><td class="h">398</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$host);</td></tr>
<tr><td class="h">399</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mark_path($src, $host);</td></tr>
<tr><td class="h">400</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">401</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">402</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">403</td><td colspan="7"></td></tr><tr><td class="h">404</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># 2. Call: Mark unmanaged parts of topology.</td></tr>
<tr><td class="h">405</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># Mark paths between fragments of crypto routers now.</td></tr>
<tr><td class="h">406</td><td><div class="c3">13</div></td><td></td><td></td><td></td><td></td><td><div>20</div></td><td class="s">mark_unmanaged();</td></tr>
<tr><td class="h">407</td><td colspan="7"></td></tr><tr><td class="h">408</td><td><div class="c3">13</div></td><td></td><td></td><td></td><td></td><td><div>31</div></td><td class="s">for my $obj (values %areas, values %Netspoc::aggregates,</td></tr>
<tr><td class="h">409</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;values %networks, values %routers) </td></tr>
<tr><td class="h">410</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">{</td></tr>
<tr><td class="h">411</td><td><div class="c3">79</div></td><td><div class="c3" title="T/F"><a href="bin-cut-netspoc--branch.html#L411">100</a></div></td><td></td><td></td><td></td><td><div>120</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;next if not $obj-&gt;{is_used};</td></tr>
<tr><td class="h">412</td><td><div class="c3">65</div></td><td><div class="c3" title="T/F"><a href="bin-cut-netspoc--branch.html#L412">100</a></div></td><td></td><td></td><td></td><td><div>113</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if (my $owner = $obj-&gt;{owner}) {</td></tr>
<tr><td class="h">413</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$owner-&gt;{is_used} = 1;</td></tr>
<tr><td class="h">414</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">415</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">416</td><td colspan="7"></td></tr><tr><td class="h">417</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># Hosts are always printed, but are never marked as {is_used},</td></tr>
<tr><td class="h">418</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># because only subnets are marked. Hence check network.</td></tr>
<tr><td class="h">419</td><td><div class="c3">13</div></td><td></td><td></td><td></td><td></td><td><div>30</div></td><td class="s">for my $host (values %hosts) {</td></tr>
<tr><td class="h">420</td><td><div class="c3">15</div></td><td><div class="c3" title="T/F"><a href="bin-cut-netspoc--branch.html#L420">100</a></div></td><td></td><td></td><td></td><td><div>28</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;next if !$host-&gt;{network}-&gt;{is_used};</td></tr>
<tr><td class="h">421</td><td><div class="c3">13</div></td><td><div class="c0" title="-/F"><a href="bin-cut-netspoc--branch.html#L421">50</a></div></td><td></td><td></td><td></td><td><div>31</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if (my $owner = $host-&gt;{owner}) {</td></tr>
<tr><td class="h">422</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$owner-&gt;{is_used} = 1;</td></tr>
<tr><td class="h">423</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">424</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">425</td><td colspan="7"></td></tr><tr><td class="h">426</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># Interfaces are always printed, but not necessarily marked as {is_used}.</td></tr>
<tr><td class="h">427</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># Hence check network.</td></tr>
<tr><td class="h">428</td><td><div class="c3">13</div></td><td></td><td></td><td></td><td></td><td><div>24</div></td><td class="s">for my $interface (values %interfaces) {</td></tr>
<tr><td class="h">429</td><td><div class="c3">60</div></td><td><div class="c3" title="T/F"><a href="bin-cut-netspoc--branch.html#L429">100</a></div></td><td></td><td></td><td></td><td><div>92</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;next if !$interface-&gt;{router}-&gt;{is_used};</td></tr>
<tr><td class="h">430</td><td><div class="c3">47</div></td><td><div class="c0" title="-/F"><a href="bin-cut-netspoc--branch.html#L430">50</a></div></td><td></td><td></td><td></td><td><div>85</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if (my $owner = $interface-&gt;{owner}) {</td></tr>
<tr><td class="h">431</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$owner-&gt;{is_used} = 1;</td></tr>
<tr><td class="h">432</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">433</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">434</td><td><div class="c3">13</div></td><td></td><td></td><td></td><td></td><td><div>26</div></td><td class="s">for my $service (values %services) {</td></tr>
<tr><td class="h">435</td><td><div class="c3">14</div></td><td><div class="c0" title="-/F"><a href="bin-cut-netspoc--branch.html#L435">50</a></div></td><td></td><td></td><td></td><td><div>45</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if (my $owner = $service-&gt;{sub_owner}) {</td></tr>
<tr><td class="h">436</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$owner-&gt;{is_used} = 1;</td></tr>
<tr><td class="h">437</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">438</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>
<tr><td class="h">439</td><td><div class="c3">13</div></td><td></td><td></td><td></td><td></td><td><div>29</div></td><td class="s">for my $area (values %areas) {</td></tr>
<tr><td class="h">440</td><td><div class="c3">2</div></td><td><div class="c3" title="T/F"><a href="bin-cut-netspoc--branch.html#L440">100</a></div></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;next if not $area-&gt;{is_used};</td></tr>
<tr><td class="h">441</td><td><div class="c3">1</div></td><td><div class="c0" title="T/-"><a href="bin-cut-netspoc--branch.html#L441">50</a></div></td><td></td><td></td><td></td><td><div>2</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $router_attributes = $area-&gt;{router_attributes} or next;</td></tr>
<tr><td class="h">442</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="bin-cut-netspoc--branch.html#L442">0</a></div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if (my $owner = $router_attributes-&gt;{owner}) {</td></tr>
<tr><td class="h">443</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$owner-&gt;{is_used} = 1;</td></tr>
<tr><td class="h">444</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">445</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">446</td><td colspan="7"></td></tr><tr><td class="h">447</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub mark_watching_owners {</td></tr>
<tr><td class="h">448</td><td><div class="c3">5</div></td><td></td><td></td><td><div class="c3"><a href="bin-cut-netspoc--subroutine.html#L448">5</a></div></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ($owner) = @_;</td></tr>
<tr><td class="h">449</td><td><div class="c3">5</div></td><td><div class="c3" title="T/F"><a href="bin-cut-netspoc--branch.html#L449">100</a></div></td><td></td><td></td><td></td><td><div>12</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $watching_owners = $owner-&gt;{watching_owners} or return;</td></tr>
<tr><td class="h">450</td><td><div class="c3">2</div></td><td></td><td></td><td></td><td></td><td><div>2</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;for my $w_owner (@$watching_owners) {</td></tr>
<tr><td class="h">451</td><td><div class="c3">2</div></td><td></td><td></td><td></td><td></td><td><div>3</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$w_owner-&gt;{is_used} = 1;</td></tr>
<tr><td class="h">452</td><td><div class="c3">2</div></td><td></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mark_watching_owners($w_owner);</td></tr>
<tr><td class="h">453</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">454</td><td><div class="c3">2</div></td><td></td><td></td><td></td><td></td><td><div>3</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return;</td></tr>
<tr><td class="h">455</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">456</td><td colspan="7"></td></tr><tr><td class="h">457</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub by_index {</td></tr>
<tr><td class="h">458</td><td><div class="c3">162</div></td><td></td><td></td><td><div class="c3"><a href="bin-cut-netspoc--subroutine.html#L458">162</a></div></td><td></td><td><div>170</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $a-&gt;{src_index} &lt;=&gt; $b-&gt;{src_index}</td></tr>
<tr><td class="h">459</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">460</td><td colspan="7"></td></tr><tr><td class="h">461</td><td><div class="c3">13</div></td><td></td><td></td><td></td><td></td><td><div>23</div></td><td class="s">for my $owner (values %owners) {</td></tr>
<tr><td class="h">462</td><td><div class="c3">7</div></td><td><div class="c3" title="T/F"><a href="bin-cut-netspoc--branch.html#L462">100</a></div></td><td></td><td></td><td></td><td><div>13</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;next if not $owner-&gt;{is_used};</td></tr>
<tr><td class="h">463</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;mark_watching_owners($owner);</td></tr>
<tr><td class="h">464</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>
<tr><td class="h">465</td><td colspan="7"></td></tr><tr><td class="h">466</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># Print marked parts of netspoc configuration.</td></tr>
<tr><td class="h">467</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># Routers and networks have been marked by mark_topology.</td></tr>
<tr><td class="h">468</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># Protocols have been marked while %expanded_rules have been processed above.</td></tr>
<tr><td class="h">469</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># Groups and protocolroups objects have been marked during expand_services.</td></tr>
<tr><td class="h">470</td><td><div class="c3">13</div><div class="c3">108</div></td><td><div class="c3" title="T/F"><a href="bin-cut-netspoc--branch.html#L470">100</a></div></td><td></td><td></td><td></td><td><div>57</div><div>187</div></td><td class="s">for my $object ( sort by_index map { $_-&gt;{src_index} ? ($_) : () }</td></tr>
<tr><td class="h">471</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;values %routers,</td></tr>
<tr><td class="h">472</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;values %networks,</td></tr>
<tr><td class="h">473</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;values %Netspoc::aggregates,</td></tr>
<tr><td class="h">474</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;values %areas,</td></tr>
<tr><td class="h">475</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;values %groups,</td></tr>
<tr><td class="h">476</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;values %protocols,</td></tr>
<tr><td class="h">477</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;values %protocolgroups,</td></tr>
<tr><td class="h">478</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;values %isakmp,</td></tr>
<tr><td class="h">479</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;values %ipsec,</td></tr>
<tr><td class="h">480</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;values %crypto,</td></tr>
<tr><td class="h">481</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;values %owners</td></tr>
<tr><td class="h">482</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;)</td></tr>
<tr><td class="h">483</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">{</td></tr>
<tr><td class="h">484</td><td><div class="c3">88</div></td><td><div class="c3" title="T/F"><a href="bin-cut-netspoc--branch.html#L484">100</a></div></td><td></td><td></td><td></td><td><div>137</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ($object-&gt;{is_used}) {</td></tr>
<tr><td class="h">485</td><td colspan="7"></td></tr><tr><td class="h">486</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# There are some internal objects without src_code.</td></tr>
<tr><td class="h">487</td><td><div class="c3">72</div></td><td><div class="c0" title="T/-"><a href="bin-cut-netspoc--branch.html#L487">50</a></div></td><td></td><td></td><td></td><td><div>108</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (my $src_code = $object-&gt;{src_code}) {</td></tr>
<tr><td class="h">488</td><td><div class="c3">72</div></td><td></td><td></td><td></td><td></td><td><div>167</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print $src_code, &quot;\n&quot;;</td></tr>
<tr><td class="h">489</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">490</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">491</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">492</td><td colspan="7"></td></tr><tr><td class="h">493</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># Source of pathrestrictions can&#39;t be used literally,</td></tr>
<tr><td class="h">494</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># but must be reconstructed from internal data structure.</td></tr>
<tr><td class="h">495</td><td><div class="c3">13</div></td><td></td><td></td><td></td><td></td><td><div>43</div></td><td class="s">for my $restrict (sort by_index values %pathrestrictions) {</td></tr>
<tr><td class="h">496</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $used = 0;</td></tr>
<tr><td class="h">497</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;for my $interface (@{ $restrict-&gt;{elements} }) {</td></tr>
<tr><td class="h">498</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="bin-cut-netspoc--branch.html#L498">0</a></div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($interface-&gt;{router}-&gt;{is_used}) {</td></tr>
<tr><td class="h">499</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$used++;</td></tr>
<tr><td class="h">500</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">501</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else {</td></tr>
<tr><td class="h">502</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$interface = undef;</td></tr>
<tr><td class="h">503</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">504</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">505</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="bin-cut-netspoc--branch.html#L505">0</a></div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;next if $used &lt; 2;</td></tr>
<tr><td class="h">506</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;print &quot;$restrict-&gt;{name} =\n&quot;;</td></tr>
<tr><td class="h">507</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;for my $interface (@{ $restrict-&gt;{elements} }) {</td></tr>
<tr><td class="h">508</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="bin-cut-netspoc--branch.html#L508">0</a></div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;next unless $interface;</td></tr>
<tr><td class="h">509</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="bin-cut-netspoc--branch.html#L509">0</a></div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;next if $interface-&gt;{ip} eq &#39;tunnel&#39;;</td></tr>
<tr><td class="h">510</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print &quot; $interface-&gt;{name},\n&quot;;</td></tr>
<tr><td class="h">511</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">512</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;print &quot;;\n&quot;;</td></tr>
<tr><td class="h">513</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">514</td><td colspan="7"></td></tr><tr><td class="h">515</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># All unwanted services have already been deleted above.</td></tr>
<tr><td class="h">516</td><td><div class="c3">13</div></td><td></td><td></td><td></td><td></td><td><div>33</div></td><td class="s">for my $service (sort by_index values %services) {</td></tr>
<tr><td class="h">517</td><td><div class="c3">14</div></td><td></td><td></td><td></td><td></td><td><div>2</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;print $service-&gt;{src_code}, &quot;\n&quot;;</td></tr>
<tr><td class="h">518</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
</table>
</body>
</html>
