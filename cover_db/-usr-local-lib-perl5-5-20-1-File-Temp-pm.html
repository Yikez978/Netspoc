<!DOCTYPE html
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<!--
This file was generated by Devel::Cover Version 1.17
Devel::Cover is copyright 2001-2012, Paul Johnson (paul@pjcj.net)
Devel::Cover is free. It is licensed under the same terms as Perl itself.
The latest version of Devel::Cover should be available from my homepage:
http://www.pjcj.net
-->
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
    <meta http-equiv="Content-Language" content="en-us"></meta>
    <link rel="stylesheet" type="text/css" href="cover.css"></link>
    <link rel="stylesheet" type="text/css" href="cover.css"></link>
    <title>File Coverage: /usr/local/lib/perl5/5.20.1/File/Temp.pm</title>
</head>
<body>
<h1>File Coverage</h1>
<table>
<tr><td class="h" align="right">File:</td><td align="left">/usr/local/lib/perl5/5.20.1/File/Temp.pm</td></tr>
<tr><td class="h" align="right">Coverage:</td><td align="left" class="c0">47.1%</td></tr>
</table>
<div><br/></div>
<table>
<tr><th>line</th><th>stmt</th><th>bran</th><th>cond</th><th>sub</th><th>pod</th><th>time</th><th>code</th></tr>
<tr><td class="h">1</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">package File::Temp;</td></tr>
<tr><td class="h">2</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># ABSTRACT: return name and handle of a temporary file safely</td></tr>
<tr><td class="h">3</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">our $VERSION = &#39;0.2304&#39;; # VERSION</td></tr>
<tr><td class="h">4</td><td colspan="7"></td></tr><tr><td class="h">5</td><td colspan="7"></td></tr><tr><td class="h">6</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># Toolchain targets v5.8.1, but we&#39;ll try to support back to v5.6 anyway.</td></tr>
<tr><td class="h">7</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># It might be possible to make this v5.5, but many v5.6isms are creeping</td></tr>
<tr><td class="h">8</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># into the code and tests.</td></tr>
<tr><td class="h">9</td><td><div class="c3">44</div><div class="c3">44</div><div class="c3">44</div></td><td></td><td></td><td><div class="c3"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--subroutine.html#L9">44</a></div></td><td></td><td><div>514</div><div>98</div><div>1317</div></td><td class="s">use 5.006;</td></tr>
<tr><td class="h">10</td><td><div class="c3">44</div><div class="c3">44</div><div class="c3">44</div></td><td></td><td></td><td><div class="c3"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--subroutine.html#L10">44</a></div></td><td></td><td><div>163</div><div>54</div><div>919</div></td><td class="s">use strict;</td></tr>
<tr><td class="h">11</td><td><div class="c3">44</div><div class="c3">44</div><div class="c3">44</div></td><td></td><td></td><td><div class="c3"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--subroutine.html#L11">44</a></div></td><td></td><td><div>159</div><div>42</div><div>1889</div></td><td class="s">use Carp;</td></tr>
<tr><td class="h">12</td><td><div class="c3">44</div><div class="c3">44</div><div class="c3">44</div></td><td></td><td></td><td><div class="c3"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--subroutine.html#L12">44</a></div></td><td></td><td><div>189</div><div>678</div><div>692</div></td><td class="s">use File::Spec 0.8;</td></tr>
<tr><td class="h">13</td><td><div class="c3">44</div><div class="c3">44</div><div class="c3">44</div></td><td></td><td></td><td><div class="c3"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--subroutine.html#L13">44</a></div></td><td></td><td><div>164</div><div>49</div><div>790</div></td><td class="s">use Cwd ();</td></tr>
<tr><td class="h">14</td><td><div class="c3">44</div><div class="c3">44</div><div class="c3">44</div></td><td></td><td></td><td><div class="c3"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--subroutine.html#L14">44</a></div></td><td></td><td><div>152</div><div>578</div><div>1748</div></td><td class="s">use File::Path 2.06 qw/ rmtree /;</td></tr>
<tr><td class="h">15</td><td><div class="c3">44</div><div class="c3">44</div><div class="c3">44</div></td><td></td><td></td><td><div class="c3"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--subroutine.html#L15">44</a></div></td><td></td><td><div>169</div><div>533</div><div>9399</div></td><td class="s">use Fcntl 1.03;</td></tr>
<tr><td class="h">16</td><td><div class="c3">44</div><div class="c3">44</div><div class="c3">44</div></td><td></td><td></td><td><div class="c3"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--subroutine.html#L16">44</a></div></td><td></td><td><div>8905</div><div>64</div><div>1810</div></td><td class="s">use IO::Seekable;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# For SEEK_*</td></tr>
<tr><td class="h">17</td><td><div class="c3">44</div><div class="c3">44</div><div class="c3">44</div></td><td></td><td></td><td><div class="c3"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--subroutine.html#L17">44</a></div></td><td></td><td><div>8580</div><div>72</div><div>1400</div></td><td class="s">use Errno;</td></tr>
<tr><td class="h">18</td><td><div class="c3">44</div><div class="c3">44</div><div class="c3">44</div></td><td></td><td></td><td><div class="c3"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--subroutine.html#L18">44</a></div></td><td></td><td><div>174</div><div>41</div><div>4005</div></td><td class="s">use Scalar::Util &#39;refaddr&#39;;</td></tr>
<tr><td class="h">19</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">require VMS::Stdio if $^O eq &#39;VMS&#39;;</td></tr>
<tr><td class="h">20</td><td colspan="7"></td></tr><tr><td class="h">21</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># pre-emptively load Carp::Heavy. If we don&#39;t when we run out of file</td></tr>
<tr><td class="h">22</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># handles and attempt to call croak() we get an error message telling</td></tr>
<tr><td class="h">23</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># us that Carp::Heavy won&#39;t load rather than an error telling us we</td></tr>
<tr><td class="h">24</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># have run out of file handles. We either preload croak() or we</td></tr>
<tr><td class="h">25</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># switch the calls to croak from _gettemp() to use die.</td></tr>
<tr><td class="h">26</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">eval { require Carp::Heavy; };</td></tr>
<tr><td class="h">27</td><td colspan="7"></td></tr><tr><td class="h">28</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># Need the Symbol package if we are running older perl</td></tr>
<tr><td class="h">29</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">require Symbol if $] &lt; 5.006;</td></tr>
<tr><td class="h">30</td><td colspan="7"></td></tr><tr><td class="h">31</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">### For the OO interface</td></tr>
<tr><td class="h">32</td><td><div class="c3">44</div><div class="c3">44</div><div class="c3">44</div></td><td></td><td></td><td><div class="c3"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--subroutine.html#L32">44</a></div></td><td></td><td><div>7759</div><div>879</div><div>175</div></td><td class="s">use parent 0.221 qw/ IO::Handle IO::Seekable /;</td></tr>
<tr><td class="h">33</td><td><div class="c3">44</div></td><td></td><td></td><td></td><td></td><td><div>2424</div></td><td class="s">use overload &#39;&quot;&quot;&#39; =&gt; &quot;STRINGIFY&quot;, &#39;0+&#39; =&gt; &quot;NUMIFY&quot;,</td></tr>
<tr><td class="h">34</td><td><div class="c3">44</div><div class="c3">44</div></td><td></td><td></td><td><div class="c3"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--subroutine.html#L34">44</a></div></td><td></td><td><div>160</div><div>43</div></td><td class="s">&nbsp;&nbsp;fallback =&gt; 1;</td></tr>
<tr><td class="h">35</td><td colspan="7"></td></tr><tr><td class="h">36</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># use &#39;our&#39; on v5.6.0</td></tr>
<tr><td class="h">37</td><td><div class="c3">44</div><div class="c3">44</div><div class="c3">44</div></td><td></td><td></td><td><div class="c3"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--subroutine.html#L37">44</a></div></td><td></td><td><div>163</div><div>44</div><div>2564</div></td><td class="s">use vars qw(@EXPORT_OK %EXPORT_TAGS $DEBUG $KEEP_ALL);</td></tr>
<tr><td class="h">38</td><td colspan="7"></td></tr><tr><td class="h">39</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">$DEBUG = 0;</td></tr>
<tr><td class="h">40</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">$KEEP_ALL = 0;</td></tr>
<tr><td class="h">41</td><td colspan="7"></td></tr><tr><td class="h">42</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># We are exporting functions</td></tr>
<tr><td class="h">43</td><td colspan="7"></td></tr><tr><td class="h">44</td><td><div class="c3">44</div><div class="c3">44</div><div class="c3">44</div></td><td></td><td></td><td><div class="c3"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--subroutine.html#L44">44</a></div></td><td></td><td><div>181</div><div>603</div><div>4340</div></td><td class="s">use Exporter 5.57 &#39;import&#39;;&nbsp;&nbsp;&nbsp;# 5.57 lets us import &#39;import&#39;</td></tr>
<tr><td class="h">45</td><td colspan="7"></td></tr><tr><td class="h">46</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># Export list - to allow fine tuning of export table</td></tr>
<tr><td class="h">47</td><td colspan="7"></td></tr><tr><td class="h">48</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">@EXPORT_OK = qw{</td></tr>
<tr><td class="h">49</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tempfile</td></tr>
<tr><td class="h">50</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tempdir</td></tr>
<tr><td class="h">51</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tmpnam</td></tr>
<tr><td class="h">52</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tmpfile</td></tr>
<tr><td class="h">53</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mktemp</td></tr>
<tr><td class="h">54</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mkstemp</td></tr>
<tr><td class="h">55</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mkstemps</td></tr>
<tr><td class="h">56</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mkdtemp</td></tr>
<tr><td class="h">57</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unlink0</td></tr>
<tr><td class="h">58</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cleanup</td></tr>
<tr><td class="h">59</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SEEK_SET</td></tr>
<tr><td class="h">60</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SEEK_CUR</td></tr>
<tr><td class="h">61</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SEEK_END</td></tr>
<tr><td class="h">62</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};</td></tr>
<tr><td class="h">63</td><td colspan="7"></td></tr><tr><td class="h">64</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># Groups of functions for export</td></tr>
<tr><td class="h">65</td><td colspan="7"></td></tr><tr><td class="h">66</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">%EXPORT_TAGS = (</td></tr>
<tr><td class="h">67</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;POSIX&#39; =&gt; [qw/ tmpnam tmpfile /],</td></tr>
<tr><td class="h">68</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;mktemp&#39; =&gt; [qw/ mktemp mkstemp mkstemps mkdtemp/],</td></tr>
<tr><td class="h">69</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;seekable&#39; =&gt; [qw/ SEEK_SET SEEK_CUR SEEK_END /],</td></tr>
<tr><td class="h">70</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</td></tr>
<tr><td class="h">71</td><td colspan="7"></td></tr><tr><td class="h">72</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># add contents of these tags to @EXPORT</td></tr>
<tr><td class="h">73</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">Exporter::export_tags(&#39;POSIX&#39;,&#39;mktemp&#39;,&#39;seekable&#39;);</td></tr>
<tr><td class="h">74</td><td colspan="7"></td></tr><tr><td class="h">75</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># This is a list of characters that can be used in random filenames</td></tr>
<tr><td class="h">76</td><td colspan="7"></td></tr><tr><td class="h">77</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">my @CHARS = (qw/ A B C D E F G H I J K L M N O P Q R S T U V W X Y Z</td></tr>
<tr><td class="h">78</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a b c d e f g h i j k l m n o p q r s t u v w x y z</td></tr>
<tr><td class="h">79</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0 1 2 3 4 5 6 7 8 9 _</td></tr>
<tr><td class="h">80</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/);</td></tr>
<tr><td class="h">81</td><td colspan="7"></td></tr><tr><td class="h">82</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># Maximum number of tries to make a temp file before failing</td></tr>
<tr><td class="h">83</td><td colspan="7"></td></tr><tr><td class="h">84</td><td><div class="c3">44</div><div class="c3">44</div><div class="c3">44</div></td><td></td><td></td><td><div class="c3"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--subroutine.html#L84">44</a></div></td><td></td><td><div>177</div><div>61</div><div>1685</div></td><td class="s">use constant MAX_TRIES =&gt; 1000;</td></tr>
<tr><td class="h">85</td><td colspan="7"></td></tr><tr><td class="h">86</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># Minimum number of X characters that should be in a template</td></tr>
<tr><td class="h">87</td><td><div class="c3">44</div><div class="c3">44</div><div class="c3">44</div></td><td></td><td></td><td><div class="c3"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--subroutine.html#L87">44</a></div></td><td></td><td><div>170</div><div>59</div><div>1591</div></td><td class="s">use constant MINX =&gt; 4;</td></tr>
<tr><td class="h">88</td><td colspan="7"></td></tr><tr><td class="h">89</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># Default template when no template supplied</td></tr>
<tr><td class="h">90</td><td colspan="7"></td></tr><tr><td class="h">91</td><td><div class="c3">44</div><div class="c3">44</div><div class="c3">44</div></td><td></td><td></td><td><div class="c3"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--subroutine.html#L91">44</a></div></td><td></td><td><div>168</div><div>42</div><div>1385</div></td><td class="s">use constant TEMPXXX =&gt; &#39;X&#39; x 10;</td></tr>
<tr><td class="h">92</td><td colspan="7"></td></tr><tr><td class="h">93</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># Constants for the security level</td></tr>
<tr><td class="h">94</td><td colspan="7"></td></tr><tr><td class="h">95</td><td><div class="c3">44</div><div class="c3">44</div><div class="c3">44</div></td><td></td><td></td><td><div class="c3"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--subroutine.html#L95">44</a></div></td><td></td><td><div>162</div><div>42</div><div>1311</div></td><td class="s">use constant STANDARD =&gt; 0;</td></tr>
<tr><td class="h">96</td><td><div class="c3">44</div><div class="c3">44</div><div class="c3">44</div></td><td></td><td></td><td><div class="c3"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--subroutine.html#L96">44</a></div></td><td></td><td><div>156</div><div>45</div><div>1303</div></td><td class="s">use constant MEDIUM&nbsp;&nbsp;&nbsp;=&gt; 1;</td></tr>
<tr><td class="h">97</td><td><div class="c3">44</div><div class="c3">44</div><div class="c3">44</div></td><td></td><td></td><td><div class="c3"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--subroutine.html#L97">44</a></div></td><td></td><td><div>165</div><div>41</div><div>3672</div></td><td class="s">use constant HIGH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; 2;</td></tr>
<tr><td class="h">98</td><td colspan="7"></td></tr><tr><td class="h">99</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># OPENFLAGS. If we defined the flag to use with Sysopen here this gives</td></tr>
<tr><td class="h">100</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># us an optimisation when many temporary files are requested</td></tr>
<tr><td class="h">101</td><td colspan="7"></td></tr><tr><td class="h">102</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">my $OPENFLAGS = O_CREAT | O_EXCL | O_RDWR;</td></tr>
<tr><td class="h">103</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">my $LOCKFLAG;</td></tr>
<tr><td class="h">104</td><td colspan="7"></td></tr><tr><td class="h">105</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">unless ($^O eq &#39;MacOS&#39;) {</td></tr>
<tr><td class="h">106</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;for my $oflag (qw/ NOFOLLOW BINARY LARGEFILE NOINHERIT /) {</td></tr>
<tr><td class="h">107</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ($bit, $func) = (0, &quot;Fcntl::O_&quot; . $oflag);</td></tr>
<tr><td class="h">108</td><td><div class="c3">44</div><div class="c3">44</div><div class="c3">44</div></td><td></td><td></td><td><div class="c3"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--subroutine.html#L108">44</a></div></td><td></td><td><div>174</div><div>47</div><div>6010</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;no strict &#39;refs&#39;;</td></tr>
<tr><td class="h">109</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$OPENFLAGS |= $bit if eval {</td></tr>
<tr><td class="h">110</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Make sure that redefined die handlers do not cause problems</td></tr>
<tr><td class="h">111</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# e.g. CGI::Carp</td></tr>
<tr><td class="h">112</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;local $SIG{__DIE__} = sub {};</td></tr>
<tr><td class="h">113</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;local $SIG{__WARN__} = sub {};</td></tr>
<tr><td class="h">114</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$bit = &amp;$func();</td></tr>
<tr><td class="h">115</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1;</td></tr>
<tr><td class="h">116</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;};</td></tr>
<tr><td class="h">117</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">118</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Special case O_EXLOCK</td></tr>
<tr><td class="h">119</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;$LOCKFLAG = eval {</td></tr>
<tr><td class="h">120</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;local $SIG{__DIE__} = sub {};</td></tr>
<tr><td class="h">121</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;local $SIG{__WARN__} = sub {};</td></tr>
<tr><td class="h">122</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&amp;Fcntl::O_EXLOCK();</td></tr>
<tr><td class="h">123</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;};</td></tr>
<tr><td class="h">124</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">125</td><td colspan="7"></td></tr><tr><td class="h">126</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># On some systems the O_TEMPORARY flag can be used to tell the OS</td></tr>
<tr><td class="h">127</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># to automatically remove the file when it is closed. This is fine</td></tr>
<tr><td class="h">128</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># in most cases but not if tempfile is called with UNLINK=&gt;0 and</td></tr>
<tr><td class="h">129</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># the filename is requested -- in the case where the filename is to</td></tr>
<tr><td class="h">130</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># be passed to another routine. This happens on windows. We overcome</td></tr>
<tr><td class="h">131</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># this by using a second open flags variable</td></tr>
<tr><td class="h">132</td><td colspan="7"></td></tr><tr><td class="h">133</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">my $OPENTEMPFLAGS = $OPENFLAGS;</td></tr>
<tr><td class="h">134</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">unless ($^O eq &#39;MacOS&#39;) {</td></tr>
<tr><td class="h">135</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;for my $oflag (qw/ TEMPORARY /) {</td></tr>
<tr><td class="h">136</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ($bit, $func) = (0, &quot;Fcntl::O_&quot; . $oflag);</td></tr>
<tr><td class="h">137</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;local($@);</td></tr>
<tr><td class="h">138</td><td><div class="c3">44</div><div class="c3">44</div><div class="c3">44</div></td><td></td><td></td><td><div class="c3"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--subroutine.html#L138">44</a></div></td><td></td><td><div>177</div><div>40</div><div>206471</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;no strict &#39;refs&#39;;</td></tr>
<tr><td class="h">139</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$OPENTEMPFLAGS |= $bit if eval {</td></tr>
<tr><td class="h">140</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Make sure that redefined die handlers do not cause problems</td></tr>
<tr><td class="h">141</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# e.g. CGI::Carp</td></tr>
<tr><td class="h">142</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;local $SIG{__DIE__} = sub {};</td></tr>
<tr><td class="h">143</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;local $SIG{__WARN__} = sub {};</td></tr>
<tr><td class="h">144</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$bit = &amp;$func();</td></tr>
<tr><td class="h">145</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1;</td></tr>
<tr><td class="h">146</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;};</td></tr>
<tr><td class="h">147</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">148</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">149</td><td colspan="7"></td></tr><tr><td class="h">150</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># Private hash tracking which files have been created by each process id via the OO interface</td></tr>
<tr><td class="h">151</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">my %FILES_CREATED_BY_OBJECT;</td></tr>
<tr><td class="h">152</td><td colspan="7"></td></tr><tr><td class="h">153</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># INTERNAL ROUTINES - not to be used outside of package</td></tr>
<tr><td class="h">154</td><td colspan="7"></td></tr><tr><td class="h">155</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># Generic routine for getting a temporary filename</td></tr>
<tr><td class="h">156</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># modelled on OpenBSD _gettemp() in mktemp.c</td></tr>
<tr><td class="h">157</td><td colspan="7"></td></tr><tr><td class="h">158</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># The template must contain X&#39;s that are to be replaced</td></tr>
<tr><td class="h">159</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># with the random values</td></tr>
<tr><td class="h">160</td><td colspan="7"></td></tr><tr><td class="h">161</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#&nbsp;&nbsp;Arguments:</td></tr>
<tr><td class="h">162</td><td colspan="7"></td></tr><tr><td class="h">163</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#&nbsp;&nbsp;TEMPLATE&nbsp;&nbsp;&nbsp;- string containing the XXXXX&#39;s that is converted</td></tr>
<tr><td class="h">164</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;to a random filename and opened if required</td></tr>
<tr><td class="h">165</td><td colspan="7"></td></tr><tr><td class="h">166</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># Optionally, a hash can also be supplied containing specific options</td></tr>
<tr><td class="h">167</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#&nbsp;&nbsp;&nbsp;&quot;open&quot; =&gt; if true open the temp file, else just return the name</td></tr>
<tr><td class="h">168</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;default is 0</td></tr>
<tr><td class="h">169</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#&nbsp;&nbsp;&nbsp;&quot;mkdir&quot;=&gt; if true, we are creating a temp directory rather than tempfile</td></tr>
<tr><td class="h">170</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;default is 0</td></tr>
<tr><td class="h">171</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#&nbsp;&nbsp;&nbsp;&quot;suffixlen&quot; =&gt; number of characters at end of PATH to be ignored.</td></tr>
<tr><td class="h">172</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;default is 0.</td></tr>
<tr><td class="h">173</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#&nbsp;&nbsp;&nbsp;&quot;unlink_on_close&quot; =&gt; indicates that, if possible,&nbsp;&nbsp;the OS should remove</td></tr>
<tr><td class="h">174</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the file as soon as it is closed. Usually indicates</td></tr>
<tr><td class="h">175</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;use of the O_TEMPORARY flag to sysopen.</td></tr>
<tr><td class="h">176</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Usually irrelevant on unix</td></tr>
<tr><td class="h">177</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#&nbsp;&nbsp;&nbsp;&quot;use_exlock&quot; =&gt; Indicates that O_EXLOCK should be used. Default is true.</td></tr>
<tr><td class="h">178</td><td colspan="7"></td></tr><tr><td class="h">179</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># Optionally a reference to a scalar can be passed into the function</td></tr>
<tr><td class="h">180</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># On error this will be used to store the reason for the error</td></tr>
<tr><td class="h">181</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#&nbsp;&nbsp;&nbsp;&quot;ErrStr&quot;&nbsp;&nbsp;=&gt; \$errstr</td></tr>
<tr><td class="h">182</td><td colspan="7"></td></tr><tr><td class="h">183</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># &quot;open&quot; and &quot;mkdir&quot; can not both be true</td></tr>
<tr><td class="h">184</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># &quot;unlink_on_close&quot; is not used when &quot;mkdir&quot; is true.</td></tr>
<tr><td class="h">185</td><td colspan="7"></td></tr><tr><td class="h">186</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># The default options are equivalent to mktemp().</td></tr>
<tr><td class="h">187</td><td colspan="7"></td></tr><tr><td class="h">188</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># Returns:</td></tr>
<tr><td class="h">189</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#&nbsp;&nbsp;&nbsp;filehandle - open file handle (if called with doopen=1, else undef)</td></tr>
<tr><td class="h">190</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#&nbsp;&nbsp;&nbsp;temp name&nbsp;&nbsp;- name of the temp file or directory</td></tr>
<tr><td class="h">191</td><td colspan="7"></td></tr><tr><td class="h">192</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># For example:</td></tr>
<tr><td class="h">193</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#&nbsp;&nbsp;&nbsp;($fh, $name) = _gettemp($template, &quot;open&quot; =&gt; 1);</td></tr>
<tr><td class="h">194</td><td colspan="7"></td></tr><tr><td class="h">195</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># for the current version, failures are associated with</td></tr>
<tr><td class="h">196</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># stored in an error string and returned to give the reason whilst debugging</td></tr>
<tr><td class="h">197</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># This routine is not called by any external function</td></tr>
<tr><td class="h">198</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _gettemp {</td></tr>
<tr><td class="h">199</td><td colspan="7"></td></tr><tr><td class="h">200</td><td><div class="c3">838</div></td><td><div class="c0" title="-/F"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L200">50</a></div></td><td></td><td><div class="c3"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--subroutine.html#L200">838</a></div></td><td></td><td><div>1534</div></td><td class="s">&nbsp;&nbsp;croak &#39;Usage: ($fh, $name) = _gettemp($template, OPTIONS);&#39;</td></tr>
<tr><td class="h">201</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;unless scalar(@_) &gt;= 1;</td></tr>
<tr><td class="h">202</td><td colspan="7"></td></tr><tr><td class="h">203</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# the internal error string - expect it to be overridden</td></tr>
<tr><td class="h">204</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Need this in case the caller decides not to supply us a value</td></tr>
<tr><td class="h">205</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# need an anonymous scalar</td></tr>
<tr><td class="h">206</td><td><div class="c3">838</div></td><td></td><td></td><td></td><td></td><td><div>671</div></td><td class="s">&nbsp;&nbsp;my $tempErrStr;</td></tr>
<tr><td class="h">207</td><td colspan="7"></td></tr><tr><td class="h">208</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Default options</td></tr>
<tr><td class="h">209</td><td><div class="c3">838</div></td><td></td><td></td><td></td><td></td><td><div>2700</div></td><td class="s">&nbsp;&nbsp;my %options = (</td></tr>
<tr><td class="h">210</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;open&quot; =&gt; 0,</td></tr>
<tr><td class="h">211</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;mkdir&quot; =&gt; 0,</td></tr>
<tr><td class="h">212</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;suffixlen&quot; =&gt; 0,</td></tr>
<tr><td class="h">213</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;unlink_on_close&quot; =&gt; 0,</td></tr>
<tr><td class="h">214</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;use_exlock&quot; =&gt; 1,</td></tr>
<tr><td class="h">215</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;ErrStr&quot; =&gt; \$tempErrStr,</td></tr>
<tr><td class="h">216</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</td></tr>
<tr><td class="h">217</td><td colspan="7"></td></tr><tr><td class="h">218</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Read the template</td></tr>
<tr><td class="h">219</td><td><div class="c3">838</div></td><td></td><td></td><td></td><td></td><td><div>918</div></td><td class="s">&nbsp;&nbsp;my $template = shift;</td></tr>
<tr><td class="h">220</td><td><div class="c3">838</div></td><td><div class="c0" title="-/F"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L220">50</a></div></td><td></td><td></td><td></td><td><div>1355</div></td><td class="s">&nbsp;&nbsp;if (ref($template)) {</td></tr>
<tr><td class="h">221</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Use a warning here since we have not yet merged ErrStr</td></tr>
<tr><td class="h">222</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;carp &quot;File::Temp::_gettemp: template must not be a reference&quot;;</td></tr>
<tr><td class="h">223</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return ();</td></tr>
<tr><td class="h">224</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">225</td><td colspan="7"></td></tr><tr><td class="h">226</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Check that the number of entries on stack are even</td></tr>
<tr><td class="h">227</td><td><div class="c3">838</div></td><td><div class="c0" title="-/F"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L227">50</a></div></td><td></td><td></td><td></td><td><div>1536</div></td><td class="s">&nbsp;&nbsp;if (scalar(@_) % 2 != 0) {</td></tr>
<tr><td class="h">228</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Use a warning here since we have not yet merged ErrStr</td></tr>
<tr><td class="h">229</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;carp &quot;File::Temp::_gettemp: Must have even number of options&quot;;</td></tr>
<tr><td class="h">230</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return ();</td></tr>
<tr><td class="h">231</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">232</td><td colspan="7"></td></tr><tr><td class="h">233</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Read the options and merge with defaults</td></tr>
<tr><td class="h">234</td><td><div class="c3">838</div></td><td><div class="c0" title="T/-"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L234">50</a></div></td><td></td><td></td><td></td><td><div>5549</div></td><td class="s">&nbsp;&nbsp;%options = (%options, @_)&nbsp;&nbsp;if @_;</td></tr>
<tr><td class="h">235</td><td colspan="7"></td></tr><tr><td class="h">236</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Make sure the error string is set to undef</td></tr>
<tr><td class="h">237</td><td><div class="c3">838</div><div class="c3">838</div></td><td></td><td></td><td></td><td></td><td><div>1497</div><div>1084</div></td><td class="s">&nbsp;&nbsp;${$options{ErrStr}} = undef;</td></tr>
<tr><td class="h">238</td><td colspan="7"></td></tr><tr><td class="h">239</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Can not open the file and make a directory in a single call</td></tr>
<tr><td class="h">240</td><td><div class="c3">838</div></td><td><div class="c0" title="-/F"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L240">50</a></div></td><td><div class="c0"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--condition.html#L240">67</a></div></td><td></td><td></td><td><div>2490</div></td><td class="s">&nbsp;&nbsp;if ($options{&quot;open&quot;} &amp;&amp; $options{&quot;mkdir&quot;}) {</td></tr>
<tr><td class="h">241</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;${$options{ErrStr}} = &quot;doopen and domkdir can not both be true\n&quot;;</td></tr>
<tr><td class="h">242</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return ();</td></tr>
<tr><td class="h">243</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">244</td><td colspan="7"></td></tr><tr><td class="h">245</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Find the start of the end of the&nbsp;&nbsp;Xs (position of last X)</td></tr>
<tr><td class="h">246</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Substr starts from 0</td></tr>
<tr><td class="h">247</td><td><div class="c3">838</div></td><td></td><td></td><td></td><td></td><td><div>1222</div></td><td class="s">&nbsp;&nbsp;my $start = length($template) - 1 - $options{&quot;suffixlen&quot;};</td></tr>
<tr><td class="h">248</td><td colspan="7"></td></tr><tr><td class="h">249</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Check that we have at least MINX x X (e.g. &#39;XXXX&quot;) at the end of the string</td></tr>
<tr><td class="h">250</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# (taking suffixlen into account). Any fewer is insecure.</td></tr>
<tr><td class="h">251</td><td colspan="7"></td></tr><tr><td class="h">252</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Do it using substr - no reason to use a pattern match since</td></tr>
<tr><td class="h">253</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# we know where we are looking and what we are looking for</td></tr>
<tr><td class="h">254</td><td colspan="7"></td></tr><tr><td class="h">255</td><td><div class="c3">838</div></td><td><div class="c0" title="-/F"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L255">50</a></div></td><td></td><td></td><td></td><td><div>2165</div></td><td class="s">&nbsp;&nbsp;if (substr($template, $start - MINX + 1, MINX) ne &#39;X&#39; x MINX) {</td></tr>
<tr><td class="h">256</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;${$options{ErrStr}} = &quot;The template must end with at least &quot;.</td></tr>
<tr><td class="h">257</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MINX . &quot; &#39;X&#39; characters\n&quot;;</td></tr>
<tr><td class="h">258</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return ();</td></tr>
<tr><td class="h">259</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">260</td><td colspan="7"></td></tr><tr><td class="h">261</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Replace all the X at the end of the substring with a</td></tr>
<tr><td class="h">262</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# random character or just all the XX at the end of a full string.</td></tr>
<tr><td class="h">263</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Do it as an if, since the suffix adjusts which section to replace</td></tr>
<tr><td class="h">264</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# and suffixlen=0 returns nothing if used in the substr directly</td></tr>
<tr><td class="h">265</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# and generate a full path from the template</td></tr>
<tr><td class="h">266</td><td colspan="7"></td></tr><tr><td class="h">267</td><td><div class="c3">838</div></td><td></td><td></td><td></td><td></td><td><div>1387</div></td><td class="s">&nbsp;&nbsp;my $path = _replace_XX($template, $options{&quot;suffixlen&quot;});</td></tr>
<tr><td class="h">268</td><td colspan="7"></td></tr><tr><td class="h">269</td><td colspan="7"></td></tr><tr><td class="h">270</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Split the path into constituent parts - eventually we need to check</td></tr>
<tr><td class="h">271</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# whether the directory exists</td></tr>
<tr><td class="h">272</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# We need to know whether we are making a temp directory</td></tr>
<tr><td class="h">273</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# or a tempfile</td></tr>
<tr><td class="h">274</td><td colspan="7"></td></tr><tr><td class="h">275</td><td><div class="c3">838</div></td><td></td><td></td><td></td><td></td><td><div>836</div></td><td class="s">&nbsp;&nbsp;my ($volume, $directories, $file);</td></tr>
<tr><td class="h">276</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;my $parent;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# parent directory</td></tr>
<tr><td class="h">277</td><td><div class="c3">838</div></td><td><div class="c3" title="T/F"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L277">100</a></div></td><td></td><td></td><td></td><td><div>1335</div></td><td class="s">&nbsp;&nbsp;if ($options{&quot;mkdir&quot;}) {</td></tr>
<tr><td class="h">278</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# There is no filename at the end</td></tr>
<tr><td class="h">279</td><td><div class="c3">471</div></td><td></td><td></td><td></td><td></td><td><div>2311</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;($volume, $directories, $file) = File::Spec-&gt;splitpath( $path, 1);</td></tr>
<tr><td class="h">280</td><td colspan="7"></td></tr><tr><td class="h">281</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# The parent is then $directories without the last directory</td></tr>
<tr><td class="h">282</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Split the directory and put it back together again</td></tr>
<tr><td class="h">283</td><td><div class="c3">471</div></td><td></td><td></td><td></td><td></td><td><div>2020</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my @dirs = File::Spec-&gt;splitdir($directories);</td></tr>
<tr><td class="h">284</td><td colspan="7"></td></tr><tr><td class="h">285</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# If @dirs only has one entry (i.e. the directory template) that means</td></tr>
<tr><td class="h">286</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# we are in the current directory</td></tr>
<tr><td class="h">287</td><td><div class="c3">471</div></td><td><div class="c0" title="-/F"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L287">50</a></div></td><td></td><td></td><td></td><td><div>798</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ($#dirs == 0) {</td></tr>
<tr><td class="h">288</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$parent = File::Spec-&gt;curdir;</td></tr>
<tr><td class="h">289</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">290</td><td colspan="7"></td></tr><tr><td class="h">291</td><td><div class="c3">471</div></td><td><div class="c0" title="-/F"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L291">50</a></div></td><td></td><td></td><td></td><td><div>867</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($^O eq &#39;VMS&#39;) {&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# need volume to avoid relative dir spec</td></tr>
<tr><td class="h">292</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$parent = File::Spec-&gt;catdir($volume, @dirs[0..$#dirs-1]);</td></tr>
<tr><td class="h">293</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L293">0</a></div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$parent = &#39;sys$disk:[]&#39; if $parent eq &#39;&#39;;</td></tr>
<tr><td class="h">294</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">295</td><td colspan="7"></td></tr><tr><td class="h">296</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Put it back together without the last one</td></tr>
<tr><td class="h">297</td><td><div class="c3">471</div></td><td></td><td></td><td></td><td></td><td><div>2494</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$parent = File::Spec-&gt;catdir(@dirs[0..$#dirs-1]);</td></tr>
<tr><td class="h">298</td><td colspan="7"></td></tr><tr><td class="h">299</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# ...and attach the volume (no filename)</td></tr>
<tr><td class="h">300</td><td><div class="c3">471</div></td><td></td><td></td><td></td><td></td><td><div>2319</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$parent = File::Spec-&gt;catpath($volume, $parent, &#39;&#39;);</td></tr>
<tr><td class="h">301</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">302</td><td colspan="7"></td></tr><tr><td class="h">303</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">304</td><td colspan="7"></td></tr><tr><td class="h">305</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">306</td><td colspan="7"></td></tr><tr><td class="h">307</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Get rid of the last filename (use File::Basename for this?)</td></tr>
<tr><td class="h">308</td><td><div class="c3">367</div></td><td></td><td></td><td></td><td></td><td><div>4016</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;($volume, $directories, $file) = File::Spec-&gt;splitpath( $path );</td></tr>
<tr><td class="h">309</td><td colspan="7"></td></tr><tr><td class="h">310</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Join up without the file part</td></tr>
<tr><td class="h">311</td><td><div class="c3">367</div></td><td></td><td></td><td></td><td></td><td><div>1665</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$parent = File::Spec-&gt;catpath($volume,$directories,&#39;&#39;);</td></tr>
<tr><td class="h">312</td><td colspan="7"></td></tr><tr><td class="h">313</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# If $parent is empty replace with curdir</td></tr>
<tr><td class="h">314</td><td><div class="c3">367</div></td><td><div class="c0" title="-/F"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L314">50</a></div></td><td></td><td></td><td></td><td><div>717</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$parent = File::Spec-&gt;curdir</td></tr>
<tr><td class="h">315</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unless $directories ne &#39;&#39;;</td></tr>
<tr><td class="h">316</td><td colspan="7"></td></tr><tr><td class="h">317</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">318</td><td colspan="7"></td></tr><tr><td class="h">319</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Check that the parent directories exist</td></tr>
<tr><td class="h">320</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Do this even for the case where we are simply returning a name</td></tr>
<tr><td class="h">321</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# not a file -- no point returning a name that includes a directory</td></tr>
<tr><td class="h">322</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# that does not exist or is not writable</td></tr>
<tr><td class="h">323</td><td colspan="7"></td></tr><tr><td class="h">324</td><td><div class="c3">838</div></td><td><div class="c0" title="-/F"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L324">50</a></div></td><td></td><td></td><td></td><td><div>3497</div></td><td class="s">&nbsp;&nbsp;unless (-e $parent) {</td></tr>
<tr><td class="h">325</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;${$options{ErrStr}} = &quot;Parent directory ($parent) does not exist&quot;;</td></tr>
<tr><td class="h">326</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return ();</td></tr>
<tr><td class="h">327</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">328</td><td><div class="c3">838</div></td><td><div class="c0" title="-/F"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L328">50</a></div></td><td></td><td></td><td></td><td><div>2056</div></td><td class="s">&nbsp;&nbsp;unless (-d $parent) {</td></tr>
<tr><td class="h">329</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;${$options{ErrStr}} = &quot;Parent directory ($parent) is not a directory&quot;;</td></tr>
<tr><td class="h">330</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return ();</td></tr>
<tr><td class="h">331</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">332</td><td colspan="7"></td></tr><tr><td class="h">333</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Check the stickiness of the directory and chown giveaway if required</td></tr>
<tr><td class="h">334</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# If the directory is world writable the sticky bit</td></tr>
<tr><td class="h">335</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# must be set</td></tr>
<tr><td class="h">336</td><td colspan="7"></td></tr><tr><td class="h">337</td><td><div class="c3">838</div></td><td><div class="c0" title="-/F"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L337">50</a></div><div class="c0" title="-/F"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L337">50</a></div></td><td></td><td></td><td></td><td><div>2161</div></td><td class="s">&nbsp;&nbsp;if (File::Temp-&gt;safe_level == MEDIUM) {</td></tr>
<tr><td class="h">338</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $safeerr;</td></tr>
<tr><td class="h">339</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L339">0</a></div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;unless (_is_safe($parent,\$safeerr)) {</td></tr>
<tr><td class="h">340</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;${$options{ErrStr}} = &quot;Parent directory ($parent) is not safe ($safeerr)&quot;;</td></tr>
<tr><td class="h">341</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return ();</td></tr>
<tr><td class="h">342</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">343</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;} elsif (File::Temp-&gt;safe_level == HIGH) {</td></tr>
<tr><td class="h">344</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $safeerr;</td></tr>
<tr><td class="h">345</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L345">0</a></div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;unless (_is_verysafe($parent, \$safeerr)) {</td></tr>
<tr><td class="h">346</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;${$options{ErrStr}} = &quot;Parent directory ($parent) is not safe ($safeerr)&quot;;</td></tr>
<tr><td class="h">347</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return ();</td></tr>
<tr><td class="h">348</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">349</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">350</td><td colspan="7"></td></tr><tr><td class="h">351</td><td colspan="7"></td></tr><tr><td class="h">352</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Now try MAX_TRIES time to open the file</td></tr>
<tr><td class="h">353</td><td><div class="c3">838</div></td><td></td><td></td><td></td><td></td><td><div>1616</div></td><td class="s">&nbsp;&nbsp;for (my $i = 0; $i &lt; MAX_TRIES; $i++) {</td></tr>
<tr><td class="h">354</td><td colspan="7"></td></tr><tr><td class="h">355</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Try to open the file if requested</td></tr>
<tr><td class="h">356</td><td><div class="c3">838</div></td><td><div class="c3" title="T/F"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L356">100</a></div><div class="c0" title="T/-"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L356">50</a></div></td><td></td><td></td><td></td><td><div>1530</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ($options{&quot;open&quot;}) {</td></tr>
<tr><td class="h">357</td><td><div class="c3">367</div></td><td></td><td></td><td></td><td></td><td><div>320</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $fh;</td></tr>
<tr><td class="h">358</td><td colspan="7"></td></tr><tr><td class="h">359</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# If we are running before perl5.6.0 we can not auto-vivify</td></tr>
<tr><td class="h">360</td><td><div class="c3">367</div></td><td><div class="c0" title="-/F"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L360">50</a></div></td><td></td><td></td><td></td><td><div>700</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($] &lt; 5.006) {</td></tr>
<tr><td class="h">361</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$fh = &amp;Symbol::gensym;</td></tr>
<tr><td class="h">362</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">363</td><td colspan="7"></td></tr><tr><td class="h">364</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Try to make sure this will be marked close-on-exec</td></tr>
<tr><td class="h">365</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# XXX: Win32 doesn&#39;t respect this, nor the proper fcntl,</td></tr>
<tr><td class="h">366</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;but may have O_NOINHERIT. This may or may not be in Fcntl.</td></tr>
<tr><td class="h">367</td><td><div class="c3">367</div></td><td></td><td></td><td></td><td></td><td><div>872</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;local $^F = 2;</td></tr>
<tr><td class="h">368</td><td colspan="7"></td></tr><tr><td class="h">369</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Attempt to open the file</td></tr>
<tr><td class="h">370</td><td><div class="c3">367</div></td><td></td><td></td><td></td><td></td><td><div>351</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $open_success = undef;</td></tr>
<tr><td class="h">371</td><td><div class="c3">367</div></td><td><div class="c0" title="-/F"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L371">50</a></div></td><td><div class="c0"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--condition.html#L371">33</a></div><div class="c0"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--condition.html#L371">0</a></div></td><td></td><td></td><td><div>1111</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ( $^O eq &#39;VMS&#39; and $options{&quot;unlink_on_close&quot;} &amp;&amp; !$KEEP_ALL) {</td></tr>
<tr><td class="h">372</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# make it auto delete on close by setting FAB$V_DLT bit</td></tr>
<tr><td class="h">373</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$fh = VMS::Stdio::vmssysopen($path, $OPENFLAGS, 0600, &#39;fop=dlt&#39;);</td></tr>
<tr><td class="h">374</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$open_success = $fh;</td></tr>
<tr><td class="h">375</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">376</td><td><div class="c3">367</div></td><td><div class="c3" title="T/F"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L376">100</a></div></td><td><div class="c0"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--condition.html#L376">67</a></div></td><td></td><td></td><td><div>857</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $flags = ( ($options{&quot;unlink_on_close&quot;} &amp;&amp; !$KEEP_ALL) ?</td></tr>
<tr><td class="h">377</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$OPENTEMPFLAGS :</td></tr>
<tr><td class="h">378</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$OPENFLAGS );</td></tr>
<tr><td class="h">379</td><td><div class="c3">367</div></td><td><div class="c0" title="-/F"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L379">50</a></div></td><td><div class="c0"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--condition.html#L379">33</a></div></td><td></td><td></td><td><div>751</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$flags |= $LOCKFLAG if (defined $LOCKFLAG &amp;&amp; $options{use_exlock});</td></tr>
<tr><td class="h">380</td><td><div class="c3">367</div></td><td></td><td></td><td></td><td></td><td><div>10833</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$open_success = sysopen($fh, $path, $flags, 0600);</td></tr>
<tr><td class="h">381</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">382</td><td><div class="c3">367</div></td><td><div class="c0" title="T/-"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L382">50</a></div></td><td></td><td></td><td></td><td><div>780</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ( $open_success ) {</td></tr>
<tr><td class="h">383</td><td colspan="7"></td></tr><tr><td class="h">384</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# in case of odd umask force rw</td></tr>
<tr><td class="h">385</td><td><div class="c3">367</div></td><td></td><td></td><td></td><td></td><td><div>1720</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;chmod(0600, $path);</td></tr>
<tr><td class="h">386</td><td colspan="7"></td></tr><tr><td class="h">387</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Opened successfully - return file handle and name</td></tr>
<tr><td class="h">388</td><td><div class="c3">367</div></td><td></td><td></td><td></td><td></td><td><div>1991</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return ($fh, $path);</td></tr>
<tr><td class="h">389</td><td colspan="7"></td></tr><tr><td class="h">390</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">391</td><td colspan="7"></td></tr><tr><td class="h">392</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Error opening file - abort with error</td></tr>
<tr><td class="h">393</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# if the reason was anything but EEXIST</td></tr>
<tr><td class="h">394</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L394">0</a></div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unless ($!{EEXIST}) {</td></tr>
<tr><td class="h">395</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;${$options{ErrStr}} = &quot;Could not create temp file $path: $!&quot;;</td></tr>
<tr><td class="h">396</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return ();</td></tr>
<tr><td class="h">397</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">398</td><td colspan="7"></td></tr><tr><td class="h">399</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Loop round for another try</td></tr>
<tr><td class="h">400</td><td colspan="7"></td></tr><tr><td class="h">401</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">402</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} elsif ($options{&quot;mkdir&quot;}) {</td></tr>
<tr><td class="h">403</td><td colspan="7"></td></tr><tr><td class="h">404</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Open the temp directory</td></tr>
<tr><td class="h">405</td><td><div class="c3">471</div></td><td><div class="c0" title="T/-"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L405">50</a></div></td><td></td><td></td><td></td><td><div>11531</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (mkdir( $path, 0700)) {</td></tr>
<tr><td class="h">406</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# in case of odd umask</td></tr>
<tr><td class="h">407</td><td><div class="c3">471</div></td><td></td><td></td><td></td><td></td><td><div>2462</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;chmod(0700, $path);</td></tr>
<tr><td class="h">408</td><td colspan="7"></td></tr><tr><td class="h">409</td><td><div class="c3">471</div></td><td></td><td></td><td></td><td></td><td><div>2170</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return undef, $path;</td></tr>
<tr><td class="h">410</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">411</td><td colspan="7"></td></tr><tr><td class="h">412</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Abort with error if the reason for failure was anything</td></tr>
<tr><td class="h">413</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# except EEXIST</td></tr>
<tr><td class="h">414</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L414">0</a></div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unless ($!{EEXIST}) {</td></tr>
<tr><td class="h">415</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;${$options{ErrStr}} = &quot;Could not create directory $path: $!&quot;;</td></tr>
<tr><td class="h">416</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return ();</td></tr>
<tr><td class="h">417</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">418</td><td colspan="7"></td></tr><tr><td class="h">419</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Loop round for another try</td></tr>
<tr><td class="h">420</td><td colspan="7"></td></tr><tr><td class="h">421</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">422</td><td colspan="7"></td></tr><tr><td class="h">423</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">424</td><td colspan="7"></td></tr><tr><td class="h">425</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Return true if the file can not be found</td></tr>
<tr><td class="h">426</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Directory has been checked previously</td></tr>
<tr><td class="h">427</td><td colspan="7"></td></tr><tr><td class="h">428</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L428">0</a></div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return (undef, $path) unless -e $path;</td></tr>
<tr><td class="h">429</td><td colspan="7"></td></tr><tr><td class="h">430</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Try again until MAX_TRIES</td></tr>
<tr><td class="h">431</td><td colspan="7"></td></tr><tr><td class="h">432</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">433</td><td colspan="7"></td></tr><tr><td class="h">434</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Did not successfully open the tempfile/dir</td></tr>
<tr><td class="h">435</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# so try again with a different set of random letters</td></tr>
<tr><td class="h">436</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# No point in trying to increment unless we have only</td></tr>
<tr><td class="h">437</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# 1 X say and the randomness could come up with the same</td></tr>
<tr><td class="h">438</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# file MAX_TRIES in a row.</td></tr>
<tr><td class="h">439</td><td colspan="7"></td></tr><tr><td class="h">440</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Store current attempt - in principal this implies that the</td></tr>
<tr><td class="h">441</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# 3rd time around the open attempt that the first temp file</td></tr>
<tr><td class="h">442</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# name could be generated again. Probably should store each</td></tr>
<tr><td class="h">443</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# attempt and make sure that none are repeated</td></tr>
<tr><td class="h">444</td><td colspan="7"></td></tr><tr><td class="h">445</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $original = $path;</td></tr>
<tr><td class="h">446</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $counter = 0;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Stop infinite loop</td></tr>
<tr><td class="h">447</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $MAX_GUESS = 50;</td></tr>
<tr><td class="h">448</td><td colspan="7"></td></tr><tr><td class="h">449</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--condition.html#L449">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;do {</td></tr>
<tr><td class="h">450</td><td colspan="7"></td></tr><tr><td class="h">451</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Generate new name from original template</td></tr>
<tr><td class="h">452</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$path = _replace_XX($template, $options{&quot;suffixlen&quot;});</td></tr>
<tr><td class="h">453</td><td colspan="7"></td></tr><tr><td class="h">454</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$counter++;</td></tr>
<tr><td class="h">455</td><td colspan="7"></td></tr><tr><td class="h">456</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} until ($path ne $original || $counter &gt; $MAX_GUESS);</td></tr>
<tr><td class="h">457</td><td colspan="7"></td></tr><tr><td class="h">458</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Check for out of control looping</td></tr>
<tr><td class="h">459</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L459">0</a></div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ($counter &gt; $MAX_GUESS) {</td></tr>
<tr><td class="h">460</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;${$options{ErrStr}} = &quot;Tried to get a new temp name different to the previous value $MAX_GUESS times.\nSomething wrong with template?? ($template)&quot;;</td></tr>
<tr><td class="h">461</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return ();</td></tr>
<tr><td class="h">462</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">463</td><td colspan="7"></td></tr><tr><td class="h">464</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">465</td><td colspan="7"></td></tr><tr><td class="h">466</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# If we get here, we have run out of tries</td></tr>
<tr><td class="h">467</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div><div>0</div></td><td class="s">&nbsp;&nbsp;${ $options{ErrStr} } = &quot;Have exceeded the maximum number of attempts (&quot;</td></tr>
<tr><td class="h">468</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;. MAX_TRIES . &quot;) to open temp file/dir&quot;;</td></tr>
<tr><td class="h">469</td><td colspan="7"></td></tr><tr><td class="h">470</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;return ();</td></tr>
<tr><td class="h">471</td><td colspan="7"></td></tr><tr><td class="h">472</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">473</td><td colspan="7"></td></tr><tr><td class="h">474</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># Internal routine to replace the XXXX... with random characters</td></tr>
<tr><td class="h">475</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># This has to be done by _gettemp() every time it fails to</td></tr>
<tr><td class="h">476</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># open a temp file/dir</td></tr>
<tr><td class="h">477</td><td colspan="7"></td></tr><tr><td class="h">478</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># Arguments:&nbsp;&nbsp;$template (the template with XXX),</td></tr>
<tr><td class="h">479</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ignore&nbsp;&nbsp;&nbsp;(number of characters at end to ignore)</td></tr>
<tr><td class="h">480</td><td colspan="7"></td></tr><tr><td class="h">481</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># Returns:&nbsp;&nbsp;&nbsp;&nbsp;modified template</td></tr>
<tr><td class="h">482</td><td colspan="7"></td></tr><tr><td class="h">483</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _replace_XX {</td></tr>
<tr><td class="h">484</td><td colspan="7"></td></tr><tr><td class="h">485</td><td><div class="c3">838</div></td><td><div class="c0" title="-/F"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L485">50</a></div></td><td></td><td><div class="c3"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--subroutine.html#L485">838</a></div></td><td></td><td><div>1382</div></td><td class="s">&nbsp;&nbsp;croak &#39;Usage: _replace_XX($template, $ignore)&#39;</td></tr>
<tr><td class="h">486</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;unless scalar(@_) == 2;</td></tr>
<tr><td class="h">487</td><td colspan="7"></td></tr><tr><td class="h">488</td><td><div class="c3">838</div></td><td></td><td></td><td></td><td></td><td><div>927</div></td><td class="s">&nbsp;&nbsp;my ($path, $ignore) = @_;</td></tr>
<tr><td class="h">489</td><td colspan="7"></td></tr><tr><td class="h">490</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Do it as an if, since the suffix adjusts which section to replace</td></tr>
<tr><td class="h">491</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# and suffixlen=0 returns nothing if used in the substr directly</td></tr>
<tr><td class="h">492</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Alternatively, could simply set $ignore to length($path)-1</td></tr>
<tr><td class="h">493</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Don&#39;t want to always use substr when not required though.</td></tr>
<tr><td class="h">494</td><td><div class="c3">838</div></td><td><div class="c0" title="T/-"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L494">50</a></div></td><td></td><td></td><td></td><td><div>1424</div></td><td class="s">&nbsp;&nbsp;my $end = ( $] &gt;= 5.006 ? &quot;\\z&quot; : &quot;\\Z&quot; );</td></tr>
<tr><td class="h">495</td><td colspan="7"></td></tr><tr><td class="h">496</td><td><div class="c3">838</div></td><td><div class="c0" title="-/F"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L496">50</a></div></td><td></td><td></td><td></td><td><div>3104</div></td><td class="s">&nbsp;&nbsp;if ($ignore) {</td></tr>
<tr><td class="h">497</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;substr($path, 0, - $ignore) =~ s/X(?=X*$end)/$CHARS[ int( rand( @CHARS ) ) ]/ge;</td></tr>
<tr><td class="h">498</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">499</td><td><div class="c3">838</div><div class="c3">8380</div></td><td></td><td></td><td></td><td></td><td><div>5859</div><div>18919</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$path =~ s/X(?=X*$end)/$CHARS[ int( rand( @CHARS ) ) ]/ge;</td></tr>
<tr><td class="h">500</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">501</td><td><div class="c3">838</div></td><td></td><td></td><td></td><td></td><td><div>2059</div></td><td class="s">&nbsp;&nbsp;return $path;</td></tr>
<tr><td class="h">502</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">503</td><td colspan="7"></td></tr><tr><td class="h">504</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># Internal routine to force a temp file to be writable after</td></tr>
<tr><td class="h">505</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># it is created so that we can unlink it. Windows seems to occasionally</td></tr>
<tr><td class="h">506</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># force a file to be readonly when written to certain temp locations</td></tr>
<tr><td class="h">507</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _force_writable {</td></tr>
<tr><td class="h">508</td><td><div class="c3">669</div></td><td></td><td></td><td><div class="c3"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--subroutine.html#L508">669</a></div></td><td></td><td><div>660</div></td><td class="s">&nbsp;&nbsp;my $file = shift;</td></tr>
<tr><td class="h">509</td><td><div class="c3">669</div></td><td></td><td></td><td></td><td></td><td><div>3700</div></td><td class="s">&nbsp;&nbsp;chmod 0600, $file;</td></tr>
<tr><td class="h">510</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">511</td><td colspan="7"></td></tr><tr><td class="h">512</td><td colspan="7"></td></tr><tr><td class="h">513</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># internal routine to check to see if the directory is safe</td></tr>
<tr><td class="h">514</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># First checks to see if the directory is not owned by the</td></tr>
<tr><td class="h">515</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># current user or root. Then checks to see if anyone else</td></tr>
<tr><td class="h">516</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># can write to the directory and if so, checks to see if</td></tr>
<tr><td class="h">517</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># it has the sticky bit set</td></tr>
<tr><td class="h">518</td><td colspan="7"></td></tr><tr><td class="h">519</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># Will not work on systems that do not support sticky bit</td></tr>
<tr><td class="h">520</td><td colspan="7"></td></tr><tr><td class="h">521</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#Args:&nbsp;&nbsp;directory path to check</td></tr>
<tr><td class="h">522</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Optionally: reference to scalar to contain error message</td></tr>
<tr><td class="h">523</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># Returns true if the path is safe and false otherwise.</td></tr>
<tr><td class="h">524</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># Returns undef if can not even run stat() on the path</td></tr>
<tr><td class="h">525</td><td colspan="7"></td></tr><tr><td class="h">526</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># This routine based on version written by Tom Christiansen</td></tr>
<tr><td class="h">527</td><td colspan="7"></td></tr><tr><td class="h">528</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># Presumably, by the time we actually attempt to create the</td></tr>
<tr><td class="h">529</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># file or directory in this directory, it may not be safe</td></tr>
<tr><td class="h">530</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># anymore... Have to run _is_safe directly after the open.</td></tr>
<tr><td class="h">531</td><td colspan="7"></td></tr><tr><td class="h">532</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _is_safe {</td></tr>
<tr><td class="h">533</td><td colspan="7"></td></tr><tr><td class="h">534</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--subroutine.html#L534">0</a></div></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;my $path = shift;</td></tr>
<tr><td class="h">535</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;my $err_ref = shift;</td></tr>
<tr><td class="h">536</td><td colspan="7"></td></tr><tr><td class="h">537</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Stat path</td></tr>
<tr><td class="h">538</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;my @info = stat($path);</td></tr>
<tr><td class="h">539</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L539">0</a></div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;unless (scalar(@info)) {</td></tr>
<tr><td class="h">540</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$$err_ref = &quot;stat(path) returned no values&quot;;</td></tr>
<tr><td class="h">541</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return 0;</td></tr>
<tr><td class="h">542</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">543</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;;</td></tr>
<tr><td class="h">544</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L544">0</a></div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;return 1 if $^O eq &#39;VMS&#39;;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# owner delete control at file level</td></tr>
<tr><td class="h">545</td><td colspan="7"></td></tr><tr><td class="h">546</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Check to see whether owner is neither superuser (or a system uid) nor me</td></tr>
<tr><td class="h">547</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Use the effective uid from the $&gt; variable</td></tr>
<tr><td class="h">548</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# UID is in [4]</td></tr>
<tr><td class="h">549</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L549">0</a></div></td><td><div class="c0"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--condition.html#L549">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;if ($info[4] &gt; File::Temp-&gt;top_system_uid() &amp;&amp; $info[4] != $&gt;) {</td></tr>
<tr><td class="h">550</td><td colspan="7"></td></tr><tr><td class="h">551</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;Carp::cluck(sprintf &quot;uid=$info[4] topuid=%s euid=$&gt; path=&#39;$path&#39;&quot;,</td></tr>
<tr><td class="h">552</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;File::Temp-&gt;top_system_uid());</td></tr>
<tr><td class="h">553</td><td colspan="7"></td></tr><tr><td class="h">554</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L554">0</a></div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$$err_ref = &quot;Directory owned neither by root nor the current user&quot;</td></tr>
<tr><td class="h">555</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ref($err_ref);</td></tr>
<tr><td class="h">556</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return 0;</td></tr>
<tr><td class="h">557</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">558</td><td colspan="7"></td></tr><tr><td class="h">559</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# check whether group or other can write file</td></tr>
<tr><td class="h">560</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# use 066 to detect either reading or writing</td></tr>
<tr><td class="h">561</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# use 022 to check writability</td></tr>
<tr><td class="h">562</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Do it with S_IWOTH and S_IWGRP for portability (maybe)</td></tr>
<tr><td class="h">563</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# mode is in info[2]</td></tr>
<tr><td class="h">564</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L564">0</a></div></td><td><div class="c0"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--condition.html#L564">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;if (($info[2] &amp; &amp;Fcntl::S_IWGRP) ||&nbsp;&nbsp;# Is group writable?</td></tr>
<tr><td class="h">565</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;($info[2] &amp; &amp;Fcntl::S_IWOTH) ) { # Is world writable?</td></tr>
<tr><td class="h">566</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Must be a directory</td></tr>
<tr><td class="h">567</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L567">0</a></div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;unless (-d $path) {</td></tr>
<tr><td class="h">568</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L568">0</a></div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$$err_ref = &quot;Path ($path) is not a directory&quot;</td></tr>
<tr><td class="h">569</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ref($err_ref);</td></tr>
<tr><td class="h">570</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return 0;</td></tr>
<tr><td class="h">571</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">572</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Must have sticky bit set</td></tr>
<tr><td class="h">573</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L573">0</a></div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;unless (-k $path) {</td></tr>
<tr><td class="h">574</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L574">0</a></div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$$err_ref = &quot;Sticky bit not set on $path when dir is group|world writable&quot;</td></tr>
<tr><td class="h">575</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ref($err_ref);</td></tr>
<tr><td class="h">576</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return 0;</td></tr>
<tr><td class="h">577</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">578</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">579</td><td colspan="7"></td></tr><tr><td class="h">580</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;return 1;</td></tr>
<tr><td class="h">581</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">582</td><td colspan="7"></td></tr><tr><td class="h">583</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># Internal routine to check whether a directory is safe</td></tr>
<tr><td class="h">584</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># for temp files. Safer than _is_safe since it checks for</td></tr>
<tr><td class="h">585</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># the possibility of chown giveaway and if that is a possibility</td></tr>
<tr><td class="h">586</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># checks each directory in the path to see if it is safe (with _is_safe)</td></tr>
<tr><td class="h">587</td><td colspan="7"></td></tr><tr><td class="h">588</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># If _PC_CHOWN_RESTRICTED is not set, does the full test of each</td></tr>
<tr><td class="h">589</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># directory anyway.</td></tr>
<tr><td class="h">590</td><td colspan="7"></td></tr><tr><td class="h">591</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># Takes optional second arg as scalar ref to error reason</td></tr>
<tr><td class="h">592</td><td colspan="7"></td></tr><tr><td class="h">593</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _is_verysafe {</td></tr>
<tr><td class="h">594</td><td colspan="7"></td></tr><tr><td class="h">595</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Need POSIX - but only want to bother if really necessary due to overhead</td></tr>
<tr><td class="h">596</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--subroutine.html#L596">0</a></div></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;require POSIX;</td></tr>
<tr><td class="h">597</td><td colspan="7"></td></tr><tr><td class="h">598</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;my $path = shift;</td></tr>
<tr><td class="h">599</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L599">0</a></div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;print &quot;_is_verysafe testing $path\n&quot; if $DEBUG;</td></tr>
<tr><td class="h">600</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L600">0</a></div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;return 1 if $^O eq &#39;VMS&#39;;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# owner delete control at file level</td></tr>
<tr><td class="h">601</td><td colspan="7"></td></tr><tr><td class="h">602</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;my $err_ref = shift;</td></tr>
<tr><td class="h">603</td><td colspan="7"></td></tr><tr><td class="h">604</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Should Get the value of _PC_CHOWN_RESTRICTED if it is defined</td></tr>
<tr><td class="h">605</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# and If it is not there do the extensive test</td></tr>
<tr><td class="h">606</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;local($@);</td></tr>
<tr><td class="h">607</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;my $chown_restricted;</td></tr>
<tr><td class="h">608</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;$chown_restricted = &amp;POSIX::_PC_CHOWN_RESTRICTED()</td></tr>
<tr><td class="h">609</td><td><div class="c0">0</div><div class="c0">0</div><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L609">0</a></div></td><td></td><td></td><td></td><td><div>0</div><div>0</div><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if eval { &amp;POSIX::_PC_CHOWN_RESTRICTED(); 1};</td></tr>
<tr><td class="h">610</td><td colspan="7"></td></tr><tr><td class="h">611</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# If chown_resticted is set to some value we should test it</td></tr>
<tr><td class="h">612</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L612">0</a></div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;if (defined $chown_restricted) {</td></tr>
<tr><td class="h">613</td><td colspan="7"></td></tr><tr><td class="h">614</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Return if the current directory is safe</td></tr>
<tr><td class="h">615</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L615">0</a></div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return _is_safe($path,$err_ref) if POSIX::sysconf( $chown_restricted );</td></tr>
<tr><td class="h">616</td><td colspan="7"></td></tr><tr><td class="h">617</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">618</td><td colspan="7"></td></tr><tr><td class="h">619</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# To reach this point either, the _PC_CHOWN_RESTRICTED symbol</td></tr>
<tr><td class="h">620</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# was not available or the symbol was there but chown giveaway</td></tr>
<tr><td class="h">621</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# is allowed. Either way, we now have to test the entire tree for</td></tr>
<tr><td class="h">622</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# safety.</td></tr>
<tr><td class="h">623</td><td colspan="7"></td></tr><tr><td class="h">624</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Convert path to an absolute directory if required</td></tr>
<tr><td class="h">625</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L625">0</a></div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;unless (File::Spec-&gt;file_name_is_absolute($path)) {</td></tr>
<tr><td class="h">626</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$path = File::Spec-&gt;rel2abs($path);</td></tr>
<tr><td class="h">627</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">628</td><td colspan="7"></td></tr><tr><td class="h">629</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Split directory into components - assume no file</td></tr>
<tr><td class="h">630</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;my ($volume, $directories, undef) = File::Spec-&gt;splitpath( $path, 1);</td></tr>
<tr><td class="h">631</td><td colspan="7"></td></tr><tr><td class="h">632</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Slightly less efficient than having a function in File::Spec</td></tr>
<tr><td class="h">633</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# to chop off the end of a directory or even a function that</td></tr>
<tr><td class="h">634</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# can handle ../ in a directory tree</td></tr>
<tr><td class="h">635</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Sometimes splitdir() returns a blank at the end</td></tr>
<tr><td class="h">636</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# so we will probably check the bottom directory twice in some cases</td></tr>
<tr><td class="h">637</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;my @dirs = File::Spec-&gt;splitdir($directories);</td></tr>
<tr><td class="h">638</td><td colspan="7"></td></tr><tr><td class="h">639</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Concatenate one less directory each time around</td></tr>
<tr><td class="h">640</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;foreach my $pos (0.. $#dirs) {</td></tr>
<tr><td class="h">641</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Get a directory name</td></tr>
<tr><td class="h">642</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $dir = File::Spec-&gt;catpath($volume,</td></tr>
<tr><td class="h">643</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;File::Spec-&gt;catdir(@dirs[0.. $#dirs - $pos]),</td></tr>
<tr><td class="h">644</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;&#39;</td></tr>
<tr><td class="h">645</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</td></tr>
<tr><td class="h">646</td><td colspan="7"></td></tr><tr><td class="h">647</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L647">0</a></div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;print &quot;TESTING DIR $dir\n&quot; if $DEBUG;</td></tr>
<tr><td class="h">648</td><td colspan="7"></td></tr><tr><td class="h">649</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Check the directory</td></tr>
<tr><td class="h">650</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L650">0</a></div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return 0 unless _is_safe($dir,$err_ref);</td></tr>
<tr><td class="h">651</td><td colspan="7"></td></tr><tr><td class="h">652</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">653</td><td colspan="7"></td></tr><tr><td class="h">654</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;return 1;</td></tr>
<tr><td class="h">655</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">656</td><td colspan="7"></td></tr><tr><td class="h">657</td><td colspan="7"></td></tr><tr><td class="h">658</td><td colspan="7"></td></tr><tr><td class="h">659</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># internal routine to determine whether unlink works on this</td></tr>
<tr><td class="h">660</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># platform for files that are currently open.</td></tr>
<tr><td class="h">661</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># Returns true if we can, false otherwise.</td></tr>
<tr><td class="h">662</td><td colspan="7"></td></tr><tr><td class="h">663</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># Currently WinNT, OS/2 and VMS can not unlink an opened file</td></tr>
<tr><td class="h">664</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># On VMS this is because the O_EXCL flag is used to open the</td></tr>
<tr><td class="h">665</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># temporary file. Currently I do not know enough about the issues</td></tr>
<tr><td class="h">666</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># on VMS to decide whether O_EXCL is a requirement.</td></tr>
<tr><td class="h">667</td><td colspan="7"></td></tr><tr><td class="h">668</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _can_unlink_opened_file {</td></tr>
<tr><td class="h">669</td><td colspan="7"></td></tr><tr><td class="h">670</td><td><div class="c3">3</div><div class="c3">18</div></td><td><div class="c0" title="-/F"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L670">50</a></div></td><td></td><td><div class="c3"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--subroutine.html#L670">3</a></div></td><td></td><td><div>4</div><div>30</div></td><td class="s">&nbsp;&nbsp;if (grep { $^O eq $_ } qw/MSWin32 os2 VMS dos MacOS haiku/) {</td></tr>
<tr><td class="h">671</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return 0;</td></tr>
<tr><td class="h">672</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">673</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td></td><td><div>7</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return 1;</td></tr>
<tr><td class="h">674</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">675</td><td colspan="7"></td></tr><tr><td class="h">676</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">677</td><td colspan="7"></td></tr><tr><td class="h">678</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># internal routine to decide which security levels are allowed</td></tr>
<tr><td class="h">679</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># see safe_level() for more information on this</td></tr>
<tr><td class="h">680</td><td colspan="7"></td></tr><tr><td class="h">681</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># Controls whether the supplied security level is allowed</td></tr>
<tr><td class="h">682</td><td colspan="7"></td></tr><tr><td class="h">683</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#&nbsp;&nbsp;&nbsp;$cando = _can_do_level( $level )</td></tr>
<tr><td class="h">684</td><td colspan="7"></td></tr><tr><td class="h">685</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _can_do_level {</td></tr>
<tr><td class="h">686</td><td colspan="7"></td></tr><tr><td class="h">687</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Get security level</td></tr>
<tr><td class="h">688</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--subroutine.html#L688">0</a></div></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;my $level = shift;</td></tr>
<tr><td class="h">689</td><td colspan="7"></td></tr><tr><td class="h">690</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Always have to be able to do STANDARD</td></tr>
<tr><td class="h">691</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L691">0</a></div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;return 1 if $level == STANDARD;</td></tr>
<tr><td class="h">692</td><td colspan="7"></td></tr><tr><td class="h">693</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Currently, the systems that can do HIGH or MEDIUM are identical</td></tr>
<tr><td class="h">694</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L694">0</a></div></td><td><div class="c0"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--condition.html#L694">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;if ( $^O eq &#39;MSWin32&#39; || $^O eq &#39;os2&#39; || $^O eq &#39;cygwin&#39; || $^O eq &#39;dos&#39; || $^O eq &#39;MacOS&#39; || $^O eq &#39;mpeix&#39;) {</td></tr>
<tr><td class="h">695</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return 0;</td></tr>
<tr><td class="h">696</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">697</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return 1;</td></tr>
<tr><td class="h">698</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">699</td><td colspan="7"></td></tr><tr><td class="h">700</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">701</td><td colspan="7"></td></tr><tr><td class="h">702</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># This routine sets up a deferred unlinking of a specified</td></tr>
<tr><td class="h">703</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># filename and filehandle. It is used in the following cases:</td></tr>
<tr><td class="h">704</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#&nbsp;&nbsp;- Called by unlink0 if an opened file can not be unlinked</td></tr>
<tr><td class="h">705</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#&nbsp;&nbsp;- Called by tempfile() if files are to be removed on shutdown</td></tr>
<tr><td class="h">706</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#&nbsp;&nbsp;- Called by tempdir() if directories are to be removed on shutdown</td></tr>
<tr><td class="h">707</td><td colspan="7"></td></tr><tr><td class="h">708</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># Arguments:</td></tr>
<tr><td class="h">709</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#&nbsp;&nbsp;&nbsp;_deferred_unlink( $fh, $fname, $isdir );</td></tr>
<tr><td class="h">710</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#</td></tr>
<tr><td class="h">711</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#&nbsp;&nbsp;&nbsp;- filehandle (so that it can be explicitly closed if open</td></tr>
<tr><td class="h">712</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#&nbsp;&nbsp;&nbsp;- filename&nbsp;&nbsp;&nbsp;(the thing we want to remove)</td></tr>
<tr><td class="h">713</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#&nbsp;&nbsp;&nbsp;- isdir&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(flag to indicate that we are being given a directory)</td></tr>
<tr><td class="h">714</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[and hence no filehandle]</td></tr>
<tr><td class="h">715</td><td colspan="7"></td></tr><tr><td class="h">716</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># Status is not referred to since all the magic is done with an END block</td></tr>
<tr><td class="h">717</td><td colspan="7"></td></tr><tr><td class="h">718</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">{</td></tr>
<tr><td class="h">719</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Will set up two lexical variables to contain all the files to be</td></tr>
<tr><td class="h">720</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# removed. One array for files, another for directories They will</td></tr>
<tr><td class="h">721</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# only exist in this block.</td></tr>
<tr><td class="h">722</td><td colspan="7"></td></tr><tr><td class="h">723</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;#&nbsp;&nbsp;This means we only have to set up a single END block to remove</td></tr>
<tr><td class="h">724</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;#&nbsp;&nbsp;all files. </td></tr>
<tr><td class="h">725</td><td colspan="7"></td></tr><tr><td class="h">726</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# in order to prevent child processes inadvertently deleting the parent</td></tr>
<tr><td class="h">727</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# temp files we use a hash to store the temp files and directories</td></tr>
<tr><td class="h">728</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# created by a particular process id.</td></tr>
<tr><td class="h">729</td><td colspan="7"></td></tr><tr><td class="h">730</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# %files_to_unlink contains values that are references to an array of</td></tr>
<tr><td class="h">731</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# array references containing the filehandle and filename associated with</td></tr>
<tr><td class="h">732</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# the temp file.</td></tr>
<tr><td class="h">733</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;my (%files_to_unlink, %dirs_to_unlink);</td></tr>
<tr><td class="h">734</td><td colspan="7"></td></tr><tr><td class="h">735</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Set up an end block to use these arrays</td></tr>
<tr><td class="h">736</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;END {</td></tr>
<tr><td class="h">737</td><td><div class="c3">44</div></td><td></td><td></td><td><div class="c3"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--subroutine.html#L737">44</a></div></td><td></td><td><div>812</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;local($., $@, $!, $^E, $?);</td></tr>
<tr><td class="h">738</td><td><div class="c3">44</div></td><td></td><td></td><td></td><td></td><td><div>123</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;cleanup(at_exit =&gt; 1);</td></tr>
<tr><td class="h">739</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">740</td><td colspan="7"></td></tr><tr><td class="h">741</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Cleanup function. Always triggered on END (with at_exit =&gt; 1) but</td></tr>
<tr><td class="h">742</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# can be invoked manually.</td></tr>
<tr><td class="h">743</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;sub cleanup {</td></tr>
<tr><td class="h">744</td><td><div class="c3">44</div></td><td></td><td></td><td><div class="c3"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--subroutine.html#L744">44</a></div></td><td><div class="c3">1</div></td><td><div>113</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my %h = @_;</td></tr>
<tr><td class="h">745</td><td><div class="c3">44</div></td><td></td><td></td><td></td><td></td><td><div>100</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $at_exit = delete $h{at_exit};</td></tr>
<tr><td class="h">746</td><td><div class="c3">44</div></td><td><div class="c0" title="-/F"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L746">50</a></div></td><td></td><td></td><td></td><td><div>120</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$at_exit = 0 if not defined $at_exit;</td></tr>
<tr><td class="h">747</td><td><div class="c3">44</div><div class="c3">44</div><div class="c3">44</div></td><td><div class="c0" title="-/F"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L747">50</a></div></td><td></td><td></td><td></td><td><div>60</div><div>265</div><div>121</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;{ my @k = sort keys %h; die &quot;unrecognized parameters: @k&quot; if @k }</td></tr>
<tr><td class="h">748</td><td colspan="7"></td></tr><tr><td class="h">749</td><td><div class="c3">44</div></td><td><div class="c0" title="T/-"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L749">50</a></div></td><td></td><td></td><td></td><td><div>115</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if (!$KEEP_ALL) {</td></tr>
<tr><td class="h">750</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Files</td></tr>
<tr><td class="h">751</td><td><div class="c3">7</div></td><td></td><td></td><td></td><td></td><td><div>46</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my @files = (exists $files_to_unlink{$$} ?</td></tr>
<tr><td class="h">752</td><td><div class="c3">44</div></td><td><div class="c3" title="T/F"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L752">100</a></div></td><td></td><td></td><td></td><td><div>184</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@{ $files_to_unlink{$$} } : () );</td></tr>
<tr><td class="h">753</td><td><div class="c3">44</div></td><td></td><td></td><td></td><td></td><td><div>105</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach my $file (@files) {</td></tr>
<tr><td class="h">754</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# close the filehandle without checking its state</td></tr>
<tr><td class="h">755</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# in order to make real sure that this is closed</td></tr>
<tr><td class="h">756</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# if its already closed then I don&#39;t care about the answer</td></tr>
<tr><td class="h">757</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# probably a better way to do this</td></tr>
<tr><td class="h">758</td><td><div class="c3">59</div></td><td></td><td></td><td></td><td></td><td><div>89</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;close($file-&gt;[0]);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# file handle is [0]</td></tr>
<tr><td class="h">759</td><td colspan="7"></td></tr><tr><td class="h">760</td><td><div class="c3">59</div></td><td><div class="c0" title="T/-"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L760">50</a></div></td><td></td><td></td><td></td><td><div>279</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (-f $file-&gt;[1]) {&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# file name is [1]</td></tr>
<tr><td class="h">761</td><td><div class="c3">59</div></td><td></td><td></td><td></td><td></td><td><div>109</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_force_writable( $file-&gt;[1] ); # for windows</td></tr>
<tr><td class="h">762</td><td><div class="c3">59</div></td><td><div class="c0" title="-/F"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L762">50</a></div></td><td></td><td></td><td></td><td><div>1244</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unlink $file-&gt;[1] or warn &quot;Error removing &quot;.$file-&gt;[1];</td></tr>
<tr><td class="h">763</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">764</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">765</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Dirs</td></tr>
<tr><td class="h">766</td><td><div class="c3">39</div></td><td></td><td></td><td></td><td></td><td><div>193</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my @dirs = (exists $dirs_to_unlink{$$} ?</td></tr>
<tr><td class="h">767</td><td><div class="c3">44</div></td><td><div class="c3" title="T/F"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L767">100</a></div></td><td></td><td></td><td></td><td><div>145</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@{ $dirs_to_unlink{$$} } : () );</td></tr>
<tr><td class="h">768</td><td><div class="c3">44</div></td><td></td><td></td><td></td><td></td><td><div>62</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my ($cwd, $cwd_to_remove);</td></tr>
<tr><td class="h">769</td><td><div class="c3">44</div></td><td></td><td></td><td></td><td></td><td><div>71</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach my $dir (@dirs) {</td></tr>
<tr><td class="h">770</td><td><div class="c3">471</div></td><td><div class="c0" title="T/-"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L770">50</a></div></td><td></td><td></td><td></td><td><div>1747</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (-d $dir) {</td></tr>
<tr><td class="h">771</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Some versions of rmtree will abort if you attempt to remove</td></tr>
<tr><td class="h">772</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# the directory you are sitting in. For automatic cleanup</td></tr>
<tr><td class="h">773</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# at program exit, we avoid this by chdir()ing out of the way</td></tr>
<tr><td class="h">774</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# first. If not at program exit, it&#39;s best not to mess with the</td></tr>
<tr><td class="h">775</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# current directory, so just let it fail with a warning.</td></tr>
<tr><td class="h">776</td><td><div class="c3">471</div></td><td><div class="c0" title="T/-"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L776">50</a></div></td><td></td><td></td><td></td><td><div>711</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($at_exit) {</td></tr>
<tr><td class="h">777</td><td><div class="c3">471</div></td><td><div class="c3" title="T/F"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L777">100</a></div></td><td></td><td></td><td></td><td><div>1368</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$cwd = Cwd::abs_path(File::Spec-&gt;curdir) if not defined $cwd;</td></tr>
<tr><td class="h">778</td><td><div class="c3">471</div></td><td></td><td></td><td></td><td></td><td><div>2076</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $abs = Cwd::abs_path($dir);</td></tr>
<tr><td class="h">779</td><td><div class="c3">471</div></td><td><div class="c0" title="-/F"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L779">50</a></div></td><td></td><td></td><td></td><td><div>886</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($abs eq $cwd) {</td></tr>
<tr><td class="h">780</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$cwd_to_remove = $dir;</td></tr>
<tr><td class="h">781</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;next;</td></tr>
<tr><td class="h">782</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">783</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">784</td><td><div class="c3">471</div><div class="c3">471</div></td><td></td><td></td><td></td><td></td><td><div>471</div><div>80754</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eval { rmtree($dir, $DEBUG, 0); };</td></tr>
<tr><td class="h">785</td><td><div class="c3">471</div></td><td><div class="c0" title="-/-"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L785">0</a></div></td><td><div class="c0"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--condition.html#L785">33</a></div></td><td></td><td></td><td><div>1248</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;warn $@ if ($@ &amp;&amp; $^W);</td></tr>
<tr><td class="h">786</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">787</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">788</td><td colspan="7"></td></tr><tr><td class="h">789</td><td><div class="c3">44</div></td><td><div class="c0" title="-/F"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L789">50</a></div></td><td></td><td></td><td></td><td><div>276</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (defined $cwd_to_remove) {</td></tr>
<tr><td class="h">790</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# We do need to clean up the current directory, and everything</td></tr>
<tr><td class="h">791</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# else is done, so get out of there and remove it.</td></tr>
<tr><td class="h">792</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L792">0</a></div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;chdir $cwd_to_remove or die &quot;cannot chdir to $cwd_to_remove: $!&quot;;</td></tr>
<tr><td class="h">793</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $updir = File::Spec-&gt;updir;</td></tr>
<tr><td class="h">794</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L794">0</a></div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;chdir $updir or die &quot;cannot chdir to $updir: $!&quot;;</td></tr>
<tr><td class="h">795</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eval { rmtree($cwd_to_remove, $DEBUG, 0); };</td></tr>
<tr><td class="h">796</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L796">0</a></div></td><td><div class="c0"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--condition.html#L796">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;warn $@ if ($@ &amp;&amp; $^W);</td></tr>
<tr><td class="h">797</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">798</td><td colspan="7"></td></tr><tr><td class="h">799</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# clear the arrays</td></tr>
<tr><td class="h">800</td><td><div class="c3">44</div><div class="c3">7</div></td><td><div class="c3" title="T/F"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L800">100</a></div></td><td></td><td></td><td></td><td><div>150</div><div>27</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@{ $files_to_unlink{$$} } = ()</td></tr>
<tr><td class="h">801</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if exists $files_to_unlink{$$};</td></tr>
<tr><td class="h">802</td><td><div class="c3">44</div><div class="c3">39</div></td><td><div class="c3" title="T/F"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L802">100</a></div></td><td></td><td></td><td></td><td><div>239</div><div>398</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@{ $dirs_to_unlink{$$} } = ()</td></tr>
<tr><td class="h">803</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if exists $dirs_to_unlink{$$};</td></tr>
<tr><td class="h">804</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">805</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">806</td><td colspan="7"></td></tr><tr><td class="h">807</td><td colspan="7"></td></tr><tr><td class="h">808</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# This is the sub called to register a file for deferred unlinking</td></tr>
<tr><td class="h">809</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# This could simply store the input parameters and defer everything</td></tr>
<tr><td class="h">810</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# until the END block. For now we do a bit of checking at this</td></tr>
<tr><td class="h">811</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# point in order to make sure that (1) we have a file/dir to delete</td></tr>
<tr><td class="h">812</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# and (2) we have been called with the correct arguments.</td></tr>
<tr><td class="h">813</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;sub _deferred_unlink {</td></tr>
<tr><td class="h">814</td><td colspan="7"></td></tr><tr><td class="h">815</td><td><div class="c3">530</div></td><td><div class="c0" title="-/F"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L815">50</a></div></td><td></td><td><div class="c3"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--subroutine.html#L815">530</a></div></td><td></td><td><div>916</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;croak &#39;Usage:&nbsp;&nbsp;_deferred_unlink($fh, $fname, $isdir)&#39;</td></tr>
<tr><td class="h">816</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unless scalar(@_) == 3;</td></tr>
<tr><td class="h">817</td><td colspan="7"></td></tr><tr><td class="h">818</td><td><div class="c3">530</div></td><td></td><td></td><td></td><td></td><td><div>611</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ($fh, $fname, $isdir) = @_;</td></tr>
<tr><td class="h">819</td><td colspan="7"></td></tr><tr><td class="h">820</td><td><div class="c3">530</div></td><td><div class="c0" title="-/F"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L820">50</a></div></td><td></td><td></td><td></td><td><div>829</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;warn &quot;Setting up deferred removal of $fname\n&quot;</td></tr>
<tr><td class="h">821</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if $DEBUG;</td></tr>
<tr><td class="h">822</td><td colspan="7"></td></tr><tr><td class="h">823</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# make sure we save the absolute path for later cleanup</td></tr>
<tr><td class="h">824</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# OK to untaint because we only ever use this internally</td></tr>
<tr><td class="h">825</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# as a file path, never interpolating into the shell</td></tr>
<tr><td class="h">826</td><td><div class="c3">530</div></td><td></td><td></td><td></td><td></td><td><div>2943</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$fname = Cwd::abs_path($fname);</td></tr>
<tr><td class="h">827</td><td><div class="c3">530</div></td><td></td><td></td><td></td><td></td><td><div>2006</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;($fname) = $fname =~ /^(.*)$/;</td></tr>
<tr><td class="h">828</td><td colspan="7"></td></tr><tr><td class="h">829</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# If we have a directory, check that it is a directory</td></tr>
<tr><td class="h">830</td><td><div class="c3">530</div></td><td><div class="c3" title="T/F"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L830">100</a></div></td><td></td><td></td><td></td><td><div>890</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ($isdir) {</td></tr>
<tr><td class="h">831</td><td colspan="7"></td></tr><tr><td class="h">832</td><td><div class="c3">471</div></td><td><div class="c0" title="T/-"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L832">50</a></div></td><td></td><td></td><td></td><td><div>1341</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (-d $fname) {</td></tr>
<tr><td class="h">833</td><td colspan="7"></td></tr><tr><td class="h">834</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Directory exists so store it</td></tr>
<tr><td class="h">835</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# first on VMS turn []foo into [.foo] for rmtree</td></tr>
<tr><td class="h">836</td><td><div class="c3">471</div></td><td><div class="c0" title="-/F"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L836">50</a></div></td><td></td><td></td><td></td><td><div>1045</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$fname = VMS::Filespec::vmspath($fname) if $^O eq &#39;VMS&#39;;</td></tr>
<tr><td class="h">837</td><td><div class="c3">471</div></td><td><div class="c3" title="T/F"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L837">100</a></div></td><td></td><td></td><td></td><td><div>1109</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$dirs_to_unlink{$$} = [] </td></tr>
<tr><td class="h">838</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unless exists $dirs_to_unlink{$$};</td></tr>
<tr><td class="h">839</td><td><div class="c3">471</div><div class="c3">471</div></td><td></td><td></td><td></td><td></td><td><div>412</div><div>1216</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push (@{ $dirs_to_unlink{$$} }, $fname);</td></tr>
<tr><td class="h">840</td><td colspan="7"></td></tr><tr><td class="h">841</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">842</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L842">0</a></div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;carp &quot;Request to remove directory $fname could not be completed since it does not exist!\n&quot; if $^W;</td></tr>
<tr><td class="h">843</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">844</td><td colspan="7"></td></tr><tr><td class="h">845</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">846</td><td colspan="7"></td></tr><tr><td class="h">847</td><td><div class="c3">59</div></td><td><div class="c0" title="T/-"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L847">50</a></div></td><td></td><td></td><td></td><td><div>187</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (-f $fname) {</td></tr>
<tr><td class="h">848</td><td colspan="7"></td></tr><tr><td class="h">849</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# file exists so store handle and name for later removal</td></tr>
<tr><td class="h">850</td><td><div class="c3">59</div></td><td><div class="c3" title="T/F"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L850">100</a></div></td><td></td><td></td><td></td><td><div>314</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$files_to_unlink{$$} = []</td></tr>
<tr><td class="h">851</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unless exists $files_to_unlink{$$};</td></tr>
<tr><td class="h">852</td><td><div class="c3">59</div><div class="c3">59</div></td><td></td><td></td><td></td><td></td><td><div>62</div><div>228</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push(@{ $files_to_unlink{$$} }, [$fh, $fname]);</td></tr>
<tr><td class="h">853</td><td colspan="7"></td></tr><tr><td class="h">854</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">855</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L855">0</a></div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;carp &quot;Request to remove file $fname could not be completed since it is not there!\n&quot; if $^W;</td></tr>
<tr><td class="h">856</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">857</td><td colspan="7"></td></tr><tr><td class="h">858</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">859</td><td colspan="7"></td></tr><tr><td class="h">860</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">861</td><td colspan="7"></td></tr><tr><td class="h">862</td><td colspan="7"></td></tr><tr><td class="h">863</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">864</td><td colspan="7"></td></tr><tr><td class="h">865</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># normalize argument keys to upper case and do consistent handling</td></tr>
<tr><td class="h">866</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># of leading template vs TEMPLATE</td></tr>
<tr><td class="h">867</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _parse_args {</td></tr>
<tr><td class="h">868</td><td><div class="c3">1143</div></td><td><div class="c0" title="-/F"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L868">50</a></div></td><td></td><td><div class="c3"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--subroutine.html#L868">1143</a></div></td><td></td><td><div>2284</div></td><td class="s">&nbsp;&nbsp;my $leading_template = (scalar(@_) % 2 == 1 ? shift(@_) : &#39;&#39; );</td></tr>
<tr><td class="h">869</td><td><div class="c3">1143</div></td><td></td><td></td><td></td><td></td><td><div>1514</div></td><td class="s">&nbsp;&nbsp;my %args = @_;</td></tr>
<tr><td class="h">870</td><td><div class="c3">1143</div><div class="c3">530</div></td><td></td><td></td><td></td><td></td><td><div>1984</div><div>1949</div></td><td class="s">&nbsp;&nbsp;%args = map { uc($_), $args{$_} } keys %args;</td></tr>
<tr><td class="h">871</td><td colspan="7"></td></tr><tr><td class="h">872</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# template (store it in an array so that it will</td></tr>
<tr><td class="h">873</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# disappear from the arg list of tempfile)</td></tr>
<tr><td class="h">874</td><td><div class="c3">1143</div></td><td><div class="c0" title="-/F"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L874">50</a></div><div class="c0" title="-/F"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L874">50</a></div></td><td></td><td></td><td></td><td><div>2719</div></td><td class="s">&nbsp;&nbsp;my @template = (</td></tr>
<tr><td class="h">875</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;exists $args{TEMPLATE}&nbsp;&nbsp;? $args{TEMPLATE} :</td></tr>
<tr><td class="h">876</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$leading_template&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;? $leading_template : ()</td></tr>
<tr><td class="h">877</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;);</td></tr>
<tr><td class="h">878</td><td><div class="c3">1143</div></td><td></td><td></td><td></td><td></td><td><div>1203</div></td><td class="s">&nbsp;&nbsp;delete $args{TEMPLATE};</td></tr>
<tr><td class="h">879</td><td colspan="7"></td></tr><tr><td class="h">880</td><td><div class="c3">1143</div></td><td></td><td></td><td></td><td></td><td><div>2183</div></td><td class="s">&nbsp;&nbsp;return( \@template, \%args );</td></tr>
<tr><td class="h">881</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">882</td><td colspan="7"></td></tr><tr><td class="h">883</td><td colspan="7"></td></tr><tr><td class="h">884</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub new {</td></tr>
<tr><td class="h">885</td><td><div class="c3">305</div></td><td></td><td></td><td><div class="c3"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--subroutine.html#L885">305</a></div></td><td><div class="c3">1</div></td><td><div>342</div></td><td class="s">&nbsp;&nbsp;my $proto = shift;</td></tr>
<tr><td class="h">886</td><td><div class="c3">305</div></td><td></td><td><div class="c0"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--condition.html#L886">33</a></div></td><td></td><td></td><td><div>817</div></td><td class="s">&nbsp;&nbsp;my $class = ref($proto) || $proto;</td></tr>
<tr><td class="h">887</td><td colspan="7"></td></tr><tr><td class="h">888</td><td><div class="c3">305</div></td><td></td><td></td><td></td><td></td><td><div>436</div></td><td class="s">&nbsp;&nbsp;my ($maybe_template, $args) = _parse_args(@_);</td></tr>
<tr><td class="h">889</td><td colspan="7"></td></tr><tr><td class="h">890</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# see if they are unlinking (defaulting to yes)</td></tr>
<tr><td class="h">891</td><td><div class="c3">305</div></td><td><div class="c0" title="-/F"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L891">50</a></div></td><td></td><td></td><td></td><td><div>514</div></td><td class="s">&nbsp;&nbsp;my $unlink = (exists $args-&gt;{UNLINK} ? $args-&gt;{UNLINK} : 1 );</td></tr>
<tr><td class="h">892</td><td><div class="c3">305</div></td><td></td><td></td><td></td><td></td><td><div>293</div></td><td class="s">&nbsp;&nbsp;delete $args-&gt;{UNLINK};</td></tr>
<tr><td class="h">893</td><td colspan="7"></td></tr><tr><td class="h">894</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Protect OPEN</td></tr>
<tr><td class="h">895</td><td><div class="c3">305</div></td><td></td><td></td><td></td><td></td><td><div>264</div></td><td class="s">&nbsp;&nbsp;delete $args-&gt;{OPEN};</td></tr>
<tr><td class="h">896</td><td colspan="7"></td></tr><tr><td class="h">897</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Open the file and retain file handle and file name</td></tr>
<tr><td class="h">898</td><td><div class="c3">305</div></td><td></td><td></td><td></td><td></td><td><div>519</div></td><td class="s">&nbsp;&nbsp;my ($fh, $path) = tempfile( @$maybe_template, %$args );</td></tr>
<tr><td class="h">899</td><td colspan="7"></td></tr><tr><td class="h">900</td><td><div class="c3">305</div></td><td><div class="c0" title="-/F"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L900">50</a></div></td><td></td><td></td><td></td><td><div>528</div></td><td class="s">&nbsp;&nbsp;print &quot;Tmp: $fh - $path\n&quot; if $DEBUG;</td></tr>
<tr><td class="h">901</td><td colspan="7"></td></tr><tr><td class="h">902</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Store the filename in the scalar slot</td></tr>
<tr><td class="h">903</td><td><div class="c3">305</div><div class="c3">305</div></td><td></td><td></td><td></td><td></td><td><div>269</div><div>563</div></td><td class="s">&nbsp;&nbsp;${*$fh} = $path;</td></tr>
<tr><td class="h">904</td><td colspan="7"></td></tr><tr><td class="h">905</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Cache the filename by pid so that the destructor can decide whether to remove it</td></tr>
<tr><td class="h">906</td><td><div class="c3">305</div></td><td></td><td></td><td></td><td></td><td><div>824</div></td><td class="s">&nbsp;&nbsp;$FILES_CREATED_BY_OBJECT{$$}{$path} = 1;</td></tr>
<tr><td class="h">907</td><td colspan="7"></td></tr><tr><td class="h">908</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Store unlink information in hash slot (plus other constructor info)</td></tr>
<tr><td class="h">909</td><td><div class="c3">305</div><div class="c3">305</div></td><td></td><td></td><td></td><td></td><td><div>356</div><div>515</div></td><td class="s">&nbsp;&nbsp;%{*$fh} = %$args;</td></tr>
<tr><td class="h">910</td><td colspan="7"></td></tr><tr><td class="h">911</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# create the object</td></tr>
<tr><td class="h">912</td><td><div class="c3">305</div></td><td></td><td></td><td></td><td></td><td><div>499</div></td><td class="s">&nbsp;&nbsp;bless $fh, $class;</td></tr>
<tr><td class="h">913</td><td colspan="7"></td></tr><tr><td class="h">914</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# final method-based configuration</td></tr>
<tr><td class="h">915</td><td><div class="c3">305</div></td><td></td><td></td><td></td><td></td><td><div>530</div></td><td class="s">&nbsp;&nbsp;$fh-&gt;unlink_on_destroy( $unlink );</td></tr>
<tr><td class="h">916</td><td colspan="7"></td></tr><tr><td class="h">917</td><td><div class="c3">305</div></td><td></td><td></td><td></td><td></td><td><div>947</div></td><td class="s">&nbsp;&nbsp;return $fh;</td></tr>
<tr><td class="h">918</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">919</td><td colspan="7"></td></tr><tr><td class="h">920</td><td colspan="7"></td></tr><tr><td class="h">921</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub newdir {</td></tr>
<tr><td class="h">922</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--subroutine.html#L922">0</a></div></td><td><div class="c3">1</div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;my $self = shift;</td></tr>
<tr><td class="h">923</td><td colspan="7"></td></tr><tr><td class="h">924</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;my ($maybe_template, $args) = _parse_args(@_);</td></tr>
<tr><td class="h">925</td><td colspan="7"></td></tr><tr><td class="h">926</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# handle CLEANUP without passing CLEANUP to tempdir</td></tr>
<tr><td class="h">927</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L927">0</a></div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;my $cleanup = (exists $args-&gt;{CLEANUP} ? $args-&gt;{CLEANUP} : 1 );</td></tr>
<tr><td class="h">928</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;delete $args-&gt;{CLEANUP};</td></tr>
<tr><td class="h">929</td><td colspan="7"></td></tr><tr><td class="h">930</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;my $tempdir = tempdir( @$maybe_template, %$args);</td></tr>
<tr><td class="h">931</td><td colspan="7"></td></tr><tr><td class="h">932</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# get a safe absolute path for cleanup, just like</td></tr>
<tr><td class="h">933</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# happens in _deferred_unlink</td></tr>
<tr><td class="h">934</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;my $real_dir = Cwd::abs_path( $tempdir );</td></tr>
<tr><td class="h">935</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;($real_dir) = $real_dir =~ /^(.*)$/;</td></tr>
<tr><td class="h">936</td><td colspan="7"></td></tr><tr><td class="h">937</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;return bless { DIRNAME =&gt; $tempdir,</td></tr>
<tr><td class="h">938</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;REALNAME =&gt; $real_dir,</td></tr>
<tr><td class="h">939</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEANUP =&gt; $cleanup,</td></tr>
<tr><td class="h">940</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LAUNCHPID =&gt; $$,</td></tr>
<tr><td class="h">941</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}, &quot;File::Temp::Dir&quot;;</td></tr>
<tr><td class="h">942</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">943</td><td colspan="7"></td></tr><tr><td class="h">944</td><td colspan="7"></td></tr><tr><td class="h">945</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub filename {</td></tr>
<tr><td class="h">946</td><td><div class="c3">305</div></td><td></td><td></td><td><div class="c3"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--subroutine.html#L946">305</a></div></td><td><div class="c3">1</div></td><td><div>268</div></td><td class="s">&nbsp;&nbsp;my $self = shift;</td></tr>
<tr><td class="h">947</td><td><div class="c3">305</div><div class="c3">305</div></td><td></td><td></td><td></td><td></td><td><div>226</div><div>739</div></td><td class="s">&nbsp;&nbsp;return ${*$self};</td></tr>
<tr><td class="h">948</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">949</td><td colspan="7"></td></tr><tr><td class="h">950</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub STRINGIFY {</td></tr>
<tr><td class="h">951</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--subroutine.html#L951">0</a></div></td><td><div class="c0">0</div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;my $self = shift;</td></tr>
<tr><td class="h">952</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;return $self-&gt;filename;</td></tr>
<tr><td class="h">953</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">954</td><td colspan="7"></td></tr><tr><td class="h">955</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># For reference, can&#39;t use &#39;0+&#39;=&gt;\&amp;Scalar::Util::refaddr directly because</td></tr>
<tr><td class="h">956</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># refaddr() demands one parameter only, whereas overload.pm calls with three</td></tr>
<tr><td class="h">957</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># even for unary operations like &#39;0+&#39;.</td></tr>
<tr><td class="h">958</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub NUMIFY {</td></tr>
<tr><td class="h">959</td><td><div class="c3">305</div></td><td></td><td></td><td><div class="c3"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--subroutine.html#L959">305</a></div></td><td><div class="c0">0</div></td><td><div>1488</div></td><td class="s">&nbsp;&nbsp;return refaddr($_[0]);</td></tr>
<tr><td class="h">960</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">961</td><td colspan="7"></td></tr><tr><td class="h">962</td><td colspan="7"></td></tr><tr><td class="h">963</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub unlink_on_destroy {</td></tr>
<tr><td class="h">964</td><td><div class="c3">305</div></td><td></td><td></td><td><div class="c3"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--subroutine.html#L964">305</a></div></td><td><div class="c3">1</div></td><td><div>298</div></td><td class="s">&nbsp;&nbsp;my $self = shift;</td></tr>
<tr><td class="h">965</td><td><div class="c3">305</div></td><td><div class="c0" title="T/-"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L965">50</a></div></td><td></td><td></td><td></td><td><div>525</div></td><td class="s">&nbsp;&nbsp;if (@_) {</td></tr>
<tr><td class="h">966</td><td><div class="c3">305</div><div class="c3">305</div></td><td></td><td></td><td></td><td></td><td><div>273</div><div>4495</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;${*$self}{UNLINK} = shift;</td></tr>
<tr><td class="h">967</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">968</td><td><div class="c3">305</div><div class="c3">305</div></td><td></td><td></td><td></td><td></td><td><div>289</div><div>463</div></td><td class="s">&nbsp;&nbsp;return ${*$self}{UNLINK};</td></tr>
<tr><td class="h">969</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">970</td><td colspan="7"></td></tr><tr><td class="h">971</td><td colspan="7"></td></tr><tr><td class="h">972</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub DESTROY {</td></tr>
<tr><td class="h">973</td><td><div class="c3">305</div></td><td></td><td></td><td><div class="c3"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--subroutine.html#L973">305</a></div></td><td></td><td><div>1403</div></td><td class="s">&nbsp;&nbsp;local($., $@, $!, $^E, $?);</td></tr>
<tr><td class="h">974</td><td><div class="c3">305</div></td><td></td><td></td><td></td><td></td><td><div>323</div></td><td class="s">&nbsp;&nbsp;my $self = shift;</td></tr>
<tr><td class="h">975</td><td colspan="7"></td></tr><tr><td class="h">976</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Make sure we always remove the file from the global hash</td></tr>
<tr><td class="h">977</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# on destruction. This prevents the hash from growing uncontrollably</td></tr>
<tr><td class="h">978</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# and post-destruction there is no reason to know about the file.</td></tr>
<tr><td class="h">979</td><td><div class="c3">305</div></td><td></td><td></td><td></td><td></td><td><div>580</div></td><td class="s">&nbsp;&nbsp;my $file = $self-&gt;filename;</td></tr>
<tr><td class="h">980</td><td><div class="c3">305</div></td><td></td><td></td><td></td><td></td><td><div>361</div></td><td class="s">&nbsp;&nbsp;my $was_created_by_proc;</td></tr>
<tr><td class="h">981</td><td><div class="c3">305</div></td><td><div class="c0" title="T/-"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L981">50</a></div></td><td></td><td></td><td></td><td><div>862</div></td><td class="s">&nbsp;&nbsp;if (exists $FILES_CREATED_BY_OBJECT{$$}{$file}) {</td></tr>
<tr><td class="h">982</td><td><div class="c3">305</div></td><td></td><td></td><td></td><td></td><td><div>284</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$was_created_by_proc = 1;</td></tr>
<tr><td class="h">983</td><td><div class="c3">305</div></td><td></td><td></td><td></td><td></td><td><div>571</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;delete $FILES_CREATED_BY_OBJECT{$$}{$file};</td></tr>
<tr><td class="h">984</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">985</td><td colspan="7"></td></tr><tr><td class="h">986</td><td><div class="c3">305</div><div class="c3">305</div></td><td><div class="c0" title="T/-"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L986">50</a></div></td><td><div class="c0"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--condition.html#L986">33</a></div></td><td></td><td></td><td><div>255</div><div>2172</div></td><td class="s">&nbsp;&nbsp;if (${*$self}{UNLINK} &amp;&amp; !$KEEP_ALL) {</td></tr>
<tr><td class="h">987</td><td><div class="c3">305</div></td><td><div class="c0" title="-/F"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L987">50</a></div></td><td></td><td></td><td></td><td><div>456</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;print &quot;# ---------&gt;&nbsp;&nbsp;&nbsp;Unlinking $self\n&quot; if $DEBUG;</td></tr>
<tr><td class="h">988</td><td colspan="7"></td></tr><tr><td class="h">989</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# only delete if this process created it</td></tr>
<tr><td class="h">990</td><td><div class="c3">305</div></td><td><div class="c0" title="-/F"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L990">50</a></div></td><td></td><td></td><td></td><td><div>477</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return unless $was_created_by_proc;</td></tr>
<tr><td class="h">991</td><td colspan="7"></td></tr><tr><td class="h">992</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# The unlink1 may fail if the file has been closed</td></tr>
<tr><td class="h">993</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# by the caller. This leaves us with the decision</td></tr>
<tr><td class="h">994</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# of whether to refuse to remove the file or simply</td></tr>
<tr><td class="h">995</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# do an unlink without test. Seems to be silly</td></tr>
<tr><td class="h">996</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# to do this when we are trying to be careful</td></tr>
<tr><td class="h">997</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# about security</td></tr>
<tr><td class="h">998</td><td><div class="c3">305</div></td><td></td><td></td><td></td><td></td><td><div>447</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;_force_writable( $file ); # for windows</td></tr>
<tr><td class="h">999</td><td><div class="c3">305</div></td><td><div class="c0" title="-/F"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L999">50</a></div></td><td></td><td></td><td></td><td><div>478</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;unlink1( $self, $file )</td></tr>
<tr><td class="h">1000</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or unlink($file);</td></tr>
<tr><td class="h">1001</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1002</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1003</td><td colspan="7"></td></tr><tr><td class="h">1004</td><td colspan="7"></td></tr><tr><td class="h">1005</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub tempfile {</td></tr>
<tr><td class="h">1006</td><td><div class="c3">367</div></td><td><div class="c0" title="-/F"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L1006">50</a></div></td><td><div class="c0"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--condition.html#L1006">67</a></div></td><td><div class="c3"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--subroutine.html#L1006">367</a></div></td><td><div class="c3">1</div></td><td><div>1031</div></td><td class="s">&nbsp;&nbsp;if ( @_ &amp;&amp; $_[0] eq &#39;File::Temp&#39; ) {</td></tr>
<tr><td class="h">1007</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;croak &quot;&#39;tempfile&#39; can&#39;t be called as a method&quot;;</td></tr>
<tr><td class="h">1008</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1009</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Can not check for argument count since we can have any</td></tr>
<tr><td class="h">1010</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# number of args</td></tr>
<tr><td class="h">1011</td><td colspan="7"></td></tr><tr><td class="h">1012</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Default options</td></tr>
<tr><td class="h">1013</td><td><div class="c3">367</div></td><td></td><td></td><td></td><td></td><td><div>1445</div></td><td class="s">&nbsp;&nbsp;my %options = (</td></tr>
<tr><td class="h">1014</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;DIR&quot;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; undef, # Directory prefix</td></tr>
<tr><td class="h">1015</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;SUFFIX&quot; =&gt; &#39;&#39;,&nbsp;&nbsp;&nbsp;&nbsp;# Template suffix</td></tr>
<tr><td class="h">1016</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;UNLINK&quot; =&gt; 0,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Do not unlink file on exit</td></tr>
<tr><td class="h">1017</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;OPEN&quot;&nbsp;&nbsp;&nbsp;=&gt; 1,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Open file</td></tr>
<tr><td class="h">1018</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;TMPDIR&quot; =&gt; 0, # Place tempfile in tempdir if template specified</td></tr>
<tr><td class="h">1019</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;EXLOCK&quot; =&gt; 1, # Open file with O_EXLOCK</td></tr>
<tr><td class="h">1020</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</td></tr>
<tr><td class="h">1021</td><td colspan="7"></td></tr><tr><td class="h">1022</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Check to see whether we have an odd or even number of arguments</td></tr>
<tr><td class="h">1023</td><td><div class="c3">367</div></td><td></td><td></td><td></td><td></td><td><div>637</div></td><td class="s">&nbsp;&nbsp;my ($maybe_template, $args) = _parse_args(@_);</td></tr>
<tr><td class="h">1024</td><td><div class="c3">367</div></td><td><div class="c0" title="-/F"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L1024">50</a></div></td><td></td><td></td><td></td><td><div>608</div></td><td class="s">&nbsp;&nbsp;my $template = @$maybe_template ? $maybe_template-&gt;[0] : undef;</td></tr>
<tr><td class="h">1025</td><td colspan="7"></td></tr><tr><td class="h">1026</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Read the options and merge with defaults</td></tr>
<tr><td class="h">1027</td><td><div class="c3">367</div></td><td></td><td></td><td></td><td></td><td><div>1688</div></td><td class="s">&nbsp;&nbsp;%options = (%options, %$args);</td></tr>
<tr><td class="h">1028</td><td colspan="7"></td></tr><tr><td class="h">1029</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# First decision is whether or not to open the file</td></tr>
<tr><td class="h">1030</td><td><div class="c3">367</div></td><td><div class="c0" title="-/F"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L1030">50</a></div></td><td></td><td></td><td></td><td><div>964</div></td><td class="s">&nbsp;&nbsp;if (! $options{&quot;OPEN&quot;}) {</td></tr>
<tr><td class="h">1031</td><td colspan="7"></td></tr><tr><td class="h">1032</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L1032">0</a></div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;warn &quot;tempfile(): temporary filename requested but not opened.\nPossibly unsafe, consider using tempfile() with OPEN set to true\n&quot;</td></tr>
<tr><td class="h">1033</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if $^W;</td></tr>
<tr><td class="h">1034</td><td colspan="7"></td></tr><tr><td class="h">1035</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1036</td><td colspan="7"></td></tr><tr><td class="h">1037</td><td><div class="c3">367</div></td><td><div class="c0" title="-/F"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L1037">50</a></div></td><td><div class="c0"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--condition.html#L1037">33</a></div></td><td></td><td></td><td><div>770</div></td><td class="s">&nbsp;&nbsp;if ($options{&quot;DIR&quot;} and $^O eq &#39;VMS&#39;) {</td></tr>
<tr><td class="h">1038</td><td colspan="7"></td></tr><tr><td class="h">1039</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# on VMS turn []foo into [.foo] for concatenation</td></tr>
<tr><td class="h">1040</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$options{&quot;DIR&quot;} = VMS::Filespec::vmspath($options{&quot;DIR&quot;});</td></tr>
<tr><td class="h">1041</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1042</td><td colspan="7"></td></tr><tr><td class="h">1043</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Construct the template</td></tr>
<tr><td class="h">1044</td><td colspan="7"></td></tr><tr><td class="h">1045</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Have a choice of trying to work around the mkstemp/mktemp/tmpnam etc</td></tr>
<tr><td class="h">1046</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# functions or simply constructing a template and using _gettemp()</td></tr>
<tr><td class="h">1047</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# explicitly. Go for the latter</td></tr>
<tr><td class="h">1048</td><td colspan="7"></td></tr><tr><td class="h">1049</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# First generate a template if not defined and prefix the directory</td></tr>
<tr><td class="h">1050</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# If no template must prefix the temp directory</td></tr>
<tr><td class="h">1051</td><td><div class="c3">367</div></td><td><div class="c0" title="-/F"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L1051">50</a></div></td><td></td><td></td><td></td><td><div>548</div></td><td class="s">&nbsp;&nbsp;if (defined $template) {</td></tr>
<tr><td class="h">1052</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# End up with current directory if neither DIR not TMPDIR are set</td></tr>
<tr><td class="h">1053</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L1053">0</a></div><div class="c0" title="-/-"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L1053">0</a></div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ($options{&quot;DIR&quot;}) {</td></tr>
<tr><td class="h">1054</td><td colspan="7"></td></tr><tr><td class="h">1055</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$template = File::Spec-&gt;catfile($options{&quot;DIR&quot;}, $template);</td></tr>
<tr><td class="h">1056</td><td colspan="7"></td></tr><tr><td class="h">1057</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} elsif ($options{TMPDIR}) {</td></tr>
<tr><td class="h">1058</td><td colspan="7"></td></tr><tr><td class="h">1059</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$template = File::Spec-&gt;catfile(File::Spec-&gt;tmpdir, $template );</td></tr>
<tr><td class="h">1060</td><td colspan="7"></td></tr><tr><td class="h">1061</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1062</td><td colspan="7"></td></tr><tr><td class="h">1063</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">1064</td><td colspan="7"></td></tr><tr><td class="h">1065</td><td><div class="c3">367</div></td><td><div class="c0" title="-/F"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L1065">50</a></div></td><td></td><td></td><td></td><td><div>550</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ($options{&quot;DIR&quot;}) {</td></tr>
<tr><td class="h">1066</td><td colspan="7"></td></tr><tr><td class="h">1067</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$template = File::Spec-&gt;catfile($options{&quot;DIR&quot;}, TEMPXXX);</td></tr>
<tr><td class="h">1068</td><td colspan="7"></td></tr><tr><td class="h">1069</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">1070</td><td colspan="7"></td></tr><tr><td class="h">1071</td><td><div class="c3">367</div></td><td></td><td></td><td></td><td></td><td><div>6875</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$template = File::Spec-&gt;catfile(File::Spec-&gt;tmpdir, TEMPXXX);</td></tr>
<tr><td class="h">1072</td><td colspan="7"></td></tr><tr><td class="h">1073</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1074</td><td colspan="7"></td></tr><tr><td class="h">1075</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1076</td><td colspan="7"></td></tr><tr><td class="h">1077</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Now add a suffix</td></tr>
<tr><td class="h">1078</td><td><div class="c3">367</div></td><td></td><td></td><td></td><td></td><td><div>763</div></td><td class="s">&nbsp;&nbsp;$template .= $options{&quot;SUFFIX&quot;};</td></tr>
<tr><td class="h">1079</td><td colspan="7"></td></tr><tr><td class="h">1080</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Determine whether we should tell _gettemp to unlink the file</td></tr>
<tr><td class="h">1081</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# On unix this is irrelevant and can be worked out after the file is</td></tr>
<tr><td class="h">1082</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# opened (simply by unlinking the open filehandle). On Windows or VMS</td></tr>
<tr><td class="h">1083</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# we have to indicate temporary-ness when we open the file. In general</td></tr>
<tr><td class="h">1084</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# we only want a true temporary file if we are returning just the</td></tr>
<tr><td class="h">1085</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# filehandle - if the user wants the filename they probably do not</td></tr>
<tr><td class="h">1086</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# want the file to disappear as soon as they close it (which may be</td></tr>
<tr><td class="h">1087</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# important if they want a child process to use the file)</td></tr>
<tr><td class="h">1088</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# For this reason, tie unlink_on_close to the return context regardless</td></tr>
<tr><td class="h">1089</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# of OS.</td></tr>
<tr><td class="h">1090</td><td><div class="c3">367</div></td><td><div class="c3" title="T/F"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L1090">100</a></div></td><td></td><td></td><td></td><td><div>601</div></td><td class="s">&nbsp;&nbsp;my $unlink_on_close = ( wantarray ? 0 : 1);</td></tr>
<tr><td class="h">1091</td><td colspan="7"></td></tr><tr><td class="h">1092</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Create the file</td></tr>
<tr><td class="h">1093</td><td><div class="c3">367</div></td><td></td><td></td><td></td><td></td><td><div>342</div></td><td class="s">&nbsp;&nbsp;my ($fh, $path, $errstr);</td></tr>
<tr><td class="h">1094</td><td><div class="c3">367</div></td><td><div class="c0" title="-/F"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L1094">50</a></div></td><td></td><td></td><td></td><td><div>1077</div></td><td class="s">&nbsp;&nbsp;croak &quot;Error in tempfile() using template $template: $errstr&quot;</td></tr>
<tr><td class="h">1095</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;unless (($fh, $path) = _gettemp($template,</td></tr>
<tr><td class="h">1096</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;open&quot; =&gt; $options{&#39;OPEN&#39;},</td></tr>
<tr><td class="h">1097</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;mkdir&quot;=&gt; 0 ,</td></tr>
<tr><td class="h">1098</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;unlink_on_close&quot; =&gt; $unlink_on_close,</td></tr>
<tr><td class="h">1099</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;suffixlen&quot; =&gt; length($options{&#39;SUFFIX&#39;}),</td></tr>
<tr><td class="h">1100</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;ErrStr&quot; =&gt; \$errstr,</td></tr>
<tr><td class="h">1101</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;use_exlock&quot; =&gt; $options{EXLOCK},</td></tr>
<tr><td class="h">1102</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) );</td></tr>
<tr><td class="h">1103</td><td colspan="7"></td></tr><tr><td class="h">1104</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Set up an exit handler that can do whatever is right for the</td></tr>
<tr><td class="h">1105</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# system. This removes files at exit when requested explicitly or when</td></tr>
<tr><td class="h">1106</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# system is asked to unlink_on_close but is unable to do so because</td></tr>
<tr><td class="h">1107</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# of OS limitations.</td></tr>
<tr><td class="h">1108</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# The latter should be achieved by using a tied filehandle.</td></tr>
<tr><td class="h">1109</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Do not check return status since this is all done with END blocks.</td></tr>
<tr><td class="h">1110</td><td><div class="c3">367</div></td><td><div class="c3" title="T/F"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L1110">100</a></div></td><td></td><td></td><td></td><td><div>885</div></td><td class="s">&nbsp;&nbsp;_deferred_unlink($fh, $path, 0) if $options{&quot;UNLINK&quot;};</td></tr>
<tr><td class="h">1111</td><td colspan="7"></td></tr><tr><td class="h">1112</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Return</td></tr>
<tr><td class="h">1113</td><td><div class="c3">367</div></td><td><div class="c3" title="T/F"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L1113">100</a></div></td><td></td><td></td><td></td><td><div>555</div></td><td class="s">&nbsp;&nbsp;if (wantarray()) {</td></tr>
<tr><td class="h">1114</td><td colspan="7"></td></tr><tr><td class="h">1115</td><td><div class="c3">364</div></td><td><div class="c0" title="T/-"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L1115">50</a></div></td><td></td><td></td><td></td><td><div>547</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ($options{&#39;OPEN&#39;}) {</td></tr>
<tr><td class="h">1116</td><td><div class="c3">364</div></td><td></td><td></td><td></td><td></td><td><div>1145</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return ($fh, $path);</td></tr>
<tr><td class="h">1117</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">1118</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return (undef, $path);</td></tr>
<tr><td class="h">1119</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1120</td><td colspan="7"></td></tr><tr><td class="h">1121</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">1122</td><td colspan="7"></td></tr><tr><td class="h">1123</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Unlink the file. It is up to unlink0 to decide what to do with</td></tr>
<tr><td class="h">1124</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# this (whether to unlink now or to defer until later)</td></tr>
<tr><td class="h">1125</td><td><div class="c3">3</div></td><td><div class="c0" title="-/F"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L1125">50</a></div></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;unlink0($fh, $path) or croak &quot;Error unlinking file $path using unlink0&quot;;</td></tr>
<tr><td class="h">1126</td><td colspan="7"></td></tr><tr><td class="h">1127</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Return just the filehandle.</td></tr>
<tr><td class="h">1128</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td></td><td><div>14</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $fh;</td></tr>
<tr><td class="h">1129</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1130</td><td colspan="7"></td></tr><tr><td class="h">1131</td><td colspan="7"></td></tr><tr><td class="h">1132</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1133</td><td colspan="7"></td></tr><tr><td class="h">1134</td><td colspan="7"></td></tr><tr><td class="h">1135</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># &#39;</td></tr>
<tr><td class="h">1136</td><td colspan="7"></td></tr><tr><td class="h">1137</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub tempdir&nbsp;&nbsp;{</td></tr>
<tr><td class="h">1138</td><td><div class="c3">471</div></td><td><div class="c0" title="-/F"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L1138">50</a></div></td><td><div class="c0"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--condition.html#L1138">33</a></div></td><td><div class="c3"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--subroutine.html#L1138">471</a></div></td><td><div class="c3">1</div></td><td><div>1947</div></td><td class="s">&nbsp;&nbsp;if ( @_ &amp;&amp; $_[0] eq &#39;File::Temp&#39; ) {</td></tr>
<tr><td class="h">1139</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;croak &quot;&#39;tempdir&#39; can&#39;t be called as a method&quot;;</td></tr>
<tr><td class="h">1140</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1141</td><td colspan="7"></td></tr><tr><td class="h">1142</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Can not check for argument count since we can have any</td></tr>
<tr><td class="h">1143</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# number of args</td></tr>
<tr><td class="h">1144</td><td colspan="7"></td></tr><tr><td class="h">1145</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Default options</td></tr>
<tr><td class="h">1146</td><td><div class="c3">471</div></td><td></td><td></td><td></td><td></td><td><div>1266</div></td><td class="s">&nbsp;&nbsp;my %options = (</td></tr>
<tr><td class="h">1147</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;CLEANUP&quot;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; 0, # Remove directory on exit</td></tr>
<tr><td class="h">1148</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;DIR&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; &#39;&#39;, # Root directory</td></tr>
<tr><td class="h">1149</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;TMPDIR&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; 0,&nbsp;&nbsp;# Use tempdir with template</td></tr>
<tr><td class="h">1150</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</td></tr>
<tr><td class="h">1151</td><td colspan="7"></td></tr><tr><td class="h">1152</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Check to see whether we have an odd or even number of arguments</td></tr>
<tr><td class="h">1153</td><td><div class="c3">471</div></td><td></td><td></td><td></td><td></td><td><div>825</div></td><td class="s">&nbsp;&nbsp;my ($maybe_template, $args) = _parse_args(@_);</td></tr>
<tr><td class="h">1154</td><td><div class="c3">471</div></td><td><div class="c0" title="-/F"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L1154">50</a></div></td><td></td><td></td><td></td><td><div>837</div></td><td class="s">&nbsp;&nbsp;my $template = @$maybe_template ? $maybe_template-&gt;[0] : undef;</td></tr>
<tr><td class="h">1155</td><td colspan="7"></td></tr><tr><td class="h">1156</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Read the options and merge with defaults</td></tr>
<tr><td class="h">1157</td><td><div class="c3">471</div></td><td></td><td></td><td></td><td></td><td><div>1686</div></td><td class="s">&nbsp;&nbsp;%options = (%options, %$args);</td></tr>
<tr><td class="h">1158</td><td colspan="7"></td></tr><tr><td class="h">1159</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Modify or generate the template</td></tr>
<tr><td class="h">1160</td><td colspan="7"></td></tr><tr><td class="h">1161</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Deal with the DIR and TMPDIR options</td></tr>
<tr><td class="h">1162</td><td><div class="c3">471</div></td><td><div class="c0" title="-/F"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L1162">50</a></div></td><td></td><td></td><td></td><td><div>877</div></td><td class="s">&nbsp;&nbsp;if (defined $template) {</td></tr>
<tr><td class="h">1163</td><td colspan="7"></td></tr><tr><td class="h">1164</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Need to strip directory path if using DIR or TMPDIR</td></tr>
<tr><td class="h">1165</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L1165">0</a></div></td><td><div class="c0"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--condition.html#L1165">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ($options{&#39;TMPDIR&#39;} || $options{&#39;DIR&#39;}) {</td></tr>
<tr><td class="h">1166</td><td colspan="7"></td></tr><tr><td class="h">1167</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Strip parent directory from the filename</td></tr>
<tr><td class="h">1168</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#</td></tr>
<tr><td class="h">1169</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# There is no filename at the end</td></tr>
<tr><td class="h">1170</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L1170">0</a></div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$template = VMS::Filespec::vmspath($template) if $^O eq &#39;VMS&#39;;</td></tr>
<tr><td class="h">1171</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my ($volume, $directories, undef) = File::Spec-&gt;splitpath( $template, 1);</td></tr>
<tr><td class="h">1172</td><td colspan="7"></td></tr><tr><td class="h">1173</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Last directory is then our template</td></tr>
<tr><td class="h">1174</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$template = (File::Spec-&gt;splitdir($directories))[-1];</td></tr>
<tr><td class="h">1175</td><td colspan="7"></td></tr><tr><td class="h">1176</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Prepend the supplied directory or temp dir</td></tr>
<tr><td class="h">1177</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L1177">0</a></div><div class="c0" title="-/-"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L1177">0</a></div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($options{&quot;DIR&quot;}) {</td></tr>
<tr><td class="h">1178</td><td colspan="7"></td></tr><tr><td class="h">1179</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$template = File::Spec-&gt;catdir($options{&quot;DIR&quot;}, $template);</td></tr>
<tr><td class="h">1180</td><td colspan="7"></td></tr><tr><td class="h">1181</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} elsif ($options{TMPDIR}) {</td></tr>
<tr><td class="h">1182</td><td colspan="7"></td></tr><tr><td class="h">1183</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Prepend tmpdir</td></tr>
<tr><td class="h">1184</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$template = File::Spec-&gt;catdir(File::Spec-&gt;tmpdir, $template);</td></tr>
<tr><td class="h">1185</td><td colspan="7"></td></tr><tr><td class="h">1186</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1187</td><td colspan="7"></td></tr><tr><td class="h">1188</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1189</td><td colspan="7"></td></tr><tr><td class="h">1190</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">1191</td><td colspan="7"></td></tr><tr><td class="h">1192</td><td><div class="c3">471</div></td><td><div class="c0" title="-/F"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L1192">50</a></div></td><td></td><td></td><td></td><td><div>705</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ($options{&quot;DIR&quot;}) {</td></tr>
<tr><td class="h">1193</td><td colspan="7"></td></tr><tr><td class="h">1194</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$template = File::Spec-&gt;catdir($options{&quot;DIR&quot;}, TEMPXXX);</td></tr>
<tr><td class="h">1195</td><td colspan="7"></td></tr><tr><td class="h">1196</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">1197</td><td colspan="7"></td></tr><tr><td class="h">1198</td><td><div class="c3">471</div></td><td></td><td></td><td></td><td></td><td><div>8153</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$template = File::Spec-&gt;catdir(File::Spec-&gt;tmpdir, TEMPXXX);</td></tr>
<tr><td class="h">1199</td><td colspan="7"></td></tr><tr><td class="h">1200</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1201</td><td colspan="7"></td></tr><tr><td class="h">1202</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1203</td><td colspan="7"></td></tr><tr><td class="h">1204</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Create the directory</td></tr>
<tr><td class="h">1205</td><td><div class="c3">471</div></td><td></td><td></td><td></td><td></td><td><div>654</div></td><td class="s">&nbsp;&nbsp;my $tempdir;</td></tr>
<tr><td class="h">1206</td><td><div class="c3">471</div></td><td></td><td></td><td></td><td></td><td><div>450</div></td><td class="s">&nbsp;&nbsp;my $suffixlen = 0;</td></tr>
<tr><td class="h">1207</td><td><div class="c3">471</div></td><td><div class="c0" title="-/F"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L1207">50</a></div></td><td></td><td></td><td></td><td><div>1131</div></td><td class="s">&nbsp;&nbsp;if ($^O eq &#39;VMS&#39;) {&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# dir names can end in delimiters</td></tr>
<tr><td class="h">1208</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$template =~ m/([\.\]:&gt;]+)$/;</td></tr>
<tr><td class="h">1209</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$suffixlen = length($1);</td></tr>
<tr><td class="h">1210</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1211</td><td><div class="c3">471</div></td><td><div class="c0" title="-/F"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L1211">50</a></div></td><td><div class="c0"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--condition.html#L1211">33</a></div></td><td></td><td></td><td><div>1062</div></td><td class="s">&nbsp;&nbsp;if ( ($^O eq &#39;MacOS&#39;) &amp;&amp; (substr($template, -1) eq &#39;:&#39;) ) {</td></tr>
<tr><td class="h">1212</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# dir name has a trailing &#39;:&#39;</td></tr>
<tr><td class="h">1213</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;++$suffixlen;</td></tr>
<tr><td class="h">1214</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1215</td><td colspan="7"></td></tr><tr><td class="h">1216</td><td><div class="c3">471</div></td><td></td><td></td><td></td><td></td><td><div>397</div></td><td class="s">&nbsp;&nbsp;my $errstr;</td></tr>
<tr><td class="h">1217</td><td><div class="c3">471</div></td><td><div class="c0" title="-/F"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L1217">50</a></div></td><td></td><td></td><td></td><td><div>933</div></td><td class="s">&nbsp;&nbsp;croak &quot;Error in tempdir() using $template: $errstr&quot;</td></tr>
<tr><td class="h">1218</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;unless ((undef, $tempdir) = _gettemp($template,</td></tr>
<tr><td class="h">1219</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;open&quot; =&gt; 0,</td></tr>
<tr><td class="h">1220</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;mkdir&quot;=&gt; 1 ,</td></tr>
<tr><td class="h">1221</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;suffixlen&quot; =&gt; $suffixlen,</td></tr>
<tr><td class="h">1222</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;ErrStr&quot; =&gt; \$errstr,</td></tr>
<tr><td class="h">1223</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) );</td></tr>
<tr><td class="h">1224</td><td colspan="7"></td></tr><tr><td class="h">1225</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Install exit handler; must be dynamic to get lexical</td></tr>
<tr><td class="h">1226</td><td><div class="c3">471</div></td><td><div class="c0" title="T/-"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L1226">50</a></div></td><td><div class="c0"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--condition.html#L1226">33</a></div></td><td></td><td></td><td><div>2632</div></td><td class="s">&nbsp;&nbsp;if ( $options{&#39;CLEANUP&#39;} &amp;&amp; -d $tempdir) {</td></tr>
<tr><td class="h">1227</td><td><div class="c3">471</div></td><td></td><td></td><td></td><td></td><td><div>772</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;_deferred_unlink(undef, $tempdir, 1);</td></tr>
<tr><td class="h">1228</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1229</td><td colspan="7"></td></tr><tr><td class="h">1230</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Return the dir name</td></tr>
<tr><td class="h">1231</td><td><div class="c3">471</div></td><td></td><td></td><td></td><td></td><td><div>1556</div></td><td class="s">&nbsp;&nbsp;return $tempdir;</td></tr>
<tr><td class="h">1232</td><td colspan="7"></td></tr><tr><td class="h">1233</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1234</td><td colspan="7"></td></tr><tr><td class="h">1235</td><td colspan="7"></td></tr><tr><td class="h">1236</td><td colspan="7"></td></tr><tr><td class="h">1237</td><td colspan="7"></td></tr><tr><td class="h">1238</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub mkstemp {</td></tr>
<tr><td class="h">1239</td><td colspan="7"></td></tr><tr><td class="h">1240</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L1240">0</a></div></td><td></td><td><div class="c0"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--subroutine.html#L1240">0</a></div></td><td><div class="c3">1</div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;croak &quot;Usage: mkstemp(template)&quot;</td></tr>
<tr><td class="h">1241</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if scalar(@_) != 1;</td></tr>
<tr><td class="h">1242</td><td colspan="7"></td></tr><tr><td class="h">1243</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;my $template = shift;</td></tr>
<tr><td class="h">1244</td><td colspan="7"></td></tr><tr><td class="h">1245</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;my ($fh, $path, $errstr);</td></tr>
<tr><td class="h">1246</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L1246">0</a></div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;croak &quot;Error in mkstemp using $template: $errstr&quot;</td></tr>
<tr><td class="h">1247</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;unless (($fh, $path) = _gettemp($template,</td></tr>
<tr><td class="h">1248</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;open&quot; =&gt; 1,</td></tr>
<tr><td class="h">1249</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;mkdir&quot;=&gt; 0 ,</td></tr>
<tr><td class="h">1250</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;suffixlen&quot; =&gt; 0,</td></tr>
<tr><td class="h">1251</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;ErrStr&quot; =&gt; \$errstr,</td></tr>
<tr><td class="h">1252</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) );</td></tr>
<tr><td class="h">1253</td><td colspan="7"></td></tr><tr><td class="h">1254</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L1254">0</a></div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;if (wantarray()) {</td></tr>
<tr><td class="h">1255</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return ($fh, $path);</td></tr>
<tr><td class="h">1256</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">1257</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $fh;</td></tr>
<tr><td class="h">1258</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1259</td><td colspan="7"></td></tr><tr><td class="h">1260</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1261</td><td colspan="7"></td></tr><tr><td class="h">1262</td><td colspan="7"></td></tr><tr><td class="h">1263</td><td colspan="7"></td></tr><tr><td class="h">1264</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub mkstemps {</td></tr>
<tr><td class="h">1265</td><td colspan="7"></td></tr><tr><td class="h">1266</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L1266">0</a></div></td><td></td><td><div class="c0"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--subroutine.html#L1266">0</a></div></td><td><div class="c3">1</div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;croak &quot;Usage: mkstemps(template, suffix)&quot;</td></tr>
<tr><td class="h">1267</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if scalar(@_) != 2;</td></tr>
<tr><td class="h">1268</td><td colspan="7"></td></tr><tr><td class="h">1269</td><td colspan="7"></td></tr><tr><td class="h">1270</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;my $template = shift;</td></tr>
<tr><td class="h">1271</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;my $suffix&nbsp;&nbsp;&nbsp;= shift;</td></tr>
<tr><td class="h">1272</td><td colspan="7"></td></tr><tr><td class="h">1273</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;$template .= $suffix;</td></tr>
<tr><td class="h">1274</td><td colspan="7"></td></tr><tr><td class="h">1275</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;my ($fh, $path, $errstr);</td></tr>
<tr><td class="h">1276</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L1276">0</a></div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;croak &quot;Error in mkstemps using $template: $errstr&quot;</td></tr>
<tr><td class="h">1277</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;unless (($fh, $path) = _gettemp($template,</td></tr>
<tr><td class="h">1278</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;open&quot; =&gt; 1,</td></tr>
<tr><td class="h">1279</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;mkdir&quot;=&gt; 0 ,</td></tr>
<tr><td class="h">1280</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;suffixlen&quot; =&gt; length($suffix),</td></tr>
<tr><td class="h">1281</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;ErrStr&quot; =&gt; \$errstr,</td></tr>
<tr><td class="h">1282</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) );</td></tr>
<tr><td class="h">1283</td><td colspan="7"></td></tr><tr><td class="h">1284</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L1284">0</a></div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;if (wantarray()) {</td></tr>
<tr><td class="h">1285</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return ($fh, $path);</td></tr>
<tr><td class="h">1286</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">1287</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $fh;</td></tr>
<tr><td class="h">1288</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1289</td><td colspan="7"></td></tr><tr><td class="h">1290</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1291</td><td colspan="7"></td></tr><tr><td class="h">1292</td><td colspan="7"></td></tr><tr><td class="h">1293</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#&#39; # for emacs</td></tr>
<tr><td class="h">1294</td><td colspan="7"></td></tr><tr><td class="h">1295</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub mkdtemp {</td></tr>
<tr><td class="h">1296</td><td colspan="7"></td></tr><tr><td class="h">1297</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L1297">0</a></div></td><td></td><td><div class="c0"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--subroutine.html#L1297">0</a></div></td><td><div class="c3">1</div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;croak &quot;Usage: mkdtemp(template)&quot;</td></tr>
<tr><td class="h">1298</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if scalar(@_) != 1;</td></tr>
<tr><td class="h">1299</td><td colspan="7"></td></tr><tr><td class="h">1300</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;my $template = shift;</td></tr>
<tr><td class="h">1301</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;my $suffixlen = 0;</td></tr>
<tr><td class="h">1302</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L1302">0</a></div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;if ($^O eq &#39;VMS&#39;) {&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# dir names can end in delimiters</td></tr>
<tr><td class="h">1303</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$template =~ m/([\.\]:&gt;]+)$/;</td></tr>
<tr><td class="h">1304</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$suffixlen = length($1);</td></tr>
<tr><td class="h">1305</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1306</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L1306">0</a></div></td><td><div class="c0"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--condition.html#L1306">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;if ( ($^O eq &#39;MacOS&#39;) &amp;&amp; (substr($template, -1) eq &#39;:&#39;) ) {</td></tr>
<tr><td class="h">1307</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# dir name has a trailing &#39;:&#39;</td></tr>
<tr><td class="h">1308</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;++$suffixlen;</td></tr>
<tr><td class="h">1309</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1310</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;my ($junk, $tmpdir, $errstr);</td></tr>
<tr><td class="h">1311</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L1311">0</a></div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;croak &quot;Error creating temp directory from template $template\: $errstr&quot;</td></tr>
<tr><td class="h">1312</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;unless (($junk, $tmpdir) = _gettemp($template,</td></tr>
<tr><td class="h">1313</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;open&quot; =&gt; 0,</td></tr>
<tr><td class="h">1314</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;mkdir&quot;=&gt; 1 ,</td></tr>
<tr><td class="h">1315</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;suffixlen&quot; =&gt; $suffixlen,</td></tr>
<tr><td class="h">1316</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;ErrStr&quot; =&gt; \$errstr,</td></tr>
<tr><td class="h">1317</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) );</td></tr>
<tr><td class="h">1318</td><td colspan="7"></td></tr><tr><td class="h">1319</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;return $tmpdir;</td></tr>
<tr><td class="h">1320</td><td colspan="7"></td></tr><tr><td class="h">1321</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1322</td><td colspan="7"></td></tr><tr><td class="h">1323</td><td colspan="7"></td></tr><tr><td class="h">1324</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub mktemp {</td></tr>
<tr><td class="h">1325</td><td colspan="7"></td></tr><tr><td class="h">1326</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L1326">0</a></div></td><td></td><td><div class="c0"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--subroutine.html#L1326">0</a></div></td><td><div class="c3">1</div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;croak &quot;Usage: mktemp(template)&quot;</td></tr>
<tr><td class="h">1327</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if scalar(@_) != 1;</td></tr>
<tr><td class="h">1328</td><td colspan="7"></td></tr><tr><td class="h">1329</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;my $template = shift;</td></tr>
<tr><td class="h">1330</td><td colspan="7"></td></tr><tr><td class="h">1331</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;my ($tmpname, $junk, $errstr);</td></tr>
<tr><td class="h">1332</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L1332">0</a></div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;croak &quot;Error getting name to temp file from template $template: $errstr&quot;</td></tr>
<tr><td class="h">1333</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;unless (($junk, $tmpname) = _gettemp($template,</td></tr>
<tr><td class="h">1334</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;open&quot; =&gt; 0,</td></tr>
<tr><td class="h">1335</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;mkdir&quot;=&gt; 0 ,</td></tr>
<tr><td class="h">1336</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;suffixlen&quot; =&gt; 0,</td></tr>
<tr><td class="h">1337</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;ErrStr&quot; =&gt; \$errstr,</td></tr>
<tr><td class="h">1338</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) );</td></tr>
<tr><td class="h">1339</td><td colspan="7"></td></tr><tr><td class="h">1340</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;return $tmpname;</td></tr>
<tr><td class="h">1341</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1342</td><td colspan="7"></td></tr><tr><td class="h">1343</td><td colspan="7"></td></tr><tr><td class="h">1344</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub tmpnam {</td></tr>
<tr><td class="h">1345</td><td colspan="7"></td></tr><tr><td class="h">1346</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Retrieve the temporary directory name</td></tr>
<tr><td class="h">1347</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--subroutine.html#L1347">0</a></div></td><td><div class="c3">1</div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;my $tmpdir = File::Spec-&gt;tmpdir;</td></tr>
<tr><td class="h">1348</td><td colspan="7"></td></tr><tr><td class="h">1349</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L1349">0</a></div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;croak &quot;Error temporary directory is not writable&quot;</td></tr>
<tr><td class="h">1350</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if $tmpdir eq &#39;&#39;;</td></tr>
<tr><td class="h">1351</td><td colspan="7"></td></tr><tr><td class="h">1352</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Use a ten character template and append to tmpdir</td></tr>
<tr><td class="h">1353</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;my $template = File::Spec-&gt;catfile($tmpdir, TEMPXXX);</td></tr>
<tr><td class="h">1354</td><td colspan="7"></td></tr><tr><td class="h">1355</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L1355">0</a></div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;if (wantarray() ) {</td></tr>
<tr><td class="h">1356</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return mkstemp($template);</td></tr>
<tr><td class="h">1357</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">1358</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return mktemp($template);</td></tr>
<tr><td class="h">1359</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1360</td><td colspan="7"></td></tr><tr><td class="h">1361</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1362</td><td colspan="7"></td></tr><tr><td class="h">1363</td><td colspan="7"></td></tr><tr><td class="h">1364</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub tmpfile {</td></tr>
<tr><td class="h">1365</td><td colspan="7"></td></tr><tr><td class="h">1366</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Simply call tmpnam() in a list context</td></tr>
<tr><td class="h">1367</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--subroutine.html#L1367">0</a></div></td><td><div class="c3">1</div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;my ($fh, $file) = tmpnam();</td></tr>
<tr><td class="h">1368</td><td colspan="7"></td></tr><tr><td class="h">1369</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Make sure file is removed when filehandle is closed</td></tr>
<tr><td class="h">1370</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# This will fail on NFS</td></tr>
<tr><td class="h">1371</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L1371">0</a></div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;unlink0($fh, $file)</td></tr>
<tr><td class="h">1372</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;or return undef;</td></tr>
<tr><td class="h">1373</td><td colspan="7"></td></tr><tr><td class="h">1374</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;return $fh;</td></tr>
<tr><td class="h">1375</td><td colspan="7"></td></tr><tr><td class="h">1376</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1377</td><td colspan="7"></td></tr><tr><td class="h">1378</td><td colspan="7"></td></tr><tr><td class="h">1379</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub tempnam {</td></tr>
<tr><td class="h">1380</td><td colspan="7"></td></tr><tr><td class="h">1381</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L1381">0</a></div></td><td></td><td><div class="c0"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--subroutine.html#L1381">0</a></div></td><td><div class="c3">1</div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;croak &#39;Usage tempnam($dir, $prefix)&#39; unless scalar(@_) == 2;</td></tr>
<tr><td class="h">1382</td><td colspan="7"></td></tr><tr><td class="h">1383</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;my ($dir, $prefix) = @_;</td></tr>
<tr><td class="h">1384</td><td colspan="7"></td></tr><tr><td class="h">1385</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Add a string to the prefix</td></tr>
<tr><td class="h">1386</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;$prefix .= &#39;XXXXXXXX&#39;;</td></tr>
<tr><td class="h">1387</td><td colspan="7"></td></tr><tr><td class="h">1388</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Concatenate the directory to the file</td></tr>
<tr><td class="h">1389</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;my $template = File::Spec-&gt;catfile($dir, $prefix);</td></tr>
<tr><td class="h">1390</td><td colspan="7"></td></tr><tr><td class="h">1391</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;return mktemp($template);</td></tr>
<tr><td class="h">1392</td><td colspan="7"></td></tr><tr><td class="h">1393</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1394</td><td colspan="7"></td></tr><tr><td class="h">1395</td><td colspan="7"></td></tr><tr><td class="h">1396</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub unlink0 {</td></tr>
<tr><td class="h">1397</td><td colspan="7"></td></tr><tr><td class="h">1398</td><td><div class="c3">3</div></td><td><div class="c0" title="-/F"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L1398">50</a></div></td><td></td><td><div class="c3"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--subroutine.html#L1398">3</a></div></td><td><div class="c3">1</div></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;croak &#39;Usage: unlink0(filehandle, filename)&#39;</td></tr>
<tr><td class="h">1399</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;unless scalar(@_) == 2;</td></tr>
<tr><td class="h">1400</td><td colspan="7"></td></tr><tr><td class="h">1401</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Read args</td></tr>
<tr><td class="h">1402</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td></td><td><div>3</div></td><td class="s">&nbsp;&nbsp;my ($fh, $path) = @_;</td></tr>
<tr><td class="h">1403</td><td colspan="7"></td></tr><tr><td class="h">1404</td><td><div class="c3">3</div></td><td><div class="c0" title="-/F"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L1404">50</a></div></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;cmpstat($fh, $path) or return 0;</td></tr>
<tr><td class="h">1405</td><td colspan="7"></td></tr><tr><td class="h">1406</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# attempt remove the file (does not work on some platforms)</td></tr>
<tr><td class="h">1407</td><td><div class="c3">3</div></td><td><div class="c0" title="T/-"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L1407">50</a></div></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;if (_can_unlink_opened_file()) {</td></tr>
<tr><td class="h">1408</td><td colspan="7"></td></tr><tr><td class="h">1409</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# return early (Without unlink) if we have been instructed to retain files.</td></tr>
<tr><td class="h">1410</td><td><div class="c3">3</div></td><td><div class="c0" title="-/F"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L1410">50</a></div></td><td></td><td></td><td></td><td><div>3</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return 1 if $KEEP_ALL;</td></tr>
<tr><td class="h">1411</td><td colspan="7"></td></tr><tr><td class="h">1412</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# XXX: do *not* call this on a directory; possible race</td></tr>
<tr><td class="h">1413</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resulting in recursive removal</td></tr>
<tr><td class="h">1414</td><td><div class="c3">3</div></td><td><div class="c0" title="-/F"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L1414">50</a></div></td><td></td><td></td><td></td><td><div>10</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;croak &quot;unlink0: $path has become a directory!&quot; if -d $path;</td></tr>
<tr><td class="h">1415</td><td><div class="c3">3</div></td><td><div class="c0" title="-/F"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L1415">50</a></div></td><td></td><td></td><td></td><td><div>32</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;unlink($path) or return 0;</td></tr>
<tr><td class="h">1416</td><td colspan="7"></td></tr><tr><td class="h">1417</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Stat the filehandle</td></tr>
<tr><td class="h">1418</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td></td><td><div>10</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my @fh = stat $fh;</td></tr>
<tr><td class="h">1419</td><td colspan="7"></td></tr><tr><td class="h">1420</td><td><div class="c3">3</div></td><td><div class="c0" title="-/F"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L1420">50</a></div></td><td></td><td></td><td></td><td><div>7</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;print &quot;Link count = $fh[3] \n&quot; if $DEBUG;</td></tr>
<tr><td class="h">1421</td><td colspan="7"></td></tr><tr><td class="h">1422</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Make sure that the link count is zero</td></tr>
<tr><td class="h">1423</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# - Cygwin provides deferred unlinking, however,</td></tr>
<tr><td class="h">1424</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;&nbsp;on Win9x the link count remains 1</td></tr>
<tr><td class="h">1425</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# On NFS the link count may still be 1 but we can&#39;t know that</td></tr>
<tr><td class="h">1426</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# we are on NFS.&nbsp;&nbsp;Since we can&#39;t be sure, we&#39;ll defer it</td></tr>
<tr><td class="h">1427</td><td colspan="7"></td></tr><tr><td class="h">1428</td><td><div class="c3">3</div></td><td><div class="c0" title="T/-"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L1428">50</a></div></td><td><div class="c0"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--condition.html#L1428">33</a></div></td><td></td><td></td><td><div>10</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return 1 if $fh[3] == 0 || $^O eq &#39;cygwin&#39;;</td></tr>
<tr><td class="h">1429</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1430</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# fall-through if we can&#39;t unlink now</td></tr>
<tr><td class="h">1431</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;_deferred_unlink($fh, $path, 0);</td></tr>
<tr><td class="h">1432</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;return 1;</td></tr>
<tr><td class="h">1433</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1434</td><td colspan="7"></td></tr><tr><td class="h">1435</td><td colspan="7"></td></tr><tr><td class="h">1436</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub cmpstat {</td></tr>
<tr><td class="h">1437</td><td colspan="7"></td></tr><tr><td class="h">1438</td><td><div class="c3">308</div></td><td><div class="c0" title="-/F"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L1438">50</a></div></td><td></td><td><div class="c3"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--subroutine.html#L1438">308</a></div></td><td><div class="c3">1</div></td><td><div>490</div></td><td class="s">&nbsp;&nbsp;croak &#39;Usage: cmpstat(filehandle, filename)&#39;</td></tr>
<tr><td class="h">1439</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;unless scalar(@_) == 2;</td></tr>
<tr><td class="h">1440</td><td colspan="7"></td></tr><tr><td class="h">1441</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Read args</td></tr>
<tr><td class="h">1442</td><td><div class="c3">308</div></td><td></td><td></td><td></td><td></td><td><div>303</div></td><td class="s">&nbsp;&nbsp;my ($fh, $path) = @_;</td></tr>
<tr><td class="h">1443</td><td colspan="7"></td></tr><tr><td class="h">1444</td><td><div class="c3">308</div></td><td><div class="c0" title="-/F"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L1444">50</a></div></td><td></td><td></td><td></td><td><div>437</div></td><td class="s">&nbsp;&nbsp;warn &quot;Comparing stat\n&quot;</td></tr>
<tr><td class="h">1445</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if $DEBUG;</td></tr>
<tr><td class="h">1446</td><td colspan="7"></td></tr><tr><td class="h">1447</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Stat the filehandle - which may be closed if someone has manually</td></tr>
<tr><td class="h">1448</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# closed the file. Can not turn off warnings without using $^W</td></tr>
<tr><td class="h">1449</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# unless we upgrade to 5.006 minimum requirement</td></tr>
<tr><td class="h">1450</td><td><div class="c3">308</div></td><td></td><td></td><td></td><td></td><td><div>1215</div></td><td class="s">&nbsp;&nbsp;my @fh;</td></tr>
<tr><td class="h">1451</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;{</td></tr>
<tr><td class="h">1452</td><td><div class="c3">308</div><div class="c3">308</div></td><td></td><td></td><td></td><td></td><td><div>260</div><div>697</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;local ($^W) = 0;</td></tr>
<tr><td class="h">1453</td><td><div class="c3">308</div></td><td></td><td></td><td></td><td></td><td><div>1418</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;@fh = stat $fh;</td></tr>
<tr><td class="h">1454</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1455</td><td><div class="c3">308</div></td><td><div class="c0" title="-/F"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L1455">50</a></div></td><td></td><td></td><td></td><td><div>661</div></td><td class="s">&nbsp;&nbsp;return unless @fh;</td></tr>
<tr><td class="h">1456</td><td colspan="7"></td></tr><tr><td class="h">1457</td><td><div class="c3">308</div></td><td><div class="c0" title="-/-"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L1457">0</a></div></td><td><div class="c0"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--condition.html#L1457">33</a></div></td><td></td><td></td><td><div>537</div></td><td class="s">&nbsp;&nbsp;if ($fh[3] &gt; 1 &amp;&amp; $^W) {</td></tr>
<tr><td class="h">1458</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L1458">0</a></div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;carp &quot;unlink0: fstat found too many links; SB=@fh&quot; if $^W;</td></tr>
<tr><td class="h">1459</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1460</td><td colspan="7"></td></tr><tr><td class="h">1461</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Stat the path</td></tr>
<tr><td class="h">1462</td><td><div class="c3">308</div></td><td></td><td></td><td></td><td></td><td><div>1194</div></td><td class="s">&nbsp;&nbsp;my @path = stat $path;</td></tr>
<tr><td class="h">1463</td><td colspan="7"></td></tr><tr><td class="h">1464</td><td><div class="c3">308</div></td><td><div class="c0" title="-/F"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L1464">50</a></div></td><td></td><td></td><td></td><td><div>621</div></td><td class="s">&nbsp;&nbsp;unless (@path) {</td></tr>
<tr><td class="h">1465</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L1465">0</a></div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;carp &quot;unlink0: $path is gone already&quot; if $^W;</td></tr>
<tr><td class="h">1466</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return;</td></tr>
<tr><td class="h">1467</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1468</td><td colspan="7"></td></tr><tr><td class="h">1469</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# this is no longer a file, but may be a directory, or worse</td></tr>
<tr><td class="h">1470</td><td><div class="c3">308</div></td><td><div class="c0" title="-/F"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L1470">50</a></div></td><td></td><td></td><td></td><td><div>893</div></td><td class="s">&nbsp;&nbsp;unless (-f $path) {</td></tr>
<tr><td class="h">1471</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;confess &quot;panic: $path is no longer a file: SB=@fh&quot;;</td></tr>
<tr><td class="h">1472</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1473</td><td colspan="7"></td></tr><tr><td class="h">1474</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Do comparison of each member of the array</td></tr>
<tr><td class="h">1475</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# On WinNT dev and rdev seem to be different</td></tr>
<tr><td class="h">1476</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# depending on whether it is a file or a handle.</td></tr>
<tr><td class="h">1477</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Cannot simply compare all members of the stat return</td></tr>
<tr><td class="h">1478</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Select the ones we can use</td></tr>
<tr><td class="h">1479</td><td><div class="c3">308</div></td><td></td><td></td><td></td><td></td><td><div>811</div></td><td class="s">&nbsp;&nbsp;my @okstat = (0..$#fh);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Use all by default</td></tr>
<tr><td class="h">1480</td><td><div class="c3">308</div></td><td><div class="c0" title="-/F"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L1480">50</a></div><div class="c0" title="-/F"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L1480">50</a></div><div class="c0" title="-/F"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L1480">50</a></div><div class="c0" title="-/F"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L1480">50</a></div><div class="c0" title="-/F"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L1480">50</a></div></td><td></td><td></td><td></td><td><div>1766</div></td><td class="s">&nbsp;&nbsp;if ($^O eq &#39;MSWin32&#39;) {</td></tr>
<tr><td class="h">1481</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;@okstat = (1,2,3,4,5,7,8,9,10);</td></tr>
<tr><td class="h">1482</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;} elsif ($^O eq &#39;os2&#39;) {</td></tr>
<tr><td class="h">1483</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;@okstat = (0, 2..$#fh);</td></tr>
<tr><td class="h">1484</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;} elsif ($^O eq &#39;VMS&#39;) {&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# device and file ID are sufficient</td></tr>
<tr><td class="h">1485</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;@okstat = (0, 1);</td></tr>
<tr><td class="h">1486</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;} elsif ($^O eq &#39;dos&#39;) {</td></tr>
<tr><td class="h">1487</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;@okstat = (0,2..7,11..$#fh);</td></tr>
<tr><td class="h">1488</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;} elsif ($^O eq &#39;mpeix&#39;) {</td></tr>
<tr><td class="h">1489</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;@okstat = (0..4,8..10);</td></tr>
<tr><td class="h">1490</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1491</td><td colspan="7"></td></tr><tr><td class="h">1492</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Now compare each entry explicitly by number</td></tr>
<tr><td class="h">1493</td><td><div class="c3">308</div></td><td></td><td></td><td></td><td></td><td><div>423</div></td><td class="s">&nbsp;&nbsp;for (@okstat) {</td></tr>
<tr><td class="h">1494</td><td><div class="c3">4004</div></td><td><div class="c0" title="-/F"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L1494">50</a></div></td><td></td><td></td><td></td><td><div>4988</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;print &quot;Comparing: $_ : $fh[$_] and $path[$_]\n&quot; if $DEBUG;</td></tr>
<tr><td class="h">1495</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Use eq rather than == since rdev, blksize, and blocks (6, 11,</td></tr>
<tr><td class="h">1496</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# and 12) will be &#39;&#39; on platforms that do not support them.&nbsp;&nbsp;This</td></tr>
<tr><td class="h">1497</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# is fine since we are only comparing integers.</td></tr>
<tr><td class="h">1498</td><td><div class="c3">4004</div></td><td><div class="c0" title="-/F"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L1498">50</a></div></td><td></td><td></td><td></td><td><div>10716</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;unless ($fh[$_] eq $path[$_]) {</td></tr>
<tr><td class="h">1499</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L1499">0</a></div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;warn &quot;Did not match $_ element of stat\n&quot; if $DEBUG;</td></tr>
<tr><td class="h">1500</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return 0;</td></tr>
<tr><td class="h">1501</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1502</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1503</td><td colspan="7"></td></tr><tr><td class="h">1504</td><td><div class="c3">308</div></td><td></td><td></td><td></td><td></td><td><div>1224</div></td><td class="s">&nbsp;&nbsp;return 1;</td></tr>
<tr><td class="h">1505</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1506</td><td colspan="7"></td></tr><tr><td class="h">1507</td><td colspan="7"></td></tr><tr><td class="h">1508</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub unlink1 {</td></tr>
<tr><td class="h">1509</td><td><div class="c3">305</div></td><td><div class="c0" title="-/F"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L1509">50</a></div></td><td></td><td><div class="c3"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--subroutine.html#L1509">305</a></div></td><td><div class="c3">1</div></td><td><div>567</div></td><td class="s">&nbsp;&nbsp;croak &#39;Usage: unlink1(filehandle, filename)&#39;</td></tr>
<tr><td class="h">1510</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;unless scalar(@_) == 2;</td></tr>
<tr><td class="h">1511</td><td colspan="7"></td></tr><tr><td class="h">1512</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Read args</td></tr>
<tr><td class="h">1513</td><td><div class="c3">305</div></td><td></td><td></td><td></td><td></td><td><div>347</div></td><td class="s">&nbsp;&nbsp;my ($fh, $path) = @_;</td></tr>
<tr><td class="h">1514</td><td colspan="7"></td></tr><tr><td class="h">1515</td><td><div class="c3">305</div></td><td><div class="c0" title="-/F"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L1515">50</a></div></td><td></td><td></td><td></td><td><div>441</div></td><td class="s">&nbsp;&nbsp;cmpstat($fh, $path) or return 0;</td></tr>
<tr><td class="h">1516</td><td colspan="7"></td></tr><tr><td class="h">1517</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Close the file</td></tr>
<tr><td class="h">1518</td><td><div class="c3">305</div></td><td><div class="c0" title="-/F"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L1518">50</a></div></td><td></td><td></td><td></td><td><div>1258</div></td><td class="s">&nbsp;&nbsp;close( $fh ) or return 0;</td></tr>
<tr><td class="h">1519</td><td colspan="7"></td></tr><tr><td class="h">1520</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Make sure the file is writable (for windows)</td></tr>
<tr><td class="h">1521</td><td><div class="c3">305</div></td><td></td><td></td><td></td><td></td><td><div>415</div></td><td class="s">&nbsp;&nbsp;_force_writable( $path );</td></tr>
<tr><td class="h">1522</td><td colspan="7"></td></tr><tr><td class="h">1523</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# return early (without unlink) if we have been instructed to retain files.</td></tr>
<tr><td class="h">1524</td><td><div class="c3">305</div></td><td><div class="c0" title="-/F"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L1524">50</a></div></td><td></td><td></td><td></td><td><div>829</div></td><td class="s">&nbsp;&nbsp;return 1 if $KEEP_ALL;</td></tr>
<tr><td class="h">1525</td><td colspan="7"></td></tr><tr><td class="h">1526</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# remove the file</td></tr>
<tr><td class="h">1527</td><td><div class="c3">305</div></td><td></td><td></td><td></td><td></td><td><div>8665</div></td><td class="s">&nbsp;&nbsp;return unlink($path);</td></tr>
<tr><td class="h">1528</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1529</td><td colspan="7"></td></tr><tr><td class="h">1530</td><td colspan="7"></td></tr><tr><td class="h">1531</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">{</td></tr>
<tr><td class="h">1532</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# protect from using the variable itself</td></tr>
<tr><td class="h">1533</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;my $LEVEL = STANDARD;</td></tr>
<tr><td class="h">1534</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;sub safe_level {</td></tr>
<tr><td class="h">1535</td><td><div class="c3">1676</div></td><td></td><td></td><td><div class="c3"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--subroutine.html#L1535">1676</a></div></td><td><div class="c3">1</div></td><td><div>1482</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $self = shift;</td></tr>
<tr><td class="h">1536</td><td><div class="c3">1676</div></td><td><div class="c0" title="-/F"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L1536">50</a></div></td><td></td><td></td><td></td><td><div>2501</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if (@_) {</td></tr>
<tr><td class="h">1537</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $level = shift;</td></tr>
<tr><td class="h">1538</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L1538">0</a></div></td><td><div class="c0"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--condition.html#L1538">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (($level != STANDARD) &amp;&amp; ($level != MEDIUM) &amp;&amp; ($level != HIGH)) {</td></tr>
<tr><td class="h">1539</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L1539">0</a></div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;carp &quot;safe_level: Specified level ($level) not STANDARD, MEDIUM or HIGH - ignoring\n&quot; if $^W;</td></tr>
<tr><td class="h">1540</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">1541</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Don&#39;t allow this on perl 5.005 or earlier</td></tr>
<tr><td class="h">1542</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L1542">0</a></div></td><td><div class="c0"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--condition.html#L1542">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($] &lt; 5.006 &amp;&amp; $level != STANDARD) {</td></tr>
<tr><td class="h">1543</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Cant do MEDIUM or HIGH checks</td></tr>
<tr><td class="h">1544</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;croak &quot;Currently requires perl 5.006 or newer to do the safe checks&quot;;</td></tr>
<tr><td class="h">1545</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1546</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Check that we are allowed to change level</td></tr>
<tr><td class="h">1547</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Silently ignore if we can not.</td></tr>
<tr><td class="h">1548</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L1548">0</a></div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$LEVEL = $level if _can_do_level($level);</td></tr>
<tr><td class="h">1549</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1550</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1551</td><td><div class="c3">1676</div></td><td></td><td></td><td></td><td></td><td><div>3259</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $LEVEL;</td></tr>
<tr><td class="h">1552</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1553</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1554</td><td colspan="7"></td></tr><tr><td class="h">1555</td><td colspan="7"></td></tr><tr><td class="h">1556</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">{</td></tr>
<tr><td class="h">1557</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;my $TopSystemUID = 10;</td></tr>
<tr><td class="h">1558</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;$TopSystemUID = 197108 if $^O eq &#39;interix&#39;; # &quot;Administrator&quot;</td></tr>
<tr><td class="h">1559</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;sub top_system_uid {</td></tr>
<tr><td class="h">1560</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--subroutine.html#L1560">0</a></div></td><td><div class="c0">0</div></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $self = shift;</td></tr>
<tr><td class="h">1561</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L1561">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if (@_) {</td></tr>
<tr><td class="h">1562</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $newuid = shift;</td></tr>
<tr><td class="h">1563</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L1563">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;croak &quot;top_system_uid: UIDs should be numeric&quot;</td></tr>
<tr><td class="h">1564</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unless $newuid =~ /^\d+$/s;</td></tr>
<tr><td class="h">1565</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$TopSystemUID = $newuid;</td></tr>
<tr><td class="h">1566</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1567</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $TopSystemUID;</td></tr>
<tr><td class="h">1568</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1569</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1570</td><td colspan="7"></td></tr><tr><td class="h">1571</td><td colspan="7"></td></tr><tr><td class="h">1572</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">package File::Temp::Dir;</td></tr>
<tr><td class="h">1573</td><td colspan="7"></td></tr><tr><td class="h">1574</td><td><div class="c3">44</div><div class="c3">44</div><div class="c3">44</div></td><td></td><td></td><td><div class="c3"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--subroutine.html#L1574">44</a></div></td><td></td><td><div>195</div><div>47</div><div>1540</div></td><td class="s">use File::Path qw/ rmtree /;</td></tr>
<tr><td class="h">1575</td><td><div class="c3">44</div><div class="c3">44</div><div class="c3">44</div></td><td></td><td></td><td><div class="c3"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--subroutine.html#L1575">44</a></div></td><td></td><td><div>167</div><div>42</div><div>1495</div></td><td class="s">use strict;</td></tr>
<tr><td class="h">1576</td><td><div class="c3">44</div></td><td></td><td></td><td></td><td></td><td><div>9572</div></td><td class="s">use overload &#39;&quot;&quot;&#39; =&gt; &quot;STRINGIFY&quot;,</td></tr>
<tr><td class="h">1577</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&#39;0+&#39; =&gt; \&amp;File::Temp::NUMIFY,</td></tr>
<tr><td class="h">1578</td><td><div class="c3">44</div><div class="c3">44</div></td><td></td><td></td><td><div class="c3"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--subroutine.html#L1578">44</a></div></td><td></td><td><div>181</div><div>47</div></td><td class="s">&nbsp;&nbsp;fallback =&gt; 1;</td></tr>
<tr><td class="h">1579</td><td colspan="7"></td></tr><tr><td class="h">1580</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># private class specifically to support tempdir objects</td></tr>
<tr><td class="h">1581</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># created by File::Temp-&gt;newdir</td></tr>
<tr><td class="h">1582</td><td colspan="7"></td></tr><tr><td class="h">1583</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># ostensibly the same method interface as File::Temp but without</td></tr>
<tr><td class="h">1584</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># inheriting all the IO::Seekable methods and other cruft</td></tr>
<tr><td class="h">1585</td><td colspan="7"></td></tr><tr><td class="h">1586</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># Read-only - returns the name of the temp directory</td></tr>
<tr><td class="h">1587</td><td colspan="7"></td></tr><tr><td class="h">1588</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub dirname {</td></tr>
<tr><td class="h">1589</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--subroutine.html#L1589">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;my $self = shift;</td></tr>
<tr><td class="h">1590</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;return $self-&gt;{DIRNAME};</td></tr>
<tr><td class="h">1591</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1592</td><td colspan="7"></td></tr><tr><td class="h">1593</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub STRINGIFY {</td></tr>
<tr><td class="h">1594</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--subroutine.html#L1594">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;my $self = shift;</td></tr>
<tr><td class="h">1595</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;return $self-&gt;dirname;</td></tr>
<tr><td class="h">1596</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1597</td><td colspan="7"></td></tr><tr><td class="h">1598</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub unlink_on_destroy {</td></tr>
<tr><td class="h">1599</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--subroutine.html#L1599">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;my $self = shift;</td></tr>
<tr><td class="h">1600</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L1600">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;if (@_) {</td></tr>
<tr><td class="h">1601</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$self-&gt;{CLEANUP} = shift;</td></tr>
<tr><td class="h">1602</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1603</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;return $self-&gt;{CLEANUP};</td></tr>
<tr><td class="h">1604</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1605</td><td colspan="7"></td></tr><tr><td class="h">1606</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub DESTROY {</td></tr>
<tr><td class="h">1607</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--subroutine.html#L1607">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;my $self = shift;</td></tr>
<tr><td class="h">1608</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;local($., $@, $!, $^E, $?);</td></tr>
<tr><td class="h">1609</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L1609">0</a></div></td><td><div class="c0"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--condition.html#L1609">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;if ($self-&gt;unlink_on_destroy &amp;&amp; </td></tr>
<tr><td class="h">1610</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$$ == $self-&gt;{LAUNCHPID} &amp;&amp; !$File::Temp::KEEP_ALL) {</td></tr>
<tr><td class="h">1611</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L1611">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if (-d $self-&gt;{REALNAME}) {</td></tr>
<tr><td class="h">1612</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Some versions of rmtree will abort if you attempt to remove</td></tr>
<tr><td class="h">1613</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# the directory you are sitting in. We protect that and turn it</td></tr>
<tr><td class="h">1614</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# into a warning. We do this because this occurs during object</td></tr>
<tr><td class="h">1615</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# destruction and so can not be caught by the user.</td></tr>
<tr><td class="h">1616</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eval { rmtree($self-&gt;{REALNAME}, $File::Temp::DEBUG, 0); };</td></tr>
<tr><td class="h">1617</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--branch.html#L1617">0</a></div></td><td><div class="c0"><a href="-usr-local-lib-perl5-5-20-1-File-Temp-pm--condition.html#L1617">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;warn $@ if ($@ &amp;&amp; $^W);</td></tr>
<tr><td class="h">1618</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1619</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1620</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1621</td><td colspan="7"></td></tr><tr><td class="h">1622</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">1;</td></tr>
<tr><td class="h">1623</td><td colspan="7"></td></tr></table>
</body>
</html>
